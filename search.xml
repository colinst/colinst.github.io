<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>设计模式 Design pattern</title>
      <link href="/2018/08/28/%E5%9F%BA%E7%A1%80%20Base/20180828%20-%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20Design%20pattern/"/>
      <url>/2018/08/28/%E5%9F%BA%E7%A1%80%20Base/20180828%20-%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20Design%20pattern/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>当朝大学士，总共有3位，朕不得不罢免4位<br>看看你们这些人啊<br>单一职责,开放封闭,依赖倒转,迪米特<br>看你们一个个站在干岸上，设计模式你们还记得多少吗–<br><a id="more"></a></p><h1 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h1><h2 id="单一职责原则-SRP"><a href="#单一职责原则-SRP" class="headerlink" title="单一职责原则|SRP"></a>单一职责原则|SRP</h2><p>就一个类而言，应该仅有一个引起它变化的原因<br>如果一个类承担的之策过多，等于将这些职责耦合再一起，单个职责变化会削弱或抑制这个类完成其他职责的能力。该种耦合会导致设计脆弱，甚至产生意外破坏(ASD);  </p><h2 id="开放-封闭原则"><a href="#开放-封闭原则" class="headerlink" title="开放-封闭原则"></a>开放-封闭原则</h2><p>对扩展开放(Open for extension)<br>对更改封闭(Closed for modification)<br>要对频繁变化的模块进行抽象，但全部抽象也不好  </p><h2 id="依赖倒转原则"><a href="#依赖倒转原则" class="headerlink" title="依赖倒转原则"></a>依赖倒转原则</h2><p>强内聚，松耦合<br>抽象不应依赖细节，细节应依赖于抽象<br>针对接口编程，不要对实现编程A.高层模块不应该依赖低层模块，两个都应该依赖抽象<br>B.抽象不应该依赖细节。细节应该依赖抽象。</p><h2 id="迪米特法则-最少知识原则-LoD"><a href="#迪米特法则-最少知识原则-LoD" class="headerlink" title="迪米特法则(最少知识原则)[LoD]"></a>迪米特法则(最少知识原则)[LoD]</h2><p>如果两个类不必彼此直接通信，那么这两个类不该发生直接相互作用。如果一个类需要调用另一个类的某个方法，可通过第三者转发这个调用。[J&amp;DP]</p><h3 id="体现"><a href="#体现" class="headerlink" title="体现"></a>体现</h3><p>每个类应当尽量降低成员的访问权限。<br>强调类之间的松耦合，类与类之间耦合越弱，越有利于复用。单个弱耦合的类被修改，不会波及现有的关系类。</p><p>里氏代换原则  —&gt;<br>一个软件实体如果使用的是一个父类，那么一定适用于其子类，而软件无法察觉其变化。<br>里氏代换原则(LSP)：子类型必须能够替换掉它们的父类型[ASD]。<br>由于子类型的可替换性才使得父类的模块再无需修改时就可扩展。  </p><p>依赖倒转是面向对象设计的标志，如果编写时考虑的是如何针对抽象编程而不是针对编程细节，即程序中的依赖关系都是终于抽象类和接口，那就是面向对象设计，反之为过程化的设计。  </p><h2 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h2><h3 id="活字印刷"><a href="#活字印刷" class="headerlink" title="活字印刷"></a>活字印刷</h3><p>例子++</p><p>1.可维护；【只改需改之字】<br>2.可复用；<br>3.可扩展；【可加字】<br>4.灵活性；【横排换竖排】  </p><h3 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h3><p>通过封装、继承、多态将程序的耦合性降低<br>设计模式使得其更加灵活，容易修改且易于复用  </p><h3 id="业务封装"><a href="#业务封装" class="headerlink" title="业务封装"></a>业务封装</h3><p>火星车程序的分离<br>将客户端和服务端分离  </p><p>题目：<br>一队机器人漫游车将被美国宇航局降落在火星高原上。漫游车将在这个奇怪的长方形高原上巡游，以便他们的机载摄像头可以获得周围地形的完整视图，并将其发送回地球。漫游者的坐标和位置由x和y坐标的组合以及代表四个方向（E, S, W, N）的字母表示。高原划分为网格以简化导航。比如位置0，0，N，表示漫游车位于左下角并面向北。为了控制漫游车，美国宇航局发送一串简单的字母。指令字母是’L’，’R’和’M’。 ‘L’和’R’使漫游车分别向左或向右旋转90度，而不会从当前地点移动。‘M’表示前进一个网格点，并保持相同的方向。假设从（x，y）直接向北移动，就到了（x，y + 1）。</p><p>INPUT：<br>第一行输入是平台的右上角坐标，左下角坐标被假定为0,0。其余的输入是有关已部署的漫游车的信息。每个漫游车都有两行输入。第一行给出了漫游车的位置，第二行是告诉漫游车如何探索高原的一系列指令。位置由两个整数和一个由空格分隔的字母组成，对应于x和y坐标以及漫游车当前的方向。每个漫游车将按顺序完成，这意味着第二个漫游车在第一个漫游车完成移动之前不会开始移动。</p><p>OUTPUT:<br>每个漫游车的输出应该是其最终的坐标和位置。输入输出例子:<br>IN:<br>5 5<br>1 2 N<br>LMLMLMLMM<br>3 3 E<br>MMRMMRMRRM  </p><p>OUT：<br>1 3 N<br>5 1 E  </p><h4 id="服务端封装"><a href="#服务端封装" class="headerlink" title="服务端封装"></a>服务端封装</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rover</span> <span class="keyword">constructor</span></span>(<span class="keyword">var</span> x:<span class="built_in">Long</span>, <span class="keyword">var</span> y:<span class="built_in">Long</span>, <span class="keyword">var</span> z:String)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> rangez= arrayListOf(<span class="string">"e"</span>,<span class="string">"s"</span>,<span class="string">"w"</span>,<span class="string">"n"</span>)</span><br><span class="line">    <span class="keyword">val</span> rangeZ= arrayListOf(<span class="string">"E"</span>,<span class="string">"S"</span>,<span class="string">"W"</span>,<span class="string">"N"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">numL</span><span class="params">(z:<span class="type">Int</span>)</span></span>=<span class="keyword">if</span> (z==<span class="number">0</span>) <span class="number">3</span> <span class="keyword">else</span> z<span class="number">-1</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">numR</span><span class="params">(z:<span class="type">Int</span>)</span></span>=<span class="keyword">if</span> (z==<span class="number">3</span>) <span class="number">0</span> <span class="keyword">else</span> z+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doL</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">val</span> i1=rangeZ.indexOf(z)</span><br><span class="line">        <span class="keyword">val</span> i2=rangez.indexOf(z)</span><br><span class="line">        <span class="keyword">val</span> i= intArrayOf(i1,i2).max()</span><br><span class="line">        <span class="keyword">val</span> ii=numL(i!!)</span><br><span class="line">        z=rangeZ[ii]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doR</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">val</span> i1=rangeZ.indexOf(z)</span><br><span class="line">        <span class="keyword">val</span> i2=rangez.indexOf(z)</span><br><span class="line">        <span class="keyword">val</span> i= intArrayOf(i1,i2).max()</span><br><span class="line">        <span class="keyword">val</span> ii=numR(i!!)</span><br><span class="line">        z=rangeZ[ii]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doM</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">when</span>(z)&#123;</span><br><span class="line">            <span class="string">"E"</span> -&gt;  x++</span><br><span class="line">            <span class="string">"S"</span> -&gt;  y--</span><br><span class="line">            <span class="string">"W"</span> -&gt;  x--</span><br><span class="line">            <span class="string">"N"</span> -&gt;  y++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="操作界面封装"><a href="#操作界面封装" class="headerlink" title="操作界面封装"></a>操作界面封装</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> Rovers= MutableList(<span class="number">0</span>,&#123; Rover(<span class="number">1</span>, <span class="number">1</span>, <span class="string">"N"</span>) &#125;)</span><br><span class="line"><span class="keyword">val</span> sc = Scanner(System.`<span class="keyword">in</span>`)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> boderX=<span class="number">0</span>L</span><br><span class="line"><span class="keyword">var</span> boderY=<span class="number">0</span>L</span><br><span class="line"><span class="keyword">val</span> rangeZ= arrayListOf(<span class="string">"E"</span>,<span class="string">"S"</span>,<span class="string">"W"</span>,<span class="string">"N"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">InputSize</span><span class="params">()</span></span>&#123;</span><br><span class="line">    println(<span class="string">"please input map size:'x y'"</span>)</span><br><span class="line">    <span class="keyword">val</span> mapSize = sc.nextLine()</span><br><span class="line">    WashSize(mapSize)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">RoverSet</span><span class="params">()</span></span>&#123;</span><br><span class="line">    InputLocation()</span><br><span class="line">    InputCommand()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">InputLocation</span><span class="params">()</span></span>&#123;</span><br><span class="line">    println(<span class="string">"please input io.io.hongxi.simpleFactory.encapsulation.Rover's location:'x y z',example:'1 1 N','2 2 W'..  z in ['E','S','W','N']"</span>)</span><br><span class="line">    <span class="keyword">val</span> location = sc.nextLine()</span><br><span class="line">    WashLocation(location)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">InputCommand</span><span class="params">()</span></span>&#123;</span><br><span class="line">    println(<span class="string">"please input command,example:'LMLMLMLMM'..  char in ['L','R','M']"</span>)</span><br><span class="line">    <span class="keyword">val</span> command = sc.nextLine()</span><br><span class="line">    <span class="keyword">for</span> (cmd <span class="keyword">in</span> command)</span><br><span class="line">        <span class="keyword">when</span>(cmd)&#123;</span><br><span class="line">            <span class="string">'l'</span> -&gt; Rovers.last().doL()</span><br><span class="line">            <span class="string">'L'</span> -&gt; Rovers.last().doL()</span><br><span class="line">            <span class="string">'r'</span> -&gt; Rovers.last().doR()</span><br><span class="line">            <span class="string">'R'</span> -&gt; Rovers.last().doR()</span><br><span class="line">            <span class="string">'m'</span> -&gt; Rovers.last().doM()</span><br><span class="line">            <span class="string">'M'</span> -&gt; Rovers.last().doM()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    println(<span class="string">"enter to add rovers more,else input 'end' to end"</span>)</span><br><span class="line">    <span class="keyword">val</span> cmd = sc.nextLine()</span><br><span class="line">    <span class="keyword">if</span> (cmd==<span class="string">"END"</span>|| cmd==<span class="string">"end"</span>)&#123;</span><br><span class="line">        doResult()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">        RoverSet()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">WashSize</span><span class="params">(mapSize:<span class="type">String</span>)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list=mapSize.split(<span class="string">' '</span>).toMutableList()</span><br><span class="line">    list.removeAll(Array(<span class="number">99</span>,&#123;<span class="string">""</span>&#125;))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (list.size!=<span class="number">2</span>)&#123;</span><br><span class="line">        System.err.println(<span class="string">"wrong input,please input again:'x y'"</span>)</span><br><span class="line">        InputSize()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        boderX =list[<span class="number">0</span>].toLong()</span><br><span class="line">        boderY =list[<span class="number">1</span>].toLong()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">        System.err.println(<span class="string">"wrong input,please input again:'x y'"</span>)</span><br><span class="line">        InputSize()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (boderX &lt;<span class="number">1</span> || boderY &lt;<span class="number">1</span>)&#123;</span><br><span class="line">        System.err.println(<span class="string">"wrong input,please input again:'x y'"</span>)</span><br><span class="line">        InputSize()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(<span class="string">"mapSize=<span class="variable">$list</span>"</span>)</span><br><span class="line">    RoverSet()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">WashLocation</span><span class="params">(location:<span class="type">String</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> list=location.split(<span class="string">' '</span>).toMutableList()</span><br><span class="line">    list.removeAll(Array(<span class="number">99</span>,&#123;<span class="string">""</span>&#125;))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> x:<span class="built_in">Long</span></span><br><span class="line">    <span class="keyword">val</span> y:<span class="built_in">Long</span></span><br><span class="line">    <span class="keyword">val</span> z:String</span><br><span class="line">    <span class="keyword">if</span> (list.size!=<span class="number">3</span>)&#123;</span><br><span class="line">        System.err.println(<span class="string">"wrong input,please input again:'x y z',example:'1 1 N','2 2 W'..  z in ['E','S','W','N']"</span>)</span><br><span class="line">        InputLocation()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        x=list[<span class="number">0</span>].toLong()</span><br><span class="line">        y=list[<span class="number">1</span>].toLong()</span><br><span class="line">        z=list[<span class="number">2</span>]</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">        System.err.println(<span class="string">"wrong input,please input again:'x y z',example:'1 1 N','2 2 W'..  z in ['E','S','W','N']"</span>)</span><br><span class="line">        InputLocation()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x !<span class="keyword">in</span> <span class="number">0.</span>.boderX || y !<span class="keyword">in</span> <span class="number">0.</span>.boderY || z !<span class="keyword">in</span> rangeZ)&#123;</span><br><span class="line">        System.err.println(<span class="string">"wrong input,please make x in 0..<span class="variable">$boderX</span>, y in 0..<span class="variable">$boderY</span> and z in ['E','S','W','N']"</span>)</span><br><span class="line">        InputLocation()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Rovers.add(Rover(x, y, z))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (rover <span class="keyword">in</span> Rovers)</span><br><span class="line">        println(<span class="string">"<span class="subst">$&#123;rover.x&#125;</span> <span class="subst">$&#123;rover.y&#125;</span> <span class="subst">$&#123;rover.z&#125;</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    InputSize()</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    Input</span></span><br><span class="line"><span class="comment">    5 5</span></span><br><span class="line"><span class="comment">    1 2 N</span></span><br><span class="line"><span class="comment">    LMLMLMLMM</span></span><br><span class="line"><span class="comment">    3 3 E</span></span><br><span class="line"><span class="comment">    MMRMMRMRRM</span></span><br><span class="line"><span class="comment">    OutPut：</span></span><br><span class="line"><span class="comment">    1 3 N</span></span><br><span class="line"><span class="comment">    5 1 E*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="简单工厂模式-Simple-factory"><a href="#简单工厂模式-Simple-factory" class="headerlink" title="简单工厂模式|Simple factory"></a>简单工厂模式|Simple factory</h1><h2 id="简单工厂模式封装"><a href="#简单工厂模式封装" class="headerlink" title="简单工厂模式封装"></a>简单工厂模式封装</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Do</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> x:<span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">var</span> y:<span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">var</span> z:<span class="built_in">Char</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">numL</span><span class="params">(z:<span class="type">Int</span>)</span></span>:<span class="built_in">Int</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">numR</span><span class="params">(z:<span class="type">Int</span>)</span></span>:<span class="built_in">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> rangeZ:List&lt;<span class="built_in">Char</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">DoResult</span><span class="params">()</span></span>: Rover</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">DoL</span></span>(<span class="keyword">override</span> <span class="keyword">var</span> x:<span class="built_in">Int</span>,</span><br><span class="line">                <span class="keyword">override</span> <span class="keyword">var</span> y:<span class="built_in">Int</span>,</span><br><span class="line">                <span class="keyword">override</span> <span class="keyword">var</span> z:<span class="built_in">Char</span>) :Do&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">numL</span><span class="params">(z:<span class="type">Int</span>)</span></span>=<span class="keyword">if</span> (z==<span class="number">0</span>) <span class="number">3</span> <span class="keyword">else</span> z<span class="number">-1</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">numR</span><span class="params">(z:<span class="type">Int</span>)</span></span>=<span class="keyword">if</span> (z==<span class="number">3</span>) <span class="number">0</span> <span class="keyword">else</span> z+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> rangeZ=arrayListOf(<span class="string">'E'</span>,<span class="string">'S'</span>,<span class="string">'W'</span>,<span class="string">'N'</span>)</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">DoResult</span><span class="params">()</span></span>: Rover &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> i=rangeZ.indexOf(z)</span><br><span class="line">        <span class="keyword">val</span> ii=numL(i)</span><br><span class="line">        z=rangeZ[ii]</span><br><span class="line">        <span class="keyword">return</span> Rover(x,y,z)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">DoM</span></span>(<span class="keyword">override</span> <span class="keyword">var</span> x:<span class="built_in">Int</span>,</span><br><span class="line">          <span class="keyword">override</span> <span class="keyword">var</span> y:<span class="built_in">Int</span>,</span><br><span class="line">          <span class="keyword">override</span> <span class="keyword">var</span> z:<span class="built_in">Char</span>) :Do&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">numL</span><span class="params">(z:<span class="type">Int</span>)</span></span>=<span class="keyword">if</span> (z==<span class="number">0</span>) <span class="number">3</span> <span class="keyword">else</span> z<span class="number">-1</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">numR</span><span class="params">(z:<span class="type">Int</span>)</span></span>=<span class="keyword">if</span> (z==<span class="number">3</span>) <span class="number">0</span> <span class="keyword">else</span> z+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> rangeZ=arrayListOf(<span class="string">'E'</span>,<span class="string">'S'</span>,<span class="string">'W'</span>,<span class="string">'N'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">DoResult</span><span class="params">()</span></span>: Rover &#123;</span><br><span class="line">        <span class="keyword">when</span>(z)&#123;</span><br><span class="line">            <span class="string">'E'</span> -&gt;  x++</span><br><span class="line">            <span class="string">'S'</span> -&gt;  y--</span><br><span class="line">            <span class="string">'W'</span> -&gt;  x--</span><br><span class="line">            <span class="string">'N'</span> -&gt;  y++</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Rover(x,y,z)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DoR</span></span>(<span class="keyword">override</span> <span class="keyword">var</span> x:<span class="built_in">Int</span>,</span><br><span class="line">          <span class="keyword">override</span> <span class="keyword">var</span> y:<span class="built_in">Int</span>,</span><br><span class="line">          <span class="keyword">override</span> <span class="keyword">var</span> z:<span class="built_in">Char</span>) :Do&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">numL</span><span class="params">(z:<span class="type">Int</span>)</span></span>=<span class="keyword">if</span> (z==<span class="number">0</span>) <span class="number">3</span> <span class="keyword">else</span> z<span class="number">-1</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">numR</span><span class="params">(z:<span class="type">Int</span>)</span></span>=<span class="keyword">if</span> (z==<span class="number">3</span>) <span class="number">0</span> <span class="keyword">else</span> z+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> rangeZ=arrayListOf(<span class="string">'E'</span>,<span class="string">'S'</span>,<span class="string">'W'</span>,<span class="string">'N'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">DoResult</span><span class="params">()</span></span>: Rover &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> i=rangeZ.indexOf(z)</span><br><span class="line">        <span class="keyword">val</span> ii=numR(i)</span><br><span class="line">        z=rangeZ[ii]</span><br><span class="line">        <span class="keyword">return</span> Rover(x,y,z)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="松紧耦合"><a href="#松紧耦合" class="headerlink" title="松紧耦合"></a>松紧耦合</h2><p>紧耦合：<br>Rover对象的L,R,M方法写在一起，需求改变时需要需直接改变方法<br>松耦合：<br>解耦函数架构，将每个方法抽象成功能类</p><h2 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h2><p>分三层<br>1.类名(抽象类用斜体)<br>2.字段属性<br>3.方法行为  </p><h1 id="策略模式-Strategy-Mode"><a href="#策略模式-Strategy-Mode" class="headerlink" title="策略模式|Strategy Mode"></a>策略模式|Strategy Mode</h1><p>商场收银系统   </p><h2 id="简单工厂实现"><a href="#简单工厂实现" class="headerlink" title="简单工厂实现"></a>简单工厂实现</h2><p>现金收费对象下有多个实现子类<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> 收费对象</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> 收费<span class="params">(money:<span class="type">Money</span>)</span></span>=money</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 正常收费：收费对象</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> 收费<span class="params">(money:<span class="type">Money</span>)</span></span>=money</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 折扣收费</span>(折扣倍率：折扣)：收费对象&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> 收费<span class="params">(money:<span class="type">Money</span>)</span></span>=money*折扣倍率</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 返利收费</span>(返利条件，返利值)：收费对象&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> 收费<span class="params">(money:<span class="type">Money</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(返利条件) money-=返利值</span><br><span class="line">        <span class="keyword">return</span> money</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Object  收费工厂&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> 收费对象生成<span class="params">(type)</span></span>:收费对象&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">when</span>(type)&#123;</span><br><span class="line">            <span class="string">"正常收费"</span>  -&gt; <span class="keyword">return</span> 正常收费()</span><br><span class="line">            <span class="string">"折扣收费"</span>  -&gt; <span class="keyword">return</span> 折扣收费(折扣倍率)</span><br><span class="line">            <span class="string">"返利收费"</span>  -&gt; <span class="keyword">return</span> 返利收费(返利条件，返利值)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><p>定义了算法家族，将其分别封装，之间可相互替换，不影响算法使用者<br>将上面的收费对象定义为接口即可，在需要的时候继承再new生成创建对象实例<br>策略者模式将所有算法封装在接口中，调用时取用其子类生成的实例  </p><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>优点：<br>策略类层配合Const常量定义了可重用的方法，助于析取公共方法<br>简化单元测试</p><h1 id="装饰模式-Decoration-mode"><a href="#装饰模式-Decoration-mode" class="headerlink" title="装饰模式|Decoration mode"></a>装饰模式|Decoration mode</h1><p>动态的给一个对象添加一些额外的职责<br>//比生成子类更灵活  </p><p>通过继承原始类，覆写部分功能来实现</p><p>Component类<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">ComPonent</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Operation</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ConcreteComponent 类<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">ConcreteComponent</span>:<span class="title">Component</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Operation</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Console.WriteLine(<span class="string">"具体操作"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Decorator 类<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Decorator</span>:<span class="title">Component</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> Compenent component;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetComponent</span>(<span class="params">Compenent component</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.component=component;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Operation</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(component!=<span class="literal">null</span>)</span><br><span class="line">        component.Operation();<span class="comment">//实际执行我们放入的component的operation</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ConcreteDecoratorA-装饰实体类<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">ConcreteSecoratorA</span>:<span class="title">Decorator</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String addedState;          <span class="comment">//该类独有功能，不同于ConcreteSecoratorB</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Operation</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">base</span>.Operation();               <span class="comment">//先执行原component的operation,再执行本类的功能</span></span><br><span class="line">        addedState= <span class="string">"new star"</span>;</span><br><span class="line">        Console.WriteLine(<span class="string">"装饰对象A操作"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h2><p>装饰模式是为已有功能动态添加更多功能的方式。<br>每个装饰的功能再单独的类中，并包装了他所装饰的对象，可自由处理。</p><h1 id="代理模式-proxy"><a href="#代理模式-proxy" class="headerlink" title="代理模式 | proxy"></a>代理模式 | proxy</h1><p>代理接口<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">intface GiveGift&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">GiveDolls</span></span>()</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">GiveFlowers</span></span>()</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">GiveChocolate</span></span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>追求者类<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pursuit</span></span>(<span class="keyword">val</span> girls: Girl):GiveGift &#123; </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GiveDolls</span><span class="params">()</span></span> = println(<span class="string">"<span class="subst">$&#123;girls.name&#125;</span>  送你洋娃娃"</span>)</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GiveFlowers</span><span class="params">()</span></span>= println(<span class="string">"<span class="subst">$&#123;girls.name&#125;</span>  送你洋鲜花"</span>)</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GiveChocolate</span><span class="params">()</span></span> = println(<span class="string">"<span class="subst">$&#123;girls.name&#125;</span>  送你巧克力"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>代理类<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Proxy</span></span>(girl: Girl):GiveGift &#123;</span><br><span class="line">    <span class="keyword">val</span> gg=Pursuit(girl)</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GiveDolls</span><span class="params">()</span></span>=gg.GiveDolls()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GiveFlowers</span><span class="params">()</span></span> =gg.GiveFlowers()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GiveChocolate</span><span class="params">()</span></span>=gg.GiveChocolate()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>实现<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Proxy</span></span>(girl: Girl):GiveGift &#123;</span><br><span class="line">    <span class="keyword">val</span> gg=Pursuit(girl)</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GiveDolls</span><span class="params">()</span></span>=gg.GiveDolls()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GiveFlowers</span><span class="params">()</span></span> =gg.GiveFlowers()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GiveChocolate</span><span class="params">()</span></span>=gg.GiveChocolate()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>阿珍不认识追她的人，但是通过代理拿到了礼物</p><h2 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h2><p>代理模式为其他对象提供了一种代理以控制这个对象的访问</p><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>1.远程代理：为一个对象再不同地址空间提供局部代表。同时隐藏一个对象存在不同地址空间的事实。<br>2.虚拟代理：按需创建大开销对象，来预缓存真实对象。(如预加载缓存框)<br>3.安全代理：控制真实对象访问时权限。4.智能指引：调用当前实例对象时，同时代理处理一些别的事。</p><h1 id="工厂方法-Factory-Method"><a href="#工厂方法-Factory-Method" class="headerlink" title="工厂方法 | Factory Method"></a>工厂方法 | Factory Method</h1><h2 id="简单工厂VS工厂方法"><a href="#简单工厂VS工厂方法" class="headerlink" title="简单工厂VS工厂方法"></a>简单工厂VS工厂方法</h2><p>简单工厂下的计算器实现<img src="https://cdn.jsdelivr.net/gh/hongxii/ObjectServer0@1.0.0/src/20180828-设计模式 Design pattern/计算器的简单工厂结构.png" alt="avatar"></p><p>工厂方法下的计算器实现<img src="https://cdn.jsdelivr.net/gh/hongxii/ObjectServer0@1.0.0/src/20180828-设计模式 Design pattern/计算器的工厂方法结构.png" alt="avatar"></p><p>简单工厂的优点在于工厂类中包含了必要的判断逻辑，由客户端的条件去选择动态实例化。<br>例如计算器，如果只有‘+’，将‘+’给具体工厂，工厂会很快给出实例。<br>但是如果”求M数的N次方”功能，那么在运算工厂里需要加入case分支，违背了开放-封闭原则。<br>所以才有了工厂方法模式。<br>工厂方法克服了简单工厂违反开放-封闭原则的特点，又保持了封装对象创建过程的优点。<br>但是每加一个产品，就要加一个产品工厂的类，有额外的开发量增加。  </p><h1 id="原型模式-Prototype"><a href="#原型模式-Prototype" class="headerlink" title="原型模式 | Prototype"></a>原型模式 | Prototype</h1><p>用原型实例指定创建对象的种类，并通过拷贝这些原型创建新的对象。<br>其实就是从一个对象再创建另外一个可定制的对象，且不需知道创建细节。<br><img src="/2018/08/28/基础 Base/20180828 - 设计模式 Design pattern/原型模式结构图.png" alt="原型模式结构图"></p><h2 id="深浅复制"><a href="#深浅复制" class="headerlink" title="深浅复制"></a>深浅复制</h2><p>.Clone()方法会复制对象DataSet解构但不复制数据。(对象中的对象引用还是引用)<br>.Copy() 不止复制结构，也复制数据。<br>//kotlin中的clone需要原类型继承kotlin.Cloneable<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> : <span class="type">Cloneable &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">clone</span><span class="params">()</span></span>: Any &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="模板方法"><a href="#模板方法" class="headerlink" title="模板方法"></a>模板方法</h1><h2 id="Example-试卷复用与答案返回"><a href="#Example-试卷复用与答案返回" class="headerlink" title="Example-试卷复用与答案返回"></a>Example-试卷复用与答案返回</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">calss TestPaper&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">TestQuestion1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        plint(<span class="string">"第1题题干 选项：A,B,C,D"</span>)</span><br><span class="line">        plint(<span class="string">"答案=<span class="subst">$&#123;::Answer()&#125;</span>"</span>)   <span class="comment">//Answer来自以下方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">Answer1</span><span class="params">()</span></span>=<span class="string">"C"</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h2><p> 模板方法模式：定义一个操作中算法的骨架，将一些步骤延迟到子类中。<br> 模板方法使得子类可以不改变一个算法的结构即可重定义算法的某些特征步骤</p><h2 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h2><p>原始类<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractClass</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">PrimitiveOperation1</span><span class="params">()</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">PrimitiveOperation2</span><span class="params">()</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">TemplateMethond</span><span class="params">()</span></span>&#123;      <span class="comment">//模板方法-逻辑骨架，具体由子类去实现</span></span><br><span class="line">        PrimitiveOperation1()</span><br><span class="line">        PrimitiveOperation2()</span><br><span class="line">        plint(<span class="string">"done"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>实现类<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClassA</span>:<span class="type">AbstractClass&#123;</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">PrimitiveOperation1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">PrimitiveOperation2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">TemplateMethond</span><span class="params">()</span></span>&#123;</span><br><span class="line">        PrimitiveOperation1()</span><br><span class="line">        PrimitiveOperation2()</span><br><span class="line">        plint(<span class="string">"done"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>模板方法通过把不变行为搬移到超类，去除子类重复代码。<br>提供很好的代码复用平台。<br>当不变行为和可变行为再方法子类实现中混合在一起，不变行为会在子类中重复出现。模板方法可以将这些行为搬移到单一的地方，帮助子类摆脱重复不变形为的纠缠。</p><h1 id="外观模式-Facade"><a href="#外观模式-Facade" class="headerlink" title="外观模式 | Facade"></a>外观模式 | Facade</h1><p>为系统中一组接口提供一个一致的界面，此模式定义了一个高层接口，使得子系统增加易用。<br><img src="/2018/08/28/基础 Base/20180828 - 设计模式 Design pattern/外观模式.png" alt="外观模式"></p><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>子系统类<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSystem1</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Method1</span><span class="params">()</span></span>=print(<span class="string">"子系统方法1"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSystem2</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Method2</span><span class="params">()</span></span>=print(<span class="string">"子系统方法2"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSystem3</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Method3</span><span class="params">()</span></span>=print(<span class="string">"子系统方法3"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSystem4</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Method4</span><span class="params">()</span></span>=print(<span class="string">"子系统方法4"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>外观类<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Facade</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> subSystem1:SubSystem1</span><br><span class="line">    <span class="keyword">val</span> subSystem2:SubSystem2</span><br><span class="line">    <span class="keyword">val</span> subSystem3:SubSystem3</span><br><span class="line">    <span class="keyword">val</span> subSystem4:SubSystem4</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">MethodA</span><span class="params">()</span></span>&#123;</span><br><span class="line">        subSystem1.Method1()</span><br><span class="line">        subSystem2.Method2()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">MethodB</span><span class="params">()</span></span>&#123;</span><br><span class="line">        subSystem3.Method3()</span><br><span class="line">        subSystem4.Method4()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h2><p>外观模式，完美体现了依赖倒转原则和迪米特法则思想，是常用的设计模式。<br>1.设计初期，有意识的将不同层分离。(在数据访问层，业务逻辑层，表示层)进行外观逻辑包装。<br>2.开发阶段，因子系统太复杂可使用外观模式提供简单接口。<br>3.维护大型遗留系统，开发新的外观结构类，为老代码提供方便清晰的接口。  </p><h1 id="建造者模式-生成器模式-Builder"><a href="#建造者模式-生成器模式-Builder" class="headerlink" title="建造者模式 | 生成器模式 Builder"></a>建造者模式 | 生成器模式 Builder</h1><p><img src="/2018/08/28/基础 Base/20180828 - 设计模式 Design pattern/生成器模式.png" alt="建造者模式结构图"></p><h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>Product -产品，由多个部件组成<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> parts= MutableList&lt;String&gt;(<span class="number">0</span>,&#123;<span class="string">""</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Add</span><span class="params">(part:<span class="type">String</span>)</span></span>=parts.add(part)</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        println(<span class="string">"产品创建"</span>)</span><br><span class="line">        <span class="keyword">for</span> (part <span class="keyword">in</span> parts)</span><br><span class="line">            print(part+<span class="string">" |"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Builder - 抽象建造者 确定产品由A和B组成，声明得到产品建造后结果的方法<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> &#123;</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">BuildPartA</span></span>()</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">BuildPartB</span></span>()</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">GetResult</span></span>():Product</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ConcreteBuilder0,1 - 具体建造者类<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder0</span>:<span class="type">Builder</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> product=Product()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">BuildPartA</span><span class="params">()</span></span>&#123;</span><br><span class="line">        product.Add(<span class="string">"partA"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">BuildPartB</span><span class="params">()</span></span> &#123;</span><br><span class="line">        product.Add(<span class="string">"partB"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GetResult</span><span class="params">()</span></span>=product</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder1</span>:<span class="type">Builder</span></span>() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> product=Product()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">BuildPartA</span><span class="params">()</span></span>&#123;</span><br><span class="line">        product.Add(<span class="string">"partX"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">BuildPartB</span><span class="params">()</span></span> &#123;</span><br><span class="line">        product.Add(<span class="string">"partY"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GetResult</span><span class="params">()</span></span>=product</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Director - 指挥者<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Director</span></span>(builder:Builder) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Construct</span><span class="params">(builder:<span class="type">Builder</span>)</span></span>&#123;</span><br><span class="line">        builder.BuildPartA()</span><br><span class="line">        builder.BuildPartB()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>场景：<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> builder=ConcreteBuilder0()</span><br><span class="line">    <span class="keyword">val</span> builder1=ConcreteBuilder1()</span><br><span class="line">    <span class="keyword">val</span> director=Director(builder)</span><br><span class="line">    </span><br><span class="line">    director.Construct(builder)</span><br><span class="line">    <span class="keyword">val</span> p0=builder.GetResult()</span><br><span class="line">    p0.Show()</span><br><span class="line"></span><br><span class="line">    director.Construct(builder1)</span><br><span class="line">    <span class="keyword">val</span> p1=builder.GetResult()</span><br><span class="line">    p1.Show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>建造者模式是在<br>当<br>创建复杂对象的算法<br>    应该独立于该对象的组成部分及它们装配方式时<br>    适用的模式</p><h1 id="观察者模式-Publish-Subscribe"><a href="#观察者模式-Publish-Subscribe" class="headerlink" title="观察者模式 | Publish/Subscribe"></a>观察者模式 | Publish/Subscribe</h1><p>观察者模式是一种一对多的依赖关系，让多个观察者同时监听某一个主题对象。这个主题对象在状态发生变化时，会通知所有观察者对象,使它们能够自动更新自己。<br><img src="/2018/08/28/基础 Base/20180828 - 设计模式 Design pattern/观察者模式.png" alt="观察者模式"><br>具体的场景：老板回来了，前台通知同事别玩了<br><img src="/2018/08/28/基础 Base/20180828 - 设计模式 Design pattern/具体场景-老板回来了.png" alt="老板回来了"></p><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>Object:抽象观察者<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span></span>(</span><br><span class="line">    <span class="keyword">protected</span>  <span class="keyword">val</span> name: String,</span><br><span class="line">    <span class="keyword">protected</span>  <span class="keyword">val</span> sub: 主题通知</span><br><span class="line">)&#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> 更新<span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Subject: 主题,通知<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> 主题通知 </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> 增加观察者<span class="params">(观察者: <span class="type">Observer</span>)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> 移除观察者<span class="params">(观察者: <span class="type">Observer</span>)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> 通知<span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> 通知内容:String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Boss: 通知者之一(可为前台或老板)<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boss</span>:<span class="type">主题通知 &#123;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> 观察者列表=MutableList&lt;Observer&gt;(<span class="number">0</span>,&#123;ObserverStoker(<span class="string">""</span>,Boss())&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> 增加观察者<span class="params">(观察者: <span class="type">Observer</span>)</span></span> &#123;</span><br><span class="line">        观察者列表.add(观察者)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> 移除观察者<span class="params">(观察者: <span class="type">Observer</span>)</span></span> &#123;</span><br><span class="line">        观察者列表.remove(观察者)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> 通知<span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (ob <span class="keyword">in</span> 观察者列表) ob.更新()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> 通知内容=<span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>具体观察者:股民同事,球迷同事<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> 股民同事</span>(name:String, sub: 主题通知): Observer(name, sub) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> 更新<span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">"<span class="subst">$&#123;sub.通知内容&#125;</span> + <span class="variable">$name</span> 关闭股票行情,继续工作"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> 球迷同事</span>(name:String, sub: 主题通知): Observer(name,sub) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> 更新<span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">"<span class="subst">$&#123;sub.通知内容&#125;</span> + <span class="variable">$name</span> 关闭NBA直播,继续工作"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通知实现<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> 大BOSS=Boss()     <span class="comment">//老板</span></span><br><span class="line">    <span class="keyword">val</span> 韭菜=股民同事(<span class="string">"韭菜"</span>,大BOSS)  <span class="comment">//股民同事</span></span><br><span class="line">    <span class="keyword">val</span> 林书豪=股民同事(<span class="string">"林书豪"</span>,大BOSS)   <span class="comment">//NBA同事</span></span><br><span class="line"></span><br><span class="line">    大BOSS.增加观察者(林书豪)</span><br><span class="line">    大BOSS.增加观察者(韭菜)</span><br><span class="line"></span><br><span class="line">    大BOSS.移除观察者(韭菜)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//老板回来了</span></span><br><span class="line">    大BOSS.通知内容=<span class="string">"大BOSS回来了"</span></span><br><span class="line">    <span class="comment">//通知</span></span><br><span class="line">    大BOSS.通知()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>结果:<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"D:\Program Files\Java\jdk1.8.0_144\bin\java.exe"</span> </span><br><span class="line">大BOSS回来了 , 林书豪 关闭NBA直播,继续工作</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure></p><h2 id="结构-1"><a href="#结构-1" class="headerlink" title="结构"></a>结构</h2><p>抽象通知者<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> observers= MutableList&lt;Observer&gt;(<span class="number">0</span>,&#123;Observer1(Subject1(<span class="string">""</span>),<span class="string">""</span>)&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Attach</span><span class="params">(ob: <span class="type">Observer</span>)</span></span>&#123;</span><br><span class="line">        observers.add(ob)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Detach</span><span class="params">(ob: <span class="type">Observer</span>)</span></span>&#123;</span><br><span class="line">        observers.remove(ob)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Notify</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (o <span class="keyword">in</span> observers)</span><br><span class="line">            o.update()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>抽象观察者<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span>&#123;</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span></span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>具体通知者<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class Subject1(var <span class="keyword">state</span>:String) :Subject()</span><br></pre></td></tr></table></figure></p><p>具体观察者<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer1</span></span>(</span><br><span class="line">                <span class="keyword">private</span> <span class="keyword">val</span> subject: Subject1,</span><br><span class="line">                <span class="keyword">private</span> <span class="keyword">val</span> name:String        ):Observer() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> observerDo:String=<span class="string">""</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">()</span></span> &#123;</span><br><span class="line">            observerDo=subject.state</span><br><span class="line">            println(<span class="string">"观察者<span class="variable">$name</span> 的新状态是 <span class="variable">$observerDo</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>具体使用<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> s=Subject1(<span class="string">"ABC"</span>)</span><br><span class="line"></span><br><span class="line">    s.Attach(Observer1(s,<span class="string">"X"</span>))</span><br><span class="line">    s.Attach(Observer1(s,<span class="string">"Y"</span>))</span><br><span class="line">    s.Attach(Observer1(s,<span class="string">"Z"</span>))</span><br><span class="line"></span><br><span class="line">    s.Notify()</span><br><span class="line">&#125;</span><br><span class="line">****Out:</span><br><span class="line">    观察者X 的新状态是 ABC</span><br><span class="line">    观察者Y 的新状态是 ABC</span><br><span class="line">    观察者Z 的新状态是 ABC</span><br><span class="line">****</span><br></pre></td></tr></table></figure></p><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>   将一个系统分割成一系列相互协作的类有一个副作用,即需要维护相关对象的一致性,   如果我们为了维护一致性使各类紧密耦合,会给维护,扩展,重用带来不便.<br>   &emsp;&emsp;   观察者模式中,一个通知者可以有任意数目的观察者,并可以及时被通知.<br>   &emsp;&emsp;   Subject发出通知时不必知道谁是观察者,一个具体观察者也不需要知道其他观察者<br>场景:<br>    &emsp;&emsp;    1.当一个对象改变需要同时改变其他对象时,且不知道集体多少对象需要改变<br>    &emsp;&emsp;    2.当一个抽象模型有两方面,一方面依赖另一方面,此时观察者模式可以将这两者封装在独立的对象中使其独自改变和复用</p><h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p>   &emsp;&emsp;   观察者模式即解除耦合.让耦合的双方依赖抽象而非具体,从而使各自的变化都不会影响到另一边. </p><h2 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h2><p>&emsp;&emsp;    委托是一种引用方法的类型。一旦位委托分配了方法,委托将与该方法具有完全相同的行为。委托方法的使用可以像其他任何方法一样,具有参数和返回值。委托可以看作是对函数的抽象,是函数的’类,委托的实力将代表一个具体的函数。  </p><p>&emsp;&emsp;    一个委托可以搭载多个方法，所有方法被一次唤起，可以使得委托对象所搭载的方法并不需要属于同一个类。</p><h1 id="抽象工厂-AbstractFactory"><a href="#抽象工厂-AbstractFactory" class="headerlink" title="抽象工厂 | AbstractFactory"></a>抽象工厂 | AbstractFactory</h1><p>抽象工厂模式(Abstract Factory)：<br>&emsp;&emsp;    提供一个创建一系列相关或互相依赖对象的接口，而无需指定他们具体的类。</p><h2 id="场景-1"><a href="#场景-1" class="headerlink" title="场景"></a>场景</h2><p>&emsp;&emsp;    SQL读写数据场景<br>    不同sql数据库的sql语句不一，导致更换数据库和架构时的兼容改写<br>    使用简单工厂模式在两个数据库之间切换（SqlServer,Access）</p><h3 id="简单工厂"><a href="#简单工厂" class="headerlink" title="简单工厂"></a>简单工厂</h3><p><img src="/2018/08/28/基础 Base/20180828 - 设计模式 Design pattern/切换数据库-简单工厂模式.png" alt="数据库切换-简单工厂">  </p><p>IUser- 用于客户端访问，解除于具体数据库访问耦合<br>两个User用于 访问不同数据库的User</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>(<span class="keyword">var</span> id:<span class="built_in">Int</span>, <span class="keyword">var</span> name:String)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IUser</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Insert</span><span class="params">(user:<span class="type">User</span>)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">GetUser</span><span class="params">(id:<span class="type">Int</span>)</span></span>:User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSqlserver</span>:<span class="type">IUser&#123;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">Insert</span><span class="params">(user: <span class="type">User</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">"在SQL Server中给User表加一条记录"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GetUser</span><span class="params">(id:<span class="type">Int</span>)</span></span>:User &#123;</span><br><span class="line">        println(<span class="string">"在SQL Server中根据ID得到User表一条记录"</span>)</span><br><span class="line">        <span class="keyword">return</span> User(<span class="number">0</span>,<span class="string">""</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAccess</span>:<span class="type">IUser&#123;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">Insert</span><span class="params">(user: <span class="type">User</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">"在Access Server中给User表加一条记录"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GetUser</span><span class="params">(id:<span class="type">Int</span>)</span></span>:User &#123;</span><br><span class="line">        println(<span class="string">"在Access Server中根据ID得到User表一条记录"</span>)</span><br><span class="line">        <span class="keyword">return</span> User(<span class="number">0</span>,<span class="string">""</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IFactory -定义一个创建访问User表对象的抽象工厂接口<br>两个不同的Factory用于实例化上面对应的User<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IFactory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">CreateUser</span><span class="params">()</span></span>:IUser</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FactorySqlServer</span>:<span class="type">IFactory&#123;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">CreateUser</span><span class="params">()</span></span>: IUser &#123;</span><br><span class="line">        <span class="keyword">return</span> UserSqlserver()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FactoryAcess</span>:<span class="type">IFactory&#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">CreateUser</span><span class="params">()</span></span>: IUser &#123;</span><br><span class="line">        <span class="keyword">return</span> UserAccess()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>实现：<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> user=User(<span class="number">0</span>,<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> factory=FactorySqlServer()</span><br><span class="line"><span class="keyword">val</span> iu=factory.CreateUser()</span><br><span class="line"></span><br><span class="line">iu.Insert(user)</span><br><span class="line">iu.GetUser(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p><p>输出：</p><pre><code>输出在SQL Server中给User表加一条记录在SQL Server中根据ID得到User表一条记录</code></pre><h3 id="抽象工厂"><a href="#抽象工厂" class="headerlink" title="抽象工厂"></a>抽象工厂</h3><p><img src="/2018/08/28/基础 Base/20180828 - 设计模式 Design pattern/切换数据库-抽象工厂模式.png" alt="数据库切换-抽象工厂">  </p><p>IDepartment- 客户端访问，解除具体数据库耦合<br>两个不同的Depart用于访问具体的数据库<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span></span>(<span class="keyword">var</span> id: <span class="built_in">Int</span>, <span class="keyword">var</span> name: String)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IDepartment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">Insert</span><span class="params">(department: <span class="type">Department</span>)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">GetDepartment</span><span class="params">(id: <span class="type">Int</span>)</span></span>: Department</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DepartmentSqlServer</span> : <span class="type">IDepartment &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">Insert</span><span class="params">(department: <span class="type">Department</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">"在SQL Server中给Department表加一条记录"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GetDepartment</span><span class="params">(id: <span class="type">Int</span>)</span></span>: Department &#123;</span><br><span class="line">        println(<span class="string">"在SQL Server中根据ID得到Department表一条记录"</span>)</span><br><span class="line">        <span class="keyword">return</span> Department(<span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DepartmentAccess</span> : <span class="type">IDepartment &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">Insert</span><span class="params">(department: <span class="type">Department</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">"在Access Server中给Department表加一条记录"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">GetDepartment</span><span class="params">(id: <span class="type">Int</span>)</span></span>: Department &#123;</span><br><span class="line">        println(<span class="string">"在Access Server中根据ID得到Department表一条记录"</span>)</span><br><span class="line">        <span class="keyword">return</span> Department(<span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在IFactory中加入了Department工厂<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">CreateUser</span><span class="params">()</span></span>: IUser</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">CreateDepartment</span><span class="params">()</span></span>: IDepartment</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FactorySqlServer</span> : <span class="type">IFactory &#123;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">CreateUser</span><span class="params">()</span></span>: IUser &#123;</span><br><span class="line">        <span class="keyword">return</span> UserSqlserver()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">CreateDepartment</span><span class="params">()</span></span>: IDepartment &#123;</span><br><span class="line">        <span class="keyword">return</span> DepartmentSqlServer()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FactoryAcess</span> : <span class="type">IFactory &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">CreateUser</span><span class="params">()</span></span>: IUser &#123;</span><br><span class="line">        <span class="keyword">return</span> UserAccess()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">CreateDepartment</span><span class="params">()</span></span>: IDepartment &#123;</span><br><span class="line">        <span class="keyword">return</span> DepartmentAccess()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>处理端代码<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> user = User(<span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">val</span> department = Department(<span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> factory = FactoryAcess()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//以下已与具体的数据库访问解除了依赖</span></span><br><span class="line">    <span class="keyword">val</span> iu = factory.CreateUser()</span><br><span class="line">    iu.Insert(user)</span><br><span class="line">    iu.GetUser(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> id = factory.CreateDepartment()</span><br><span class="line">    id.Insert(department)</span><br><span class="line">    id.GetDepartment(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p><p>最终输出：  </p><pre><code>在Access Server中给User表加一条记录在Access Server中根据ID得到User表一条记录在Access Server中给Department表加一条记录在Access Server中根据ID得到Department表一条记录</code></pre><h2 id="结构-2"><a href="#结构-2" class="headerlink" title="结构"></a>结构</h2><p><img src="/2018/08/28/基础 Base/20180828 - 设计模式 Design pattern/抽象工厂结构图.png" alt="抽象工厂结构图"> &emsp;&emsp;    AbstractProductA与AbstractProductB是两个抽象产品，    因为他们都可能有几种不同实现，如场景中的User和Department；    ProductA1,ProductA2及ProductB1,ProductB2是对两个抽象产品的具体分类实现。    </p><p>&emsp;&emsp;    IFactory时抽象工厂接口，其内包含所有的产品创建抽象方法；    而ConcreteFactory1和ConcreteFactory2是具体的工厂，同场景中的FactoryAccess和FactorySqlServer。  </p><p>&emsp;&emsp;    通常在运行时创建具体工厂类，具体工厂类在创建具体特定实现的产品对象。    为了创建不同产品对象，可以使用不同具体工厂。    </p><h2 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h2><p>易于交换产品系列：<br>    每个具体工厂类只会在初始化时出现一次，故改变具体工厂十分容易。    只需改变具体工厂的即可使用不同的工厂配置。<br>实例化过程与controler分离：    controler通过其抽象接口草丛实例，产品具体类名由具体工厂实现分离。  </p><p>缺点：每增加一个抽象工厂，需在大部分文件中添加关系代码，工厂数量变大后难以管理。</p><h2 id="依赖注入-Dependency-Injection"><a href="#依赖注入-Dependency-Injection" class="headerlink" title="依赖注入 | Dependency Injection"></a>依赖注入 | Dependency Injection</h2>]]></content>
      
      
      <categories>
          
          <category> 基础 Base </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> ML </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kotlin隐性优化 Kotlin&#39;s hidden costs</title>
      <link href="/2018/08/08/%E8%99%9A%E6%8B%9F%E6%9C%BA%20Jvm/20180808-kotlin%E9%9A%90%E6%80%A7%E4%BC%98%E5%8C%96%20Kotlin&#39;s%20hidden%20costs/"/>
      <url>/2018/08/08/%E8%99%9A%E6%8B%9F%E6%9C%BA%20Jvm/20180808-kotlin%E9%9A%90%E6%80%A7%E4%BC%98%E5%8C%96%20Kotlin&#39;s%20hidden%20costs/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>越来越多的Java后端逐渐转向kotlin,因其有诸多方便的特性：空指针安全、方法扩展、函数式编程、大量语法糖等。我们初步使用时会使得我们的代码信雅达，有很高的可读和可维护性。但实际工程环境中使用我们会发现kotlin中有不少的隐形开销，而我们需要避免。<a id="more"></a></p><h2 id="Kotlin隐性开销优化"><a href="#Kotlin隐性开销优化" class="headerlink" title="Kotlin隐性开销优化"></a>Kotlin隐性开销优化</h2><h3 id="局部函数-Local-functions"><a href="#局部函数-Local-functions" class="headerlink" title="局部函数 Local functions"></a>局部函数 Local functions</h3><p>有时候我们会用常规语法在一些函数中声明函数，局部内部函数，我们这里叫他局部函数(local function)：</p><pre><code>fun someMath(a: Int): Int {    fun sumSquare(b: Int) = (a + b) * (a + b)    return sumSquare(1) + sumSquare(2)}</code></pre><p>首先我们要知道，局部函数无法声明为内联函数(inline)，同时包含该局部函数的主函数也不能声明为内联函数，这样会有很多非内联函数的限制，不可避免的要多一次函数调用。  </p><p>在编译之后，局部函数会被转换为Fuction对象，同lambda一样。我们看到编译后对应的Java代码：</p><pre><code>public static final int someMath(final int a) {   Function1 sumSquare$ = new Function1(1) {      // $FF: synthetic method      // $FF: bridge method      public Object invoke(Object var1) {         return Integer.valueOf(this.invoke(((Number)var1).intValue()));      }      public final int invoke(int b) {         return (a + b) * (a + b);      }   };   return sumSquare$.invoke(1) + sumSquare$.invoke(2);}</code></pre><p>其实与传统lambda相比，性能损失已经更少了，局部函数的最终实例是由其所在函数直接调用的，这样的调用避免了原始类型的强制转换或装箱处理。我们可以看到字节码：  </p><pre><code>ALOAD 1ICONST_1INVOKEVIRTUAL be/myapplication/MyClassKt$someMath$1.invoke (I)IALOAD 1ICONST_2INVOKEVIRTUAL be/myapplication/MyClassKt$someMath$1.invoke (I)IIADDIRETURN</code></pre><p>两次的方法调用都是直接返回int,中间没有任何拆箱操作。  </p><p>不过Function在每次方法调用期间依然要new对象,我们将主函数参数传进局部函数可以避免这种情况：</p><pre><code>fun someMath（a：Int）：Int {     fun sumSquare（a：Int，b：Int）=（a + b）*（a + b）    return sumSquare（a，1）+ sumSquare（a，2）}</code></pre><p>这样两个invoke间依然不会有类型转换或装箱。与私有函数相比，局部函数的唯一不足是在使用时会生成一个额外的类。</p><p><strong>本地函数是私有函数的替代函数，具有能够访问外部函数的局部变量的优势。但同时也伴随着外部函数的每次调用需要创建对象的隐藏成本，因此使用本地函数时需要添加其主函数参数来优化。</strong></p><h3 id="伴生对象-companion-object"><a href="#伴生对象-companion-object" class="headerlink" title="伴生对象 companion object"></a>伴生对象 companion object</h3><p>Kotlin中没有静态成员，而是通过伴生对象来实现。我们会在伴生对象中声明常量，可如果姿势不对，会产生额外开销。如以下version常量：<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getVersion</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Version</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> Version = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>如果将这一段转化成Java代码，会复杂很多：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> int Version = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Demo.Companion Companion = <span class="keyword">new</span> Demo.Companion();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> int getVersion() &#123;</span><br><span class="line">        <span class="keyword">return</span> Companion.access$getVersion$p(Companion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> int access$getVersion$cp() &#123;</span><br><span class="line">        <span class="keyword">return</span> Version;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Companion</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> int access$getVersion$p(Companion companion) &#123;</span><br><span class="line">            <span class="keyword">return</span> companion.getVersion();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> int getVersion() &#123;</span><br><span class="line">            <span class="keyword">return</span> Demo.access$getVersion$cp();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>如果在Java一般会直接读取常量，但上面这种写法会导致其经过下面4个方法拿到常量：<br>+调用伴生对象的静态方法<br>+调用伴生对象的实例方法<br>+调用主类的静态方法<br>+读取主类中的静态字段    </p><p>解决方案：<br>1.基本类型和字符串，可以使用const关键字将常量声明为编译时常量。<br>2.对于公共字段，可以使用@JvmField注解。<br>3.对于其他类型的常量，最好在主类对象中存储全局常量而不是伴生对象。   </p><h3 id="Lazy-委托属性-lazy-’s-Attr"><a href="#Lazy-委托属性-lazy-’s-Attr" class="headerlink" title="Lazy()委托属性  lazy()’s Attr"></a>Lazy()委托属性  lazy()’s Attr</h3><p>lazy()委托属性可以用于只读属性的惰性加载，但是在使用lazy()时经常被忽视的地方就是有一个可选的model参数:<br>+LazyThreadSafetyMode.SYNCHRONIZED：    初始化属性时会有双重锁检查，保证该值只在一个线程中计算，并且所有线程会得到相同的值。<br>+LazyThreadSafetyMode.PUBLICATION：    多个线程会同时执行，初始化属性的函数会被多次调用，但是只有第一个返回的值被当做委托属性的值。<br>+LazyThreadSafetyMode.NONE：没有双重锁检查，不应该用在多线程下。  </p><p>lazy()默认情况下会指定LazyThreadSafetyMode.SYNCHRONIZED，    这可能会造成不必要线程安全的开销，应该根据实际情况，指定合适的model来避免不需要的同步锁。</p><h3 id="基本数组-baseArr"><a href="#基本数组-baseArr" class="headerlink" title="基本数组 baseArr"></a>基本数组 baseArr</h3><p>在Kotlin中有3种数组类型：  </p><p>+IntArray，FloatArray，其他：基本类型数组，被编译成int[]，float[]，其他<br>+Array<t>：非空对象数组<br>+Array&lt;T?&gt;：可空对象数组<br> 我们使用这三种来声明数组，会发现区别：</t></p><pre><code>val a: IntArray = intArrayOf(1)val b: Array&lt;Int&gt; = arrayOf(1)val c: Array&lt;Int?&gt;=arrayOf(null)</code></pre><p>同等Java代码为：</p><pre><code>@NotNullprivate final int[] a = new int[]{1};@NotNullprivate final Integer[] b = new Integer[]{Integer.valueOf(1)};@NotNullprivate final Integer[] c = new Integer[]{(Integer)null};</code></pre><p>我们可以看到后两种数组创建时已经进行了自动装箱处理，我们声明非空基本数组时，只使用xxxArray就好，避免自动装箱。</p><h3 id="for循环函数"><a href="#for循环函数" class="headerlink" title="for循环函数"></a>for循环函数</h3><p>我们在kotlin的for循环中使用downTo、step、until、reversed等函数辅助简单的使用for循环。我们单独使用时确实简洁高效，但是相互调用呢？</p><pre><code>for (i in 10 downTo 1 step 2) {                println(i)}</code></pre><p>等同的Java代码</p><pre><code>public final void loop(){    IntProgression var10000 = RangesKit.step(RangesKt,downTo(10,1));    int i=var10000.getFirst();    int var2=var10000.getLast();    int var3=var10000.getStep();    if(var3&gt;0){        if(i&gt;var2){ return; }    } else if( i &lt; var2){        return;    }    while(i != var2){        i+= var3;    }}我们看到第二行已经多创建了两个IntProgresion 临时对象，增了了消耗。</code></pre><h3 id="Kotlin-检查工具"><a href="#Kotlin-检查工具" class="headerlink" title="Kotlin 检查工具"></a>Kotlin 检查工具</h3><p>工具简介：  </p><blockquote><p><a href="https://github.com/shyiko/ktlint" target="_blank" rel="noopener">ktlint</a>:检查kotlin代码风格，要使用需要大量改造。<br> <a href="https://github.com/arturbosch/detekt" target="_blank" rel="noopener">detekt</a>:静态分析kotlin代码，但也有缺陷（不能指定 [variant//变种] 检查,只支持控制台输出）。<br> lint //AndroidStuido 自带，可自定义检查规则</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 虚拟机 Jvm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> Java </tag>
            
            <tag> Kotlin </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>公私钥加密 Public/private keyEncryption</title>
      <link href="/2018/01/05/%E5%9F%BA%E7%A1%80%20Base/20180105-%E5%85%AC%E7%A7%81%E9%92%A5%E5%8A%A0%E5%AF%86%20keyEncryption/"/>
      <url>/2018/01/05/%E5%9F%BA%E7%A1%80%20Base/20180105-%E5%85%AC%E7%A7%81%E9%92%A5%E5%8A%A0%E5%AF%86%20keyEncryption/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文主要介绍密码学常用工具极其原理，包括不对称加密，加密算法，数字签名等内容<a id="more"></a></p><h2 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h2><h2 id="对称密码-symmetric-encryption"><a href="#对称密码-symmetric-encryption" class="headerlink" title="对称密码 symmetric encryption"></a>对称密码 symmetric encryption</h2><p>特点：<br>  加密和解密使用的是同一个密码<br>  加密后的密文只有该对称密码才能解密<br>别名：对称密码，私钥密码<br>例子：保险柜  </p><pre><code># 原文显卡，Gtx610# 约定一个密钥（不能被第三方知道）000111 # 把信息和对称密钥异或运算，得到密文101100</code></pre><p>我们可以将密文和密钥告知另一人，他用异或运算可获取原文。<br>但在使用中，加解密通常会使用分组密码多次迭代异或。常用的对称加密算法有DES与AES。</p><table><thead><tr><th></th><th>DES</th><th>AES</th></tr></thead><tbody><tr><td>密钥长度</td><td>56位</td><td>128, 192, 256 位</td></tr><tr><td>加密方式</td><td>对称分组密码</td><td>对称分组密码</td></tr><tr><td>加密轮数</td><td>16轮</td><td>128位10轮，192位12轮，256位14轮</td></tr><tr><td>安全性</td><td>被攻破</td><td>安全</td></tr><tr><td>速度</td><td>较慢</td><td>较快</td></tr></tbody></table><h2 id="密码配送-key-allocation"><a href="#密码配送-key-allocation" class="headerlink" title="密码配送 key allocation"></a>密码配送 key allocation</h2><p>对称密码最大的问题是密钥配送，如何约定只有传输者和接受者都知道并且足够长的密钥“000111”，任何得到这个密钥的人都能够解密信息。常用的解决方法有两种：</p><p>-使用密钥分配中心<br>1.A与B想要加密传输信息。<br>2.密钥分配中心为每个人都生成一个密钥。  </p><blockquote><p>A的密钥是000000<br>   B的密钥是111111</p></blockquote><p>3.当A,B准备传输信息时，分配中心会生成一个会话密钥。-&gt; 会话密钥=000111。4.分别用A,B密钥加密会话密钥，发送给A,B。</p><blockquote><p>“A，会话密钥通过你的密钥加密后是000111。”   “B，会话密钥通过你的密钥加密后是111000。”</p></blockquote><p>5.A,B用自己的密钥解密-&gt;得到会话密钥，再用会话密钥进行对称加密-&gt;传输信息，之后销毁会话密钥。<br>但该方法的缺点很明显：  </p><blockquote><p>需要密钥分配中心，不方便。   分配中心也会遇到密钥配送问题。   分配中心被攻破所有人都会很危险。</p></blockquote><h2 id="非对称密码-asymmetric-cryptographic"><a href="#非对称密码-asymmetric-cryptographic" class="headerlink" title="非对称密码 asymmetric cryptographic"></a>非对称密码 asymmetric cryptographic</h2><p>与对称密码不同，它包含一个公钥和私钥。<br>特点：<br>+公钥与私钥严格符合数学关系一一对应且不可互换<br>+公钥可公开发布，私钥必须自己保管，不可泄露<br>+公钥加密的内容只有对应的私钥才能解密，使用私钥签名的内容只有对应的公钥才能解密  </p><h4 id="注意-attention"><a href="#注意-attention" class="headerlink" title="注意 attention"></a>注意 attention</h4><p>虽然都用一样的分组迭代算法(AES，DES)，但是公钥对明文运算称为“加密”，私钥对明文运算称为“签名”。RSA算法中，公私钥的数学关系满足：</p><pre><code>公钥 * 私钥 mod L = 1</code></pre><p>以上可以看出公私钥可以互换，都能用一个加密，另外一个解密。<strong>但是，公钥在选取的时候需满足一些额外条件(如与L互质),所以使用公钥加密才符合严格的数学安全，而私钥“加密”不能。私钥只能用作签名，让持有公钥者来验证这条信息确实是私钥持有者认证过的，实际用作加密则安全性没有公钥高。</strong></p><h2 id="场景演化-test"><a href="#场景演化-test" class="headerlink" title="场景演化 test"></a>场景演化 test</h2><p>Sunkist，Cherry，Wing三个约一起见面。任意两个人沟通的内容，第三个人都可以听到。而且他们之间只能通过聊天沟通，不能通过肢体语言或者传纸条的方式交流。Sunkist与Cherry要如何传输信息而不被Wing发现？<br>两个步骤:<br><strong>1.商议密钥，要在Wing在旁边的情况下约定一个只有Sunkist与Cherry知道的密钥。<br>2.通过密钥把信息进行对称加密传输，这点很像上面提到的对称加密。</strong>  </p><p>假定该场景中三人只会乘法，不会除法。简称为Sunkist-Cherry算法：<br>1.让Sunkist与Cherry都确定一个算法（通常是公开的算法）。  </p><blockquote><p>Sunkist： “我会Diffie-Hellman算法和Sunkist-Cherry算法。”<br>   Cherry：“我只会Sunkist-Cherry算法，那我们就用这个算法吧。”<br>   Wing：“我知道你们要用Sunkist-Cherry算法了。”  </p></blockquote><p>2.Sunkist与Cherry分别选择一个私人数字，这个私人数字必须保密。</p><blockquote><p>Sunkist： “我不会告诉你我选择了什么数字。”（Sunkist选择了数字5，其他两人都不知道。）<br>  Cherry： “我不会告诉你我选择了什么数字。”（Cherry选择了数字10，其他两人都不知道。）<br>  Wing：“我知道你们要用Sunkist-Cherry算法了。”  </p></blockquote><p>3.共同选择一个数字，作为公有数字。</p><blockquote><p>Sunkist： “我们就选择数字2作为公有数字吧。”<br>   Cherry：“好的！”<br>   Wing：“你们要用Sunkist-Cherry算法，而且公有数字是2。”  </p></blockquote><p>4.Sunkist与Cherry分别把公有数字乘以自己的私人数字得到混合数字，然后告诉对方。</p><blockquote><p>Sunkist： “我的混合数字是10。”（5 <em> 2 = 10）<br>   Cherry： “我的混合数字是20。”（10 </em> 2 = 20）<br>   Wing：“你们要用Sunkist-Cherry算法，而且公有数字是2。   Sunkist的混合数字是10，Cherry的混合数字是20。”</p></blockquote><p>5.Sunkist与Cherry分别把私人数字与对方的混合数字相乘，得到最终的密钥</p><blockquote><p>Sunkist把私人数字5以及Cherry的混合数字20相乘得到100。<br>   Cherry把私人数字10以及Sunkist的混合数字10相乘得到100。  </p></blockquote><p><strong>整个过程中，公钥是2，最终商议出的密钥是100，Wing虽然知道Sunkist与Cherry聊天的全部内容，知道公有数字与它们的混合数字，但无法计算出密钥。</strong>  </p><p>Sunkist-Cherry算法利用了一个容易运算（乘法）但不可逆（除法）的数学技巧。在实际应用，我们最常使用Diffie–Hellman算法，它利用了基于有限域上的离散对数的性质。Sunkist-Cherry算法与Diffie-Hellman算法解决了当双方只能公开交换信息的时候商议密钥的问题。要注意，在这里的公私钥并不是用作互相加解密的。</p><p>非对称密码除了解决商议密钥的问题，还常常用来解决另外一个问题，例如使用RSA算法，生成一对一一对应的公私钥，经过公钥加密的内容只有私钥才能解密,通过私钥签名的内容通过公钥才能验证。在实际应用中，使用公钥加密，私钥解密用在SSH登录以及Https传输中，而私钥签名，公钥解密则用在数字签名中。</p><h2 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h2><p>Sunkist要找Cherry借钱，大家商议立一个借据。不过如果在无法见面的情况下，如何立借据并且证明这个借据是Sunkist写的呢？这里需要用到RSA算法，Sunkist使用RSA算法生成一对公私钥，把公钥公布在自己的网站上，然后把借据通过私钥签名，所有人都可以通过Sunkist的公钥尝试对签名后的内容解密，能解密成功则证明这个借据是Sunkist写的。使用数字签名有几个好处:</p><p>1.无需物理接触<br>2.容易验证，只需要用公钥去尝试解密就能验证。<br>3.防止Sunkist否认，因为公钥能解密的内容必定是对应的私钥加密的。  </p><p>但Cherry如何确定这个公钥是Sunkist的，当它要获取Sunkist的公钥的时候，有可能Sunkist的网站被黑了，被换作其他人的公钥了（中间人攻击）。要解决这个问题，我们可以使用数字证书来确保获取正确的公钥。</p><h2 id="数字证书"><a href="#数字证书" class="headerlink" title="数字证书"></a>数字证书</h2><p>数字证书的作用就是获取某人的正确公钥，首先我们需要一个中立可信的证书机构，它有点像注册中心，大家可以把自己的公钥放在它那里保管。当Cherry要获取Sunkist的公钥的时候：</p><p>Sunkist先向证书机构注册自己的公钥。Cherry向证书机构请求Sunkist的公钥。证书机构用自己的私钥把Sunkist的公钥进行签名后发送给Cherry，一般来说我们浏览器默认会存储了证书机构的公钥，使用证书机构的公钥把签名后信息解密，然后得到Sunkist的公钥。使用Sunkist的公钥把Sunkist发送的信息进行解密。这里有个信任链，我们默认信任了浏览器中的证书机构的公钥，证书机构信任了Sunkist提交的公钥。我们使用证书机构的公钥解密就能得到Sunkist正确的公钥。</p><h2 id="SSH登陆"><a href="#SSH登陆" class="headerlink" title="SSH登陆"></a>SSH登陆</h2><p>SSH登录有两种方式：</p><p>使用密码登录使用公钥登录SSH在第一次登录主机的时候，会有类似的信息：</p><p>The authenticity of host ‘host (12.18.429.21)’ can’t be established.RSA key fingerprint is 98:2e:d7:e0:de:9f:ac:67:28:c2:42:2d:37:16:58:4d.Are you sure you want to continue connecting (yes/no)?什么意思呢？主机会发送它的公钥指纹，你需要验证这个公钥是该主机的。确认之后，它们一开始都需要通过Diffie–Hellman算法商议密钥进行加密传输。然后再进入认证过程，之后的数据传输使用对称加密传输。其中密码登录方式的话直接使用对称加密验证密码。而使用公钥登录分为几个步骤</p><p>客户端使用非对称加密算法（RSA，椭圆曲线算法）生成一对公私钥对。客户端把公钥放在服务端的anthority_key文件中。客户端与服务端建立了加密通道之后，服务端会使用客户端的公钥随机加密一个信息然后发送给本机客户端用自己的私钥解密，并且返回信息。服务端认证返回的信息与随机生成的信息是否相同，相同则认证成功。</p><h2 id="Https传输"><a href="#Https传输" class="headerlink" title="Https传输"></a>Https传输</h2><p>Https和ssl握手的具体过程：</p><p>1.客户端的浏览器向服务器传送客户端 SSL 协议的版本号，加密算法的种类，产生的随机数，以及其他服务器和客户端之间通讯所需要的各种信息。<br>2.服务器向客户端传送 SSL 协议的版本号，加密算法的种类，随机数以及其他相关信息，同时服务器还将向客户端传送自己的证书。<br>3.客户利用服务器传过来的信息验证服务器的合法性，服务器的合法性包括：证书是否过期，发行服务器证书的 CA 是否可靠，发行者证书的公钥能否正确解开服务器证书的“发行者的数字签名”，服务器证书上的域名是否和服务器的实际域名相匹配。如果合法性验证没有通过，通讯将断开；如果合法性验证通过，将继续进行第四步。4.用户端随机产生一个用于后面通讯的“对称密码”，然后用服务器的公钥（服务器的公钥从步骤②中的服务器的证书中获得）对其加密，然后将加密后的“预主密码”传给服务器。….第三步，客户端就使用数字证书技术来获取网站的公钥。接下来就商议密钥进行对称加密传输。可以说，总的来说，Https传输是先使用非对称加密验证以及商议密钥，再经过对称加密传输数据的。</p><h2 id="API调用"><a href="#API调用" class="headerlink" title="API调用"></a>API调用</h2><p>我们使用第三方的API（例如七牛云，腾讯云的人工智能API），第三方为了验证调用是某个用户发起的，会提供一个公钥和一个私钥。这里的公钥和私钥并不是一一对应的，而是从两对公私钥中，分别取出一对的公钥与另外一对的私钥。</p><p>s-c3</p><p>剩下的公私钥由第三方保存。我们有两种方式使用这对公私钥：</p><p>客户端调用 我们把公钥放在客户端文件中（js文件，手机客户端），因为公钥是可以公开的，不用担心被窃取。调用的时候通过公钥把信息进行加密发到第三方，第三方用对应的私钥解密。</p><p>服务端调用 我们把私钥放在自己的服务端中。然后调用的时候通过私钥把信息进行签名发送给第三方，第三方用对应的公钥解密，如果能成功解密则代表验证成功。</p><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>-因为对称加密比非对称加密快得多。在实际应用例如Https传输，API调用，都是使用非对称加密验证以及商议密钥。然后通过密钥进行对称加密传输数据。<br>-公钥和私钥是符合严格数学关系的一对一对应，一个公钥有且只有一个对应的私钥。<br>-公钥加密的信息只有相应的私钥才能解密，私钥签名的内容只有相应的公钥才能解密。<br>-为了保证系统的保密性，虽然公私钥能互相加解密，但是公钥和私钥并不能交换使用。（不能把私钥当成公钥用，把公钥当成私钥用。）<br>-用公钥加密，私钥解密，通常用在数据传输协商对称密钥。或者进行少量信息传输与验证（SSH登录）<br>-用私钥签名-公钥解密通常用在数字签名中。（证明文件是由私钥拥有者认证的。）  </p><p>非对称加密中，公钥是可以公开的，只需要保管好私钥就好。</p>]]></content>
      
      
      <categories>
          
          <category> 基础 Base </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>字符串编码 StringCode</title>
      <link href="/2018/01/01/%E5%9F%BA%E7%A1%80%20Base/20180101-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BC%96%E7%A0%81%20StringCode/"/>
      <url>/2018/01/01/%E5%9F%BA%E7%A1%80%20Base/20180101-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BC%96%E7%A0%81%20StringCode/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一般遇到编码问题我们一两行代码就能解决，但有时需试错。这里细说一点原理来备忘，但遇到编码问题还是要试错。<br>原理：映射表选错。本文提一点映射表规范。<a id="more"></a></p><h2 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h2><h3 id="字符-char"><a href="#字符-char" class="headerlink" title="字符 char"></a>字符 char</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> D f</span><br></pre></td></tr></table></figure><p>以上三种，代表基本文字</p><h3 id="字符串-String"><a href="#字符串-String" class="headerlink" title="字符串 String"></a>字符串 String</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nice <span class="keyword">to</span> meet you</span><br></pre></td></tr></table></figure><p>多个字符组集合</p><h3 id="键值表-map"><a href="#键值表-map" class="headerlink" title="键值表 map"></a>键值表 map</h3><pre><code>y = x * 2</code></pre><p>每个x对应唯一y，x与y组成键值表(HashTable)，如：</p><pre><code>1 -&gt; 22 -&gt; 43 -&gt; 6</code></pre><h3 id="编码-amp-解码-cod-amp-decode"><a href="#编码-amp-解码-cod-amp-decode" class="headerlink" title="编码&amp;解码 cod &amp; decode"></a>编码&amp;解码 cod &amp; decode</h3><p>编码:字符串按照一定规则（map）转换成二进制存储。字符串”123”存起来，先要转换成”246”。实际存储的值：    </p><pre><code>0010 0100 0110</code></pre><p>字符串解码(decode)就是把二进制数据按一定规则转换成字符串显示。</p><h2 id="计算机数据存储-cache"><a href="#计算机数据存储-cache" class="headerlink" title="计算机数据存储 cache"></a>计算机数据存储 cache</h2><p>计算机都是以”0”或”1”存储的。如果要存储”GEB”，它会先转换成二进制再存储。我们使用EngineGo表，他用3位的二进制数字表示8种不同的字符。<br>EngineGo表：</p><table><thead><tr><th>二进制</th><th>字符</th><th>二进制</th><th>字符</th></tr></thead><tbody><tr><td>000</td><td>A</td><td>100</td><td>E</td></tr><tr><td>001</td><td>B</td><td>101</td><td>F</td></tr><tr><td>010</td><td>C</td><td>110</td><td>G</td></tr><tr><td>011</td><td>D</td><td>111</td><td>H</td></tr></tbody></table><p>我们在编辑器添加”GEB”字符串保存时，计算机根据EngineGo表存储数据</p><pre><code>110 100 001  G   E   B </code></pre><p>读取时，计算机会主动猜测应该使用哪个表来还原，假如它猜对了，使用EngineGo表还原，便会成功得到“GEB”。猜错了，就乱码了。</p><p>##ASCII编码ASCII编码由西方国家设计，用英文作常用字符集，包括大小写字母，数字加一些标点符号和运算符号约120个。3位二进制只能表示8个不同的字符，于是我们扩充位数，7位可以表示128个字符，加1位用错误检查。最终使用8位，称为一个字节。</p><table><thead><tr><th>编号</th><th>字符</th><th>编号</th><th>字符</th></tr></thead><tbody><tr><td>（省略）…</td><td>…</td><td>64</td><td>@</td></tr><tr><td>48</td><td>0</td><td>65</td><td>A</td></tr><tr><td>49</td><td>1</td><td>66(1000010)</td><td>B</td></tr><tr><td>50</td><td>2</td><td>67</td><td>C</td></tr><tr><td>51</td><td>3</td><td>68</td><td>D</td></tr><tr><td>52</td><td>4</td><td>69(1000101)</td><td>E</td></tr><tr><td>53</td><td>5</td><td>70</td><td>F</td></tr><tr><td>54</td><td>6</td><td>71(01100111)</td><td>G</td></tr><tr><td>55</td><td>7</td><td>72</td><td>H</td></tr><tr><td>56</td><td>8</td><td>73</td><td>I</td></tr><tr><td>57</td><td>9</td><td>74</td><td>J</td></tr><tr><td>58</td><td>:</td><td>75</td><td>K</td></tr><tr><td>59</td><td>;</td><td>76</td><td>L</td></tr><tr><td>60</td><td>&lt;</td><td>77</td><td>M</td></tr><tr><td>61</td><td>=</td><td>78</td><td>N</td></tr><tr><td>62</td><td>&gt;</td><td>79</td><td>O</td></tr><tr><td>63</td><td>?</td><td>（省略）…</td><td>…</td></tr></tbody></table><p>此时“GEB”被存储为：</p><pre><code>01100111 1000101 1000010      B       E       B</code></pre><h2 id="GBK编码"><a href="#GBK编码" class="headerlink" title="GBK编码"></a>GBK编码</h2><p>但ASCII编码容量只有128。遇到中文无法处理，故国内使用GBK编码（一张更大的表）。GBK是可变长度的编码，为兼容ASCII编码，使用了单、双字节编码和双字节编码，小于127的字符，同ASCII表，大于127的，两个字节表示一个汉字。故处理英文字符串时，和使用ASCII表存储的二进制数据一样。  </p><p>但处理中文时，如存储”你好”，GBK编码会把这个字符串编码成：</p><pre><code>11000100 11100011 10111010 11000011</code></pre><p>“你”和”好”这分别用两个字节保存。此时使用ASCII编码保存就会报错，因ASCII编码中无”你”和”好”对应值。      </p><p>我们用GBK码保存文件，如果包含中文，别人使用ASCII就无法解码。GBK文件只存ASCII码字符，解码时也正确，一般在文档中注明编码，打开时用对应的解码就好，但若文档中无编码信息，计算机就会猜测这是什么编码。即使是中文，还有繁体中文，简体中文类别。即使知道文档是中文，也不知道用哪个中文编码才能正确打开。</p><h2 id="Unicode编码"><a href="#Unicode编码" class="headerlink" title="Unicode编码"></a>Unicode编码</h2><p>其实最简单方法是，用很多二进制位来存储世界上所有字符。<br>Unicode便是如此，它把每个国家的字符都编进去。如你好，对应 U+4F60 U+597D。不同于其他编码，Unicode只是一个标准，规定了表现形式，而编码和解码则有其他方式。  </p><p>Unicode中每个字符都定义了对应表现形式：</p><pre><code>4f60 597d你   好</code></pre><p>Unicode只指定表示形式，存储形式可据需选择。如果每个字符都保存为4字节二进制（你好==00004f60，0000597d），这就是UTF-32编码。已经可以用4个字节表达所有字符，没有其他技术问题。</p><h2 id="UTF-8编码"><a href="#UTF-8编码" class="headerlink" title="UTF-8编码"></a>UTF-8编码</h2><p>但传输”A”字符，用UTF-32要用4个字节。而ASCII只要一个字节，这样会浪费存储空间和减缓传输速度。UTF-8为减少存储，将常用字符（英文）用一个字节表示（ASCII），其他用两到四个字节表示。</p><p>UTF-8 UTF-32 对比</p><table><thead><tr><th>character</th><th>encoding</th><th>bits</th><th>character</th></tr></thead><tbody><tr><td>A</td><td>ASCII</td><td>01000001</td><td>A</td></tr><tr><td>A</td><td>Unicode</td><td>10011110 01000001(U+0041)</td><td>A</td></tr><tr><td>A</td><td>UTF-32</td><td>00000000 00000000 00000000 01000001</td><td>A</td></tr><tr><td>A</td><td>UTF-8</td><td>01000001</td><td>A</td></tr><tr><td>你</td><td>ASCII</td><td>无法表示</td><td>你</td></tr><tr><td>你</td><td>Unicode</td><td>1001111 01100000(U+4f60)</td><td>你</td></tr><tr><td>你</td><td>UTF-32</td><td>00000000 00000000 10011110 01100000</td><td>你</td></tr><tr><td>你</td><td>UTF-8</td><td>11100100 10111101 10100000(e4bda0)</td><td>你</td></tr><tr><td>character</td><td>encoding</td><td>bits</td><td>character</td></tr><tr><td>A</td><td>ASCII</td><td>01000001</td><td>A</td></tr><tr><td>A</td><td>Unicode</td><td>10011110 01000001(U+0041)</td><td>A</td></tr><tr><td>58</td><td>:</td><td>75</td><td>K</td></tr><tr><td>59</td><td>;</td><td>76</td><td>L</td></tr><tr><td>60</td><td>&lt;</td><td>77</td><td>M</td></tr><tr><td>61</td><td>=</td><td>78</td><td>N</td></tr><tr><td>62</td><td>&gt;</td><td>79</td><td>O</td></tr><tr><td>63</td><td>?</td><td>（省略）…</td><td>…</td></tr></tbody></table><p>使用UTF-8编码后，”A”只要一个字节，汉字”你”从4个字节减少为3个。Unicode转换成UTF-8非只要一张转换表：</p><p>Unicode范围    转换规则</p><table><thead><tr><th>Unicode范围</th><th>转换规则</th></tr></thead><tbody><tr><td>0x00000000 - 0x0000007F</td><td>0xxxxxxx</td></tr><tr><td>0x00000080 - 0x000007FF</td><td>110xxxxx 10xxxxxx</td></tr><tr><td>0x00000800 - 0x0000FFFF</td><td>1110xxxx 10xxxxxx 10xxxxxx</td></tr><tr><td>0x00010000 - 0x001FFFFF</td><td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td></tr></tbody></table><p>以”你”为例，Unicode编码是U+4f60，对应第三列（07FF&lt;4f60&lt;FFFF），对比右边转换规则。把4f60的二进制1001111 01100000从右到左填入转换规则的x中，空的填0。</p><pre><code>1001111 01100000 -&gt; 1110xxxx 10xxxxxx 10xxxxxx -&gt; 11100100 10111101 10100000</code></pre><p>最后得到的11100100 10111101 10100000(e4bda0)也就是”你”的UTF-8编码了。</p><h2 id="HTML实体编码"><a href="#HTML实体编码" class="headerlink" title="HTML实体编码"></a>HTML实体编码</h2><p>浏览器解析HTML的时候会把特殊的字符串理解成非字面的含义，所以当需要显示这些特殊字符串的时候，需要经过下表的转换：</p><table><thead><tr><th>显示结果</th><th>描述</th><th>实体名称</th><th>实体编号</th></tr></thead><tbody><tr><td>空格</td><td>&nbsp;</td><td>&#160;</td><td>空格</td></tr><tr><td>&lt;</td><td>小于号</td><td>&lt;</td><td>&#60;</td></tr><tr><td>&gt;</td><td>大于号</td><td>&gt;</td><td>&#62;</td></tr><tr><td>&amp;</td><td>和</td><td>&amp;</td><td>&#38;</td></tr><tr><td>“</td><td>双引号</td><td>&quot;</td><td>&#34;</td></tr><tr><td>‘</td><td>单引号</td><td>&apos;</td><td>&#39;</td></tr><tr><td>′</td><td>重音符</td><td>&acute;</td><td>&#96;</td></tr><tr><td>©</td><td>版权</td><td>&copy;</td><td>&#169;</td></tr><tr><td>®</td><td>注册商标</td><td>&reg;</td><td>&#174;</td></tr><tr><td>™</td><td>商标</td><td>&trade;</td><td>&#8482;</td></tr><tr><td>你</td><td>中文</td><td>&#x4F60;</td><td>&#x4F60;或&amp;#20320</td></tr><tr><td>好</td><td>中文</td><td>&#x597D;</td><td>&#x597D;或&amp;#22909</td></tr></tbody></table><p>从上表可以看到，特殊字符串是强制需要转换的，而且实际上，所有字符都可以经过转换表示，只需要用</p><pre><code>&amp;#x加上其16进制Unicode编码或者&amp;#加上其10进制Unicode编码</code></pre><p>作为实体编号即可，浏览器既能解析字符串本身，也能解析其UTF-8编码。</p><h2 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h2><p>RFC3986中规定了URI中不能出现</p><pre><code>: / ? # [ ] @ ! $ &amp; &apos; ( ) * + , ; = </code></pre><p>当表示这些时，使用%加该字符的16进制UTF-8编码表示，出现非ASCII表的字符也一样，例如在浏览器输入</p><pre><code>https://io.hongxi.io/你好</code></pre><p>浏览器会自动把不合规定的字符转换成%加UTF-8编码再进行请求（地址栏还是显示原本”你好”），当你粘贴在文本编辑器的时候就可以看到原本的URL变成：</p><pre><code>https://io.hongxi.io/%E4%BD%A0%E5%A5%BD</code></pre><p>这里可以看到”你好”使用了它的UTF-8编码表示</p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>单纯从二进制数据是无法判断用什么编码存储的。但也有用AI来判断的，结果很出色。</p>]]></content>
      
      
      <categories>
          
          <category> 基础 Base </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> ML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V2ray-从移动到移不动</title>
      <link href="/2018/01/01/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/%E7%BD%91%E8%B7%AF/20180101-V2ray-%E4%BB%8E%E7%A7%BB%E5%8A%A8%E5%88%B0%E7%A7%BB%E4%B8%8D%E5%8A%A8/"/>
      <url>/2018/01/01/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/%E7%BD%91%E8%B7%AF/20180101-V2ray-%E4%BB%8E%E7%A7%BB%E5%8A%A8%E5%88%B0%E7%A7%BB%E4%B8%8D%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>V2ray同shadowssocks一样同为代理软件<br>在不同设备间 的目标进行通信 相互各自为节点<br>相互代理<br><a id="more"></a></p><h2 id="执行脚本"><a href="#执行脚本" class="headerlink" title="执行脚本"></a>执行脚本</h2><p>该脚本自动安装unzip和daemon<br>(go.sh)[<a href="https://install.direct/go.sh]" target="_blank" rel="noopener">https://install.direct/go.sh]</a></p><h2 id="配置及使用"><a href="#配置及使用" class="headerlink" title="配置及使用"></a>配置及使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">配置修改：</span><br><span class="line">vim /etc/v2ray/config.json  </span><br><span class="line"></span><br><span class="line">运行：</span><br><span class="line">service v2ray start|stop|status|reload|restart|force-reload</span><br></pre></td></tr></table></figure><p>重新执行一遍安装脚本就可以更新了</p><h2 id="多用户"><a href="#多用户" class="headerlink" title="多用户"></a>多用户</h2><p>更改clients中的json 对象数</p><h2 id="Linux检查json-格式"><a href="#Linux检查json-格式" class="headerlink" title="Linux检查json 格式"></a>Linux检查json 格式</h2><p>jq . config.json</p><h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      "port": 1080, // 监听端口</span><br><span class="line">      "protocol": "socks", // 入口协议为 SOCKS 5</span><br><span class="line">      "sniffing": &#123;</span><br><span class="line">        "enabled": true,</span><br><span class="line">        "destOverride": ["http", "tls"]</span><br><span class="line">      &#125;,</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "auth": "noauth"  //socks的认证设置，noauth 代表不认证，由于 socks 通常在客户端使用，所以这里不认证</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      "protocol": "vmess", // 出口协议</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "vnext": [</span><br><span class="line">          &#123;</span><br><span class="line">            "address": "serveraddr.com", // 服务器地址，请修改为你自己的服务器 IP 或域名</span><br><span class="line">            "port": 16823,  // 服务器端口</span><br><span class="line">            "users": [</span><br><span class="line">              &#123;</span><br><span class="line">                "id": "b831381d-6324-4d53-ad4f-8cda48b30811",  // 用户 ID，必须与服务器端配置相同</span><br><span class="line">                "alterId": 64 // 此处的值也应当与服务器相同</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端配置中的 inbounds，port 为 1080，即 V2Ray 监听了一个端口 1080，协议是 socks。之前我们已经把浏览器的代理设置好了（SOCKS Host: 127.0.0.1，Port: 1080），假如访问了 google.com，浏览器就会发出一个数据包打包成 socks 协议发送到本机（127.0.0.1指的本机，localhost）的 1080 端口，这个时候数据包就会被 V2Ray 接收到。  </p><p>再看 outbounds，protocol 是 vmess，说明 V2Ray 接收到数据包之后，要将数据包打包成 VMess 协议并且使用预设的 id 加密（这个例子 id 是 b831381d-6324-4d53-ad4f-8cda48b30811），然后发往服务器地址为 serveraddr.com 的 16823 端口。服务器地址 address 可以是域名也可以是 IP，只要正确就可以了。在客户端配置的 inbounds 中，有一个 “sniffing” 字段，V2Ray 手册解释为“流量探测，根据指定的流量类型，重置所请求的目标”。这话不太好理解，简单说这东西就是从网络流量中识别出域名。这个 sniffing 有两个用处：</p><p>1.解决 DNS 污染；2.对于 IP 流量可以应用后文提到的域名路由规则；识别 BT 协议，根据自己的需要拦截或者直连 BT 流量(后文有一节专门提及)。如果这段话不懂，没关系，照着写吧。</p><p>##服务器配置</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      "port": 16823, // 服务器监听端口</span><br><span class="line">      "protocol": "vmess",    // 主传入协议</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "clients": [</span><br><span class="line">          &#123;</span><br><span class="line">            "id": "b831381d-6324-4d53-ad4f-8cda48b30811",  // 用户 ID，客户端与服务器必须相同</span><br><span class="line">            "alterId": 64</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      "protocol": "freedom",  // 主传出协议</span><br><span class="line">      "settings": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着看服务器，服务器配置的 id 是 b831381d-6324-4d53-ad4f-8cda48b30811，所以 V2Ray 服务器接收到客户端发来的数据包时就会尝试用 b831381d-6324-4d53-ad4f-8cda48b30811 解密，如果解密成功再看一下时间对不对，对的话就把数据包发到 outbound 去。  </p><p>outbound.protocol 是 freedom（freedom 的中文意思是自由，在这里姑且将它理解成直连吧），数据包就直接发到 google.com 了。  </p><p>实际上数据包的流向就是：<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;浏览器&#125; &lt;--<span class="function"><span class="params">(socks)</span>--&gt;</span> &#123;V2Ray 客户端 inbound &lt;<span class="function">-&gt;</span> V2Ray 客户端 outbound&#125; &lt;--<span class="function"><span class="params">(VMess)</span>--&gt;</span>  &#123;V2Ray 服务器 inbound &lt;<span class="function">-&gt;</span> V2Ray 服务器 outbound&#125; &lt;--<span class="function"><span class="params">(Freedom)</span>--&gt;</span> &#123;目标网站&#125;</span><br></pre></td></tr></table></figure></p><p>配置中还有一个 alterId 参数，这个参数主要是为了加强防探测能力。<br>理论上 alterId 越大越好，但越大就约占内存(只针对服务器，客户端不占内存)，所以折中之下设一个中间值才是最好的。那么设多大才是最好的？其实这个是分场景的，我没有严格测试过这个，不过根据经验，alterId 的值设为 30 到 100 之间应该是比较合适的。alterId 的大小要保证客户端的小于等于服务器的。</p><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>无论是客户端还是服务器，配置文件都由两部分内容组成： inbounds 和 outbounds。<br>V2Ray 没有使用常规代理软件的 C/S（即客户端/服务器）结构，它既可以当做服务器也可以作为客户端。<br>于是我们可以从另一个角度来理解，认为每一个 V2Ray 都是一个节点，inbound 是关于如何与上一个节点连接的配置，outbound 是关于如何与下一个节点连接的配置。<br>对于第一个节点，inbound 与浏览器连接；对于最后一个节点，outbound与目标网站连接。<br>inbounds 和 outbounds 是 inbound 和 outbound 的集合，意味着每一个 V2Ray 节点都可以有多个入口和出口。<br>本例当中的入口和出口都只有一个，这是为了便于说明和理解。</p><p>##注意id 为 UUID 格式，请使用软件生成，不要尝试自己造一个，否则很大程度上造出一个错误的格式来。VMess 协议可以设定加密方式，但 VMess 不同的加密方式对于过墙没有明显差别，本节没有给出相关配置方式（因为这不重要，默认情况下 VMess 会自己选择一种比较合适的加密方式），具体配置可见 V2Ray 手册，不同加密方式的性能可参考性能测试。</p><h2 id="shadowsocks的客户端和服务端设置"><a href="#shadowsocks的客户端和服务端设置" class="headerlink" title="shadowsocks的客户端和服务端设置"></a>shadowsocks的客户端和服务端设置</h2><p>因为协议漏洞，Shadowsocks 已放弃 OTA(一次认证) 转而使用 AEAD，V2Ray 的 Shadowsocks 协议已经跟进 AEAD，但是仍然兼容 OTA。建议使用 AEAD (method 为 aes-256-gcm、aes-128-gcm、chacha20-poly1305 即可开启 AEAD), 使用 AEAD 时 OTA 会失效。  </p><p>可以使用 V2Ray 的传输层配置（详见高级篇），但如果这么设置了将与原版 Shadowsocks 不兼容（兼容 Shadowsocks 新增的 v2ray-plugin插件)。</p><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      "port": 1080, // 监听端口</span><br><span class="line">      "protocol": "socks", // 入口协议为 SOCKS 5</span><br><span class="line">      "sniffing": &#123;</span><br><span class="line">        "enabled": true,</span><br><span class="line">        "destOverride": ["http", "tls"]</span><br><span class="line">      &#125;,</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "auth": "noauth"  // 不认证</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"shadowsocks"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"servers"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            "address": "serveraddr.com", // Shadowsocks 的服务器地址</span><br><span class="line">            "method": "aes-128-gcm", // Shadowsocks 的加密方式</span><br><span class="line">            "ota": true, // 是否开启 OTA，true 为开启</span><br><span class="line">            "password": "sspasswd", // Shadowsocks 的密码</span><br><span class="line">            "port": 1024  </span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      "port": 1024, // 监听端口</span><br><span class="line">      "protocol": "shadowsocks",</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "method": "aes-128-gcm",</span><br><span class="line">        "ota": true, // 是否开启 OTA</span><br><span class="line">        "password": "sspasswd"</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,  </span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h2><p>在与 “inbounds” 与 “outbounds” 同级元素中加入以下json对象<br>客户端与服务端均可加入<br>windows路径：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"log": &#123;</span><br><span class="line">    "loglevel": "warning", // 日志级别</span><br><span class="line">    "access": "D:\\v2ray\\access.log",  // 这是 Windows 系统的路径</span><br><span class="line">    "error": "D:\\v2ray\\error.log"</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p><p>linux路径：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"log": &#123;</span><br><span class="line">    "loglevel": "warning",</span><br><span class="line">    "access": "/var/log/v2ray/access.log", // 这是 Linux 的路径</span><br><span class="line">    "error": "/var/log/v2ray/error.log"</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><h3 id="log选项"><a href="#log选项" class="headerlink" title="log选项"></a>log选项</h3><p>　loglevel：日志级别，分别有5个，本例中设定的是 warning　　　debug：最详细的日志信息，专用于软件调试　　　info：比较详细的日志信息，可以看到 V2Ray 详细的连接信息　　　warning：警告信息。轻微的问题信息，经我观察 warning 级别的信息大多是网络错误。推荐使用 warning　　　error：错误信息。比较严重的错误信息。当出现 error 时该问题足以影响 V2Ray 的正常运行　　　none：空。不记录任何信息　　　access：将访问的记录保存到文件中，这个选项的值是要保存到的文件的路径　　　error：将错误的记录保存到文件中，这个选项的值是要保存到的文件的路径　　　error、access 字段留空，并且在手动执行 V2Ray 时，V2Ray 会将日志输出在 stdout 即命令行中（terminal、cmd 等），便于排错　　</p><h2 id="路由功能（客户端）"><a href="#路由功能（客户端）" class="headerlink" title="路由功能（客户端）"></a>路由功能（客户端）</h2><p>转向V2ray的outbounds<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">"outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"serveraddr.com"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">16823</span>,  </span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,  </span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure></p><p>直连的outbounds<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">"outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      "protocol": "freedom", //原来是 VMess，现在改成 freedom</span><br><span class="line">      "settings": &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>原有的流向<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;浏览器&#125; &lt;--(socks)--&gt; &#123;V2Ray 客户端 inbound &lt;-&gt; V2Ray 客户端 outbound&#125; &lt;--(VMess)--&gt;  &#123;V2Ray 服务器 inbound &lt;-&gt; V2Ray 服务器 outbound&#125; &lt;--(Freedom)--&gt; &#123;目标网站&#125;</span><br></pre></td></tr></table></figure></p><p>直连的流向<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;浏览器&#125; &lt;--(socks)--&gt; &#123;V2Ray 客户端 inbound &lt;-&gt; V2Ray 客户端 outbound&#125; &lt;--(Freedom)--&gt; &#123;目标网站&#125;</span><br></pre></td></tr></table></figure></p><p>阻止用的outbounds - 来什么吞掉什么<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"blackhole"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>多个出口配置<br>同时配置多个出口时会默认使用第一个出口设置<br>下文会讲如何有选择地进行路由配置<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"log"</span>: &#123;</span><br><span class="line">    <span class="attr">"loglevel"</span>: <span class="string">"warning"</span>,</span><br><span class="line">    <span class="attr">"access"</span>: <span class="string">"D:\\v2ray\\access.log"</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"D:\\v2ray\\error.log"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">1080</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"socks"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"auth"</span>: <span class="string">"noauth"</span>  </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [ </span><br><span class="line">    &#123;</span><br><span class="line">      "protocol": "vmess", // 出口协议</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "vnext": [</span><br><span class="line">          &#123;</span><br><span class="line">            "address": "serveraddr.com", // 服务器 IP 地址</span><br><span class="line">            "port": 16823,  // 服务器端口</span><br><span class="line">            "users": [</span><br><span class="line">              &#123;</span><br><span class="line">                "id": "b831381d-6324-4d53-ad4f-8cda48b30811",  // 用户 ID，须与服务器端配置相同</span><br><span class="line">                "alterId": 64</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"blackhole"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="国内直连"><a href="#国内直连" class="headerlink" title="国内直连"></a>国内直连</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"log"</span>: &#123;</span><br><span class="line">    <span class="attr">"loglevel"</span>: <span class="string">"warning"</span>,</span><br><span class="line">    <span class="attr">"access"</span>: <span class="string">"D:\\v2ray\\access.log"</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"D:\\v2ray\\error.log"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">1080</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"socks"</span>,</span><br><span class="line">      <span class="attr">"sniffing"</span>: &#123;</span><br><span class="line">        <span class="attr">"enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"destOverride"</span>: [<span class="string">"http"</span>, <span class="string">"tls"</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"auth"</span>: <span class="string">"noauth"</span>,</span><br><span class="line">        <span class="attr">"udp"</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"serveraddr.com"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">16823</span>,  </span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"direct"</span> //如果要使用路由，这个 tag 是一定要有的，在这里 direct 就是 freedom 的一个标号，在路由中说 direct V2Ray 就知道是这里的 freedom 了</span><br><span class="line">    &#125;    </span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"routing"</span>: &#123;</span><br><span class="line">    <span class="attr">"domainStrategy"</span>: <span class="string">"IPOnDemand"</span>,</span><br><span class="line">    <span class="attr">"rules"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">        <span class="attr">"domain"</span>: [<span class="string">"geosite:cn"</span>] // 中国大陆主流网站的域名</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">        <span class="attr">"ip"</span>: [</span><br><span class="line">          <span class="string">"geoip:cn"</span>, // 中国大陆的 IP</span><br><span class="line">          <span class="string">"geoip:private"</span> // 私有地址 IP，如路由器等</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重点在 rules，我们要设置的路由规则就放在这里，注意这是一个数组，也就是说可以设置多个路由规则当访问一个网站，数据包进入 V2Ray 之后路由就会先看看有没有能够匹配的规则，然后执行规则。  </p><p>在rules 数组中的每个规则由一组大括号{ }扩起来。规则中的 type 是固定的(也就是照抄就行)， 两个规则分别有 “domain”: [“geosite:cn”] 和 “ip”: [“geoip:cn”]，这两个分别包含了中国大陆主流网站大部分域名和几乎所有的 ip。两个规则的 outboundTag 都是 direct （outbounds 中 tag 为 direct 的是 freedom）那么如果访问了国内的网站路由就会将这个数据包发往 freedom，也就是直连了。  </p><p>这个例子当中路由规则仍然可以访问 google.com、twitter.com 这类等众多被墙的网站的。因为 outbounds 中的第一个出口协议是作为默认的出口，当一个数据包没有匹配的规则时，路由就会把数据包发往默认出口.在本例中 VMess 位于 outbounds 中的第一个，即不是访问中国大陆网站的数据包将通过 VPS 代理。  </p><h3 id="广告过滤"><a href="#广告过滤" class="headerlink" title="广告过滤"></a>广告过滤</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"log"</span>: &#123;</span><br><span class="line">    <span class="attr">"loglevel"</span>: <span class="string">"warning"</span>,</span><br><span class="line">    <span class="attr">"access"</span>: <span class="string">"D:\\v2ray\\access.log"</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"D:\\v2ray\\error.log"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">1080</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"socks"</span>,</span><br><span class="line">      <span class="attr">"sniffing"</span>: &#123;</span><br><span class="line">        <span class="attr">"enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"destOverride"</span>: [<span class="string">"http"</span>, <span class="string">"tls"</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"auth"</span>: <span class="string">"noauth"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"serveraddr.com"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">16823</span>,</span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"2b831381d-6324-4d53-ad4f-8cda48b30811"</span>,  </span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"direct"</span>//如果要使用路由，这个 tag 是一定要有的，在这里 direct 就是 freedom 的一个标号，在路由中说 direct V2Ray 就知道是这里的 freedom 了</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"blackhole"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"adblock"</span>//同样的，这个 tag 也是要有的，在路由中说 adblock 就知道是这里的 blackhole（黑洞） 了</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"routing"</span>: &#123;</span><br><span class="line">    <span class="attr">"domainStrategy"</span>: <span class="string">"IPOnDemand"</span>,</span><br><span class="line">    <span class="attr">"rules"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"domain"</span>: [</span><br><span class="line">          <span class="string">"tanx.com"</span>,</span><br><span class="line">          <span class="string">"googeadsserving.cn"</span>,</span><br><span class="line">          <span class="string">"baidu.com"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"adblock"</span>       </span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"domain"</span>: [</span><br><span class="line">          <span class="string">"amazon.com"</span>,</span><br><span class="line">          <span class="string">"microsoft.com"</span>,</span><br><span class="line">          <span class="string">"jd.com"</span>,</span><br><span class="line">          <span class="string">"youku.com"</span>,</span><br><span class="line">          <span class="string">"baidu.com"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">        <span class="attr">"domain"</span>: [<span class="string">"geosite:cn"</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">        <span class="attr">"ip"</span>: [</span><br><span class="line">          <span class="string">"geoip:cn"</span>,</span><br><span class="line">          <span class="string">"geoip:private"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相对于标准配置，其中outbounds中多了以下的内容<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">  <span class="attr">"settings"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"tag"</span>: <span class="string">"direct"</span>//如果要使用路由，这个 tag 是一定要有的，在这里 direct 就是 freedom 的一个标号，在路由中说 direct V2Ray 就知道是这里的 freedom 了</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">"protocol"</span>: <span class="string">"blackhole"</span>,</span><br><span class="line">    <span class="attr">"settings"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"tag"</span>: <span class="string">"adblock"</span>//同样的，这个 tag 也是要有的，在路由中说 adblock 就知道是这里的 blackhole（黑洞） 了</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在 routing 中，新添加了两个规则：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"domain"</span>: [</span><br><span class="line">    <span class="string">"tanx.com"</span>,</span><br><span class="line">    <span class="string">"baidu.com"</span>,</span><br><span class="line">    <span class="string">"googeadsserving.cn"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">  <span class="attr">"outboundTag"</span>: <span class="string">"adblock"</span>       </span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"domain"</span>: [</span><br><span class="line">    <span class="string">"amazon.com"</span>,</span><br><span class="line">    <span class="string">"microsoft.com"</span>,</span><br><span class="line">    <span class="string">"jd.com"</span>,</span><br><span class="line">    <span class="string">"youku.com"</span>,</span><br><span class="line">    <span class="string">"baidu.com"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">  <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>第一个规则中，域名包含有 tanx.com 或 baidu.com 的就会被阻止连接，如果想拦截某些网站，往 adblock 的规则中写想要拦截的域名就可以了。<br>在第二个规则当中，域名中包含有 amazon.com 或 microsoft.com 或 youku.com 或 baidu.com 的会直连。</p><p>两个规则都有 baidu.com ，那么会执行哪个呢？答案是只会执行第一个（即adblock)，原因是：  </p><ol><li>规则是放在 routing.rules 这个数组当中，数组的内容是有顺序的，也就是说在这里规则是有顺序的，匹配规则时是从上往下匹配；  </li><li>当路由匹配到一个规则时就会跳出匹配而不会对之后的规则进行匹配；</li></ol><p>###注意</p><p>####以下代码使用通配符<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">        <span class="attr">"domain"</span>: [</span><br><span class="line">            <span class="string">"*.taobao.com"</span>,</span><br><span class="line">            <span class="string">"*.jd.com"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>是没用的，要用以下的替代<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">        <span class="attr">"domain"</span>: [</span><br><span class="line">            <span class="string">"domain:taobao.com"</span>,</span><br><span class="line">            <span class="string">"domain:jd.com"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><h4 id="且规则与或规则"><a href="#且规则与或规则" class="headerlink" title="且规则与或规则"></a>且规则与或规则</h4><p>且规则  并不满足规则<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">        <span class="attr">"domain"</span>: [</span><br><span class="line">            <span class="string">"domain:taobao.com"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"ip"</span>: [</span><br><span class="line">            <span class="string">"192.168.0.0/16"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>满足需求的或规则<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">        <span class="attr">"domain"</span>: [</span><br><span class="line">            <span class="string">"domain:taobao.com"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;，</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">        <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">        <span class="attr">"ip"</span>: [</span><br><span class="line">            <span class="string">"192.168.0.0/16"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><h1 id="高级内容"><a href="#高级内容" class="headerlink" title="高级内容"></a>高级内容</h1><p>V2Ray 的相比其它工具有一大优点是可以自行选择传输层的形式，也就是说 V2Ray 服务器和客户端之间的传输的数据包形式我们是可以选择的。如我们可以选择伪装成 HTTP(TCP)流量，如果使用了 mKCP 也可以伪装成 BT 下载、视频通话、微信视频通话。也可以选择使用 WebSokcs 或者 TLS。以上这个都是传输层的配置决定的。  </p><p>V2Ray 中传输层配置在 transport 里设定，也可以在 inbound/outbound 中的 streamSettings 设定。这两者的区别是 inbound/outbound 的 streamSettings 只对当前的 inbound/outbound 有效(分连接配置)，不影响其它的 inbound/outbound 的传输层配置。而 transport 是全局的，对整个配置所有的 inbound 和 outbound 都有效(全局配置)，如果一个 inbound/outbound 中设定了 streamSettings，transport 的全局设定不会影响这个 inbound/outbound。</p><h2 id="基础信息"><a href="#基础信息" class="headerlink" title="基础信息"></a>基础信息</h2><p>所有的配置参数<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"log"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"inbounds"</span>: [],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [],</span><br><span class="line">  <span class="attr">"routing"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"transport"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"dns"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"reverse"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"policy"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"stats"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"api"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>dns 、transport 和 reverse 将在高级内说明<br>api、policy 和 stats 的内容需要严格参考手册  </p><p>所有支持的协议：<br>传入：HTTP、SOCKS、VMess、Shadowsocks、Dokodemo-door；传出协议有 VMess、Shadowsocks、Blackhole、Freedom、SOCKS。  </p><p>无论使用了什么协议，inbounds 或者 outbounds 的配置格式都是一样的，区别只在于不同的协议对应的 settings 内容不一样。</p><h2 id="Mux-多路复用"><a href="#Mux-多路复用" class="headerlink" title="Mux 多路复用"></a>Mux 多路复用</h2><p>作用：能够将多条 TCP 连接合并成一条，节省资源，提高并发能力。  </p><p>例子：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">小白在大明买了主板</span><br><span class="line">小白在大明买了CPU</span><br><span class="line">小白在大明买了GPU</span><br><span class="line">小白在大明买了内存</span><br><span class="line">小白在大明买了电源</span><br><span class="line">小白在大明买了散热</span><br><span class="line">小白在大明买了机箱</span><br></pre></td></tr></table></figure></p><p>MUX例子<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">小白在大明买了CPU，GPU，内存，电源，散热，机箱并要求组装好一起寄过来</span><br></pre></td></tr></table></figure></p><p>说明：<br>Mux 实质上不能提高网速，但对并发连接比较有效，如浏览图片较多的网页，看直播等。从使用效果来说，V2Ray 的 Mux 应该类似于 Shadowsocks 的 TFO(TCP Fast Open)，因为两者的目的都是减小握手时间，只是实现方式不一样。只是 TFO 要设置系统内核才能打开，而 Mux 是纯粹在软件层面上实现，从配置难易度上 V2Ray 较好一些。注：V2ray已加入了TOF支持  </p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>Mux 只需在客户端开启，服务器会自动识别，所以只给客户端的配置。也就是只要在 outbound 或 outboundDetour 加入 “mux”: {“enabled”: true} 即可：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      "port": 1080, // 监听端口</span><br><span class="line">      "protocol": "socks", // 入口协议为 SOCKS 5</span><br><span class="line">      "sniffing": &#123;</span><br><span class="line">        "enabled": true,</span><br><span class="line">        "destOverride": ["http", "tls"]</span><br><span class="line">      &#125;,</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "auth": "noauth"  // 不认证</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      "protocol": "vmess", // 出口协议</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "vnext": [</span><br><span class="line">          &#123;</span><br><span class="line">            "address": "serveraddr.com", // 服务器地址，请修改为你自己的服务器 ip 或域名</span><br><span class="line">            "port": 16823,  // 服务器端口</span><br><span class="line">            "users": [</span><br><span class="line">              &#123;</span><br><span class="line">                "id": "b831381d-6324-4d53-ad4f-8cda48b30811",  // 用户 ID，必须与服务器端配置相同</span><br><span class="line">                "alterId": 64 // 此处的值也应当与服务器相同</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      "mux": &#123;"enabled": true&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="mKCP"><a href="#mKCP" class="headerlink" title="mKCP"></a>mKCP</h2><p>V2Ray 引入了 KCP 传输协议，并且做了一些不同的优化，称为 mKCP。如果你发现你的网络环境丢包严重，可以考虑一下使用 mKCP。相对于常规的 TCP 来说，mKCP 在高丢包率的网络下具有更大的优势，也正是因为此， mKCP 明显会比 TCP 耗费更多的流量，请酌情使用。要了解的一点是，mKCP 与 KCPTUN 同样是 KCP 协议，但两者并不兼容。</p><h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><p>mKCP 的配置比较简单，只需在服务器的 inbounds 和 客户端的 outbounds 添加一个 streamSettings 并设置成 mkcp 即可。<br>服务端：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">16823</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"clients"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,</span><br><span class="line">            <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">        "network": "mkcp", //此处的 mkcp 也可写成 kcp，两种写法是起同样的效果</span><br><span class="line">        "kcpSettings": &#123;</span><br><span class="line">          "uplinkCapacity": 5,</span><br><span class="line">          "downlinkCapacity": 100,</span><br><span class="line">          "congestion": true,</span><br><span class="line">          "header": &#123;</span><br><span class="line">            "type": "none"</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>客户端：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">1080</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"socks"</span>,</span><br><span class="line">      <span class="attr">"sniffing"</span>: &#123;</span><br><span class="line">        <span class="attr">"enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"destOverride"</span>: [<span class="string">"http"</span>, <span class="string">"tls"</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"auth"</span>: <span class="string">"noauth"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"serveraddr.com"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">16823</span>,</span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">        <span class="attr">"network"</span>: <span class="string">"mkcp"</span>,</span><br><span class="line">        <span class="attr">"kcpSettings"</span>: &#123;</span><br><span class="line">          <span class="attr">"uplinkCapacity"</span>: <span class="number">5</span>,</span><br><span class="line">          <span class="attr">"downlinkCapacity"</span>: <span class="number">100</span>,</span><br><span class="line">          <span class="attr">"congestion"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"header"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"none"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="动态端口"><a href="#动态端口" class="headerlink" title="动态端口"></a>动态端口</h2><p>服务器 inbound 的端口作为主端口，在 inboundDetour 开动态监听的端口，客户端不用额外设定，客户端会先与服务器的主端口通信协商下一个使用的端口号。<br>客户端配置需配置主端口</p><h3 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>:[</span><br><span class="line">  &#123; //主端口配置</span><br><span class="line">      "port": 37192,</span><br><span class="line">      "protocol": "vmess",</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "clients": [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"d17a1af7-efa5-42ca-b7e9-6a35282d737f"</span>,</span><br><span class="line">            <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        "detour": &#123; //绕行配置，即指示客户端使用 dynamicPort 的配置通信</span><br><span class="line">          "to": "dynamicPort"   </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      "port": "10000-20000", // 端口范围</span><br><span class="line">      "tag": "dynamicPort",  // 与上面的 detour to 相同</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "default": &#123;</span><br><span class="line">          "alterId": 64</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      "allocate": &#123;            // 分配模式</span><br><span class="line">        "strategy": "random",  // 随机开启</span><br><span class="line">        "concurrency": 2,      // 同时开放两个端口,这个值最大不能超过端口范围的 1/3</span><br><span class="line">        "refresh": 3           // 每三分钟刷新一次</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="若动态端口使用mKCP"><a href="#若动态端口使用mKCP" class="headerlink" title="若动态端口使用mKCP"></a>若动态端口使用mKCP</h3><p>在对应的 inbounds 和 outbounds 加入 streamSettings 并将 network 设置为 kcp 即可。<br>服务端：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">37192</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"clients"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"d17a1af7-efa5-42ca-b7e9-6a35282d737f"</span>,</span><br><span class="line">            <span class="attr">"level"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"detour"</span>: &#123;        </span><br><span class="line">          <span class="attr">"to"</span>: <span class="string">"dynamicPort"</span>   </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">        <span class="attr">"network"</span>: <span class="string">"kcp"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      "port": "10000-20000", // 端口范围</span><br><span class="line">      "tag": "dynamicPort",       </span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "default": &#123;</span><br><span class="line">          "level": 1,</span><br><span class="line">          "alterId": 32</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      "allocate": &#123;            // 分配模式</span><br><span class="line">        "strategy": "random",  // 随机开启</span><br><span class="line">        "concurrency": 2,      // 同时开放两个端口</span><br><span class="line">        "refresh": 3           // 每三分钟刷新一次</span><br><span class="line">      &#125;,</span><br><span class="line">      "streamSettings": &#123;</span><br><span class="line">        "network": "kcp"</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>客户端：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"1.2.3.4"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">37192</span>,</span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"d17a1af7-efa5-42ca-b7e9-6a35282d737f"</span>,</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">        <span class="attr">"network"</span>: <span class="string">"kcp"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="代理转发"><a href="#代理转发" class="headerlink" title="代理转发"></a>代理转发</h2><p>使用代理转发可以实现由一个 Shadowsocks 服务器或者 V2Ray(VMess) 服务器来中转你的网络流量，并且中转服务器只能看到你加密的数据而不知道原始的数据是什么。  </p><h3 id="基础转发-客户端配置："><a href="#基础转发-客户端配置：" class="headerlink" title="基础转发 - 客户端配置："></a>基础转发 - 客户端配置：</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      "settings": &#123; // settings 的根据实际情况修改</span><br><span class="line">        "vnext": [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"1.1.1.1"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">8888</span>,</span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span>,</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b12614c5-5ca4-4eba-a215-c61d642116ce"</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      "proxySettings": &#123;</span><br><span class="line">          "tag": "transit"  // 这里的 tag 必须跟作为代理 VPS 的 tag 一致，这里设定的是 "transit"</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"shadowsocks"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"servers"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"2.2.2.2"</span>,</span><br><span class="line">            <span class="attr">"method"</span>: <span class="string">"aes-256-cfb"</span>,</span><br><span class="line">            <span class="attr">"ota"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"password"</span>: <span class="string">"password"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">1024</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"transit"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>工作原理是：</p><ol><li>你在 Twitter 发了个帖子 f**k GFW，由 V2Ray 代理  </li><li>V2Ray 客户端收到浏览器发出的 f**k GFW 的帖子后，首先由对其进行加密(VMess，id: b12614c5-5ca4-4eba-a215-c61d642116ce,目的服务器: 1.1.1.1:8888)  </li><li>加密后数据包将被转到 transit 这个 outbound 中，在这里数据包又会加密一次(Shadowsocks, password: password, 服务器: 2.2.2.2:1024)  </li><li>两次加密后的数据包被发送到了 Shadowsocks 服务器，该服务器收到后解包后得到仍是加密的数据包（步骤 2 中加密后的数据包），然后将数据包发到 VMess 服务器。即便这个 Shadowsocks 服务器的主人是个偷窥狂魔，他也没办法看到你的原始数据。    </li><li>VMess 服务器收到 Shadowsocks 服务器发来的数据包，解密得到原始的数据包，然后把你这个帖子发到 Twitter 的网站中。</li></ol><h3 id="链式转发"><a href="#链式转发" class="headerlink" title="链式转发"></a>链式转发</h3><p>如果你有多个 Shadowsocks 或 VMess 账户，那么你可以这样:<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      "settings": &#123; // settings 的根据实际情况修改</span><br><span class="line">        "vnext": [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"1.1.1.1"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">8888</span>,</span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span>,</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b12614c5-5ca4-4eba-a215-c61d642116ce"</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      "tag": "DOUS",</span><br><span class="line">      "proxySettings": &#123;</span><br><span class="line">          "tag": "DOSG"  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"shadowsocks"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"servers"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"2.2.2.2"</span>,</span><br><span class="line">            <span class="attr">"method"</span>: <span class="string">"aes-256-cfb"</span>,</span><br><span class="line">            <span class="attr">"ota"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"password"</span>: <span class="string">"password"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">1024</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"AliHK"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"shadowsocks"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"servers"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"3.3.3.3"</span>,</span><br><span class="line">            <span class="attr">"method"</span>: <span class="string">"aes-256-cfb"</span>,</span><br><span class="line">            <span class="attr">"ota"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"password"</span>: <span class="string">"password"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">3442</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"AliSG"</span>,</span><br><span class="line">      <span class="attr">"proxySettings"</span>: &#123;</span><br><span class="line">          <span class="attr">"tag"</span>: <span class="string">"AliHK"</span>  </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"4.4.4.4"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">8462</span>,</span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span>,</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b27c24ab-2b5a-433e-902c-33f1168a7902"</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"DOSG"</span>,</span><br><span class="line">      <span class="attr">"proxySettings"</span>: &#123;</span><br><span class="line">          <span class="attr">"tag"</span>: <span class="string">"AliSG"</span>  </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>数据包经过的节点依次为： PC -&gt; AliHK -&gt; AliSG -&gt; DOSG -&gt; DOUS -&gt; 目标网站  </p><p>问题：性能 ：链式代理使用了多个节点，可能会造成延时、带宽等网络性能问题，并且客户端对每一个加解密的次数取决于代理链的长度，理论上也会有一定的影响。安全 ：前文提到，代理转发会一定程度上提高安全性，但安全取决于最弱一环，并不意味着代理链越长就会越安全。如果你需要匿名，请考虑成熟的匿名方案。 另外，使用了代理转发 streamSettings 会失效，即只能是非 TLS、无 HTTP 伪装的 TCP 传输协议。</p><h2 id="国内中转"><a href="#国内中转" class="headerlink" title="国内中转"></a>国内中转</h2><p>为了方便维护，或者从速度上的考虑，可以在国内架设一台中转 VPS，在这台 VPS 上判断目标地址是国内还是国外的，只需把国外的流量向国外 VPS 转发，而国内的流量使用直连。这样的配置，在用户的电脑只需要把所有流量发往这台 VPS，而不用为每一个用户都配置白名单，较为省力。  </p><p>中转配置：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"log"</span> : &#123;                                 </span><br><span class="line">    <span class="attr">"access"</span>: <span class="string">"/var/log/v2ray/access.log"</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"/var/log/v2ray/error.log"</span>,</span><br><span class="line">    <span class="attr">"loglevel"</span>: <span class="string">"warning"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">1234</span>,</span><br><span class="line">      "protocol": "vmess",    // 入站协议为 VMess</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "clients": [</span><br><span class="line">          &#123;</span><br><span class="line">            "id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx", // UUID</span><br><span class="line">            "level": 1,       // 用户等级</span><br><span class="line">            "alterId": 32     // 额外ID</span><br><span class="line">          &#125;,</span><br><span class="line">          // 在这里添加更多用户，注意UUID不能重复</span><br><span class="line">          &#123;</span><br><span class="line">            "id": "yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy", // UUID</span><br><span class="line">            "level": 0,       // 用户等级</span><br><span class="line">            "alterId": 32     // 额外ID</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  // ========== BEGIN STEP 1 ==========</span><br><span class="line">  // 国内中转服务器当作国外服务器的“客户端”</span><br><span class="line">  // 国际流量发往国外服务器上</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      "protocol": "vmess",        // 出口协议</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "vnext": [</span><br><span class="line">          &#123;</span><br><span class="line">            "address": "1.2.3.4", // 国外服务器地址</span><br><span class="line">            "port": 23456,        // 国外服务器端口</span><br><span class="line">            "users": [</span><br><span class="line">                &#123;"id": "zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz"&#125; // 用户 ID，须与国外服务器端配置相同</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"blackhole"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"block"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    // 增加 freedom 传出绕路，国内流量直接放行</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"direct"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  // ========== END STEP 1 ==========</span><br><span class="line">  "routing": &#123; // 路由设置</span><br><span class="line">   "domainStrategy": "IPOnDemand",</span><br><span class="line">    "strategy": "rules",</span><br><span class="line">    "rules": [</span><br><span class="line">      &#123;</span><br><span class="line">        "type": "field",      // 不允许客户端访问服务端的局域网地址，以提升安全性</span><br><span class="line">        "ip": [</span><br><span class="line">          <span class="string">"geoip:cn"</span></span><br><span class="line">        ],</span><br><span class="line">        "outboundTag": "block"</span><br><span class="line">      &#125;,</span><br><span class="line">      // 配置国内网站和IP直连规则</span><br><span class="line">      &#123;</span><br><span class="line">        "type": "field",  // 对于一些常见的国内网站，也使用直连模式</span><br><span class="line">        "domain": [</span><br><span class="line">          <span class="string">"geosite:cn"</span></span><br><span class="line">        ],</span><br><span class="line">        "outboundTag": "direct"</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        "type": "field", // 对于所有国内的 IP，都采用直连模式</span><br><span class="line">        "ip": [</span><br><span class="line">          <span class="string">"geoip:cn"</span></span><br><span class="line">        ]</span><br><span class="line">        "outboundTag": "direct"</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="HTTP伪装"><a href="#HTTP伪装" class="headerlink" title="HTTP伪装"></a>HTTP伪装</h2><p>人建议不要使用 HTTP 伪装： HTTP 伪装的同时完全可以使用动态端口，从实际情况来看，基本上不会有人在一个服务器上开使用多个端口的 Web 服务。<br>V2Ray 的 HTTP 伪装功能可以可以将 V2Ray 的流量伪装成正常的 HTTP 协议的。这里给出一个 HTTP 伪装的服务器端与客户端配置文件示例。</p><p>###服务器<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"log"</span> : &#123;</span><br><span class="line">    <span class="attr">"access"</span>: <span class="string">"/var/log/v2ray/access.log"</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"/var/log/v2ray/error.log"</span>,</span><br><span class="line">    <span class="attr">"loglevel"</span>: <span class="string">"warning"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      "port": 80, //推荐80端口，更好地迷惑防火墙（好吧实际上并没有什么卵用</span><br><span class="line">      "protocol": "vmess",</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "clients": [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,</span><br><span class="line">            <span class="attr">"level"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      "streamSettings": &#123;</span><br><span class="line">        "network": "tcp",</span><br><span class="line">        "tcpSettings": &#123;</span><br><span class="line">          "header": &#123; // header 这一项是关于数据包伪装的设置，可自定义合理的内容，但要确保服务器与客户端一致</span><br><span class="line">            "type": "http",</span><br><span class="line">            "response": &#123;</span><br><span class="line">              "version": "1.1",</span><br><span class="line">              "status": "200",</span><br><span class="line">              "reason": "OK",</span><br><span class="line">              "headers": &#123;</span><br><span class="line">                "Content-Type": ["application/octet-stream", "application/x-msdownload", "text/html", "application/x-shockwave-flash"],</span><br><span class="line">                "Transfer-Encoding": ["chunked"],</span><br><span class="line">                "Connection": ["keep-alive"],</span><br><span class="line">                "Pragma": "no-cache"</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"blackhole"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"blocked"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "routing": &#123;</span><br><span class="line">    "strategy": "rules",</span><br><span class="line">    "settings": &#123;</span><br><span class="line">      "rules": [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">          <span class="attr">"ip"</span>: [</span><br><span class="line">            <span class="string">"geoip:private"</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"outboundTag"</span>: <span class="string">"blocked"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"log"</span>: &#123;</span><br><span class="line">    <span class="attr">"loglevel"</span>: <span class="string">"warning"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">1080</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"socks"</span>,</span><br><span class="line">      <span class="attr">"sniffing"</span>: &#123;</span><br><span class="line">        <span class="attr">"enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"destOverride"</span>: [<span class="string">"http"</span>, <span class="string">"tls"</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"auth"</span>: <span class="string">"noauth"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbound"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"serveraddr.com"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">80</span>,</span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">        <span class="attr">"network"</span>: <span class="string">"tcp"</span>,</span><br><span class="line">        <span class="attr">"tcpSettings"</span>: &#123;</span><br><span class="line">          "header": &#123;  //这里的 header 要与服务器保持一致</span><br><span class="line">            "type": "http",</span><br><span class="line">            "request": &#123;</span><br><span class="line">              "version": "1.1",</span><br><span class="line">              "method": "GET",</span><br><span class="line">              "path": ["/"],</span><br><span class="line">              "headers": &#123;</span><br><span class="line">                "Host": ["www.cloudflare.com", "www.amazon.com"],</span><br><span class="line">                "User-Agent": [</span><br><span class="line">                  "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.75 Safari/537.36",</span><br><span class="line">                          <span class="string">"Mozilla/5.0 (iPhone; CPU iPhone OS 10_0_2 like Mac OS X) AppleWebKit/601.1 (KHTML, like Gecko) CriOS/53.0.2785.109 Mobile/14A456 Safari/601.1.46"</span></span><br><span class="line">                ],</span><br><span class="line">                "Accept-Encoding": ["gzip, deflate"],</span><br><span class="line">                "Connection": ["keep-alive"],</span><br><span class="line">                "Pragma": "no-cache"</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">"tag"</span>: <span class="string">"direct"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "routing": &#123;</span><br><span class="line">    "strategy": "rules",</span><br><span class="line">    "settings": &#123;</span><br><span class="line">      "domainStrategy": "IPIfNonMatch",</span><br><span class="line">      "rules": [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"field"</span>,</span><br><span class="line">          <span class="attr">"ip"</span>: [</span><br><span class="line">            <span class="string">"geoip:private"</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"chinasites"</span>,</span><br><span class="line">          <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"chinaip"</span>,</span><br><span class="line">          <span class="attr">"outboundTag"</span>: <span class="string">"direct"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="TLS-传输层安全"><a href="#TLS-传输层安全" class="headerlink" title="TLS 传输层安全"></a>TLS 传输层安全</h2><p>证书有两种，一种是 ECC 证书（内置公钥是 ECDSA 公钥），一种是 RSA 证书（内置 RSA 公钥）。简单来说，同等长度 ECC 比 RSA 更安全,也就是说在具有同样安全性的情况下，ECC 的密钥长度比 RSA 短得多（加密解密会更快）。但问题是 ECC 的兼容性会差一些，Android 4.x 以下和 Windows XP 不支持。只要您的设备不是非常老的老古董，建议使用 ECC 证书。  </p><p>这里使用免费证书，证书认证机构为 Let’s Encrypt。 证书的生成有许多方法，这里使用的是比较简单的方法：使用 acme.sh 脚本生成，本部分说明部分内容参考于acme.sh README。  </p><h3 id="安装acme-sh"><a href="#安装acme-sh" class="headerlink" title="安装acme.sh"></a>安装acme.sh</h3> <figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl  https://get.acme.sh | sh</span></span><br></pre></td></tr></table></figure><p>安装成功后执行 source ~/.bashrc 以确保脚本所设置的命令别名生效。<br>如果安装报错，那么可能是因为系统缺少 acme.sh 所需要的依赖项，acme.sh 的依赖项主要是 netcat(nc)，我们通过以下命令来安装这些依赖项，然后重新安装一遍 acme.sh:<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get -y install netcat</span></span><br></pre></td></tr></table></figure></p><h3 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ~/.acme.sh/acme.sh --issue -d mydomain.me --standalone -k ec-256</span></span><br></pre></td></tr></table></figure><p>-k 表示密钥长度，后面的值可以是 ec-256 、ec-384、2048、3072、4096、8192，带有 ec 表示生成的是 ECC 证书，没有则是 RSA 证书。在安全性上 256 位的 ECC 证书等同于 3072 位的 RSA 证书。  </p><h3 id="更新证书"><a href="#更新证书" class="headerlink" title="更新证书"></a>更新证书</h3><p>由于 Let’s Encrypt 的证书有效期只有 3 个月，因此需要 90 天至少要更新一次证书，acme.sh 脚本会每 60 天自动更新证书。也可以手动更新。  </p><p>ECC:<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ~/.acme.sh/acme.sh --renew -d mydomain.com --force --ecc</span></span><br></pre></td></tr></table></figure></p><p>RSA:<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ~/.acme.sh/acme.sh --renew -d mydomain.com --force</span></span><br></pre></td></tr></table></figure></p><p>由于本例中将证书生成到 /etc/v2ray/ 文件夹，更新证书之后还得把新证书生成到 /etc/v2ray。</p><h3 id="安装证书"><a href="#安装证书" class="headerlink" title="安装证书"></a>安装证书</h3><p>ECC:<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ~/.acme.sh/acme.sh --installcert -d mydomain.me --fullchainpath /etc/v2ray/v2ray.crt --keypath /etc/v2ray/v2ray.key --ecc</span></span><br></pre></td></tr></table></figure></p><p>RSA:<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ~/.acme.sh/acme.sh --installcert -d mydomain.me --fullchainpath /etc/v2ray/v2ray.crt --keypath /etc/v2ray/v2ray.key</span></span><br></pre></td></tr></table></figure></p><p><strong>注意：无论什么情况，密钥(即上面的v2ray.key)都不能泄漏，如果你不幸泄漏了密钥，可以使用 acme.sh 将原证书吊销，再生成新的证书，吊销方法请自行参考 acme.sh 的手册</strong></p><h3 id="配置-3"><a href="#配置-3" class="headerlink" title="配置"></a>配置</h3><p>服务器：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      "port": 443, // 建议使用 443 端口</span><br><span class="line">      "protocol": "vmess",    </span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "clients": [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"23ad6b10-8d1a-40f7-8ad0-e3e35cd38297"</span>,  </span><br><span class="line">            <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      "streamSettings": &#123;</span><br><span class="line">        "network": "tcp",</span><br><span class="line">        "security": "tls", // security 要设置为 tls 才会启用 TLS</span><br><span class="line">        "tlsSettings": &#123;</span><br><span class="line">          "certificates": [</span><br><span class="line">            &#123;</span><br><span class="line">              "certificateFile": "/etc/v2ray/v2ray.crt", // 证书文件</span><br><span class="line">              "keyFile": "/etc/v2ray/v2ray.key" // 密钥文件</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>客户端：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">1080</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"socks"</span>,</span><br><span class="line">      <span class="attr">"sniffing"</span>: &#123;</span><br><span class="line">        <span class="attr">"enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"destOverride"</span>: [<span class="string">"http"</span>, <span class="string">"tls"</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"auth"</span>: <span class="string">"noauth"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            "address": "mydomain.me", // tls 需要域名，所以这里应该填自己的域名</span><br><span class="line">            "port": 443,</span><br><span class="line">            "users": [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"23ad6b10-8d1a-40f7-8ad0-e3e35cd38297"</span>,</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      "streamSettings": &#123;</span><br><span class="line">        "network": "tcp",</span><br><span class="line">        "security": "tls" // 客户端的 security 也要设置为 tls</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="验证V2Ray"><a href="#验证V2Ray" class="headerlink" title="验证V2Ray"></a>验证V2Ray</h3><p>客户端能够正常联网说明 TLS 已经成功启用。但要是有个可靠的方法来验证是否正常开启 TLS 无疑更令人放心。 验证的方法有很多，我仅介绍一种小白化一点的，便是 <a href="https://www.ssllabs.com/ssltest/index.html" target="_blank" rel="noopener">Qualys SSL Labs’s SSL Server Test</a>。<br>打开 以上地址，在 Hostname 中输入你的域名，点提交，过一会结果就出来了。  </p><h2 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h2><p>WebSocket 的配置其实很简单，就跟 mKCP 一样把 network 一改就行了。话不多说，直接上配置。</p><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">16823</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"clients"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,</span><br><span class="line">            <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">        <span class="attr">"network"</span>:<span class="string">"ws"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="客户端-2"><a href="#客户端-2" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">1080</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"socks"</span>,</span><br><span class="line">      <span class="attr">"sniffing"</span>: &#123;</span><br><span class="line">        <span class="attr">"enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"destOverride"</span>: [<span class="string">"http"</span>, <span class="string">"tls"</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"auth"</span>: <span class="string">"noauth"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"serveraddr.com"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">16823</span>,</span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>:&#123;</span><br><span class="line">        <span class="attr">"network"</span>:<span class="string">"ws"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="WebSocket-TLS-Web"><a href="#WebSocket-TLS-Web" class="headerlink" title="WebSocket+TLS+Web"></a>WebSocket+TLS+Web</h2><p>而本文搭配 Web 服务并同时实现 TLS 和 WebSocket。关于 Web 的软件本文给出了 Nginx，Caddy 和 Apache 三个例子，三选一即可，也可以选用其它的软件。  </p><p>使用 Nginx / Caddy / Apache 是因为 VPS 已经有 Nginx / Caddy / Apache 可以将 V2Ray 稍作隐藏，使用 WebSocket 是因为搭配 Nginx / Caddy / Apache 只能用 WebSocket，使用 TLS 是因为可以流量加密，看起来更像 HTTPS。  </p><p>因为本节涉及 Nginx / Caddy / Apache，只给出了配置示例而不讲具体使用方法，也就是说你在阅读本节内容前得会使用这三个软件的其中之一，如果你还不会，请自行 Google。  </p><p>注意: V2Ray 的 Websocket+TLS 配置组合并不依赖 Nginx / Caddy / Apache，只是能与其搭配使用而已，没有它们也可以正常使用。</p><h3 id="双端配置"><a href="#双端配置" class="headerlink" title="双端配置"></a>双端配置</h3><p>这次 TLS 的配置将写入 Nginx / Caddy / Apache 配置中，由这些软件来监听 443 端口（443 比较常用，并非 443 不可），然后将流量转发到 V2Ray 的 WebSocket 所监听的内网端口（本例是 10000），V2Ray 服务器端不需要配置 TLS。<br>服务器：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">10000</span>,</span><br><span class="line">      "listen":"127.0.0.1",//只监听 127.0.0.1，避免除本机外的机器探测到开放了 10000 端口</span><br><span class="line">      "protocol": "vmess",</span><br><span class="line">      "settings": &#123;</span><br><span class="line">        "clients": [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,</span><br><span class="line">            <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      "streamSettings": &#123;</span><br><span class="line">        "network": "ws",</span><br><span class="line">        "wsSettings": &#123;</span><br><span class="line">        "path": "/ray"</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "outbounds": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"freedom"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>客户端配置<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"inbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"port"</span>: <span class="number">1080</span>,</span><br><span class="line">      <span class="attr">"listen"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"socks"</span>,</span><br><span class="line">      <span class="attr">"sniffing"</span>: &#123;</span><br><span class="line">        <span class="attr">"enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"destOverride"</span>: [<span class="string">"http"</span>, <span class="string">"tls"</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"auth"</span>: <span class="string">"noauth"</span>,</span><br><span class="line">        <span class="attr">"udp"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"outbounds"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"protocol"</span>: <span class="string">"vmess"</span>,</span><br><span class="line">      <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"vnext"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"address"</span>: <span class="string">"mydomain.me"</span>,</span><br><span class="line">            <span class="attr">"port"</span>: <span class="number">443</span>,</span><br><span class="line">            <span class="attr">"users"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span>,</span><br><span class="line">                <span class="attr">"alterId"</span>: <span class="number">64</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"streamSettings"</span>: &#123;</span><br><span class="line">        <span class="attr">"network"</span>: <span class="string">"ws"</span>,</span><br><span class="line">        <span class="attr">"security"</span>: <span class="string">"tls"</span>,</span><br><span class="line">        <span class="attr">"wsSettings"</span>: &#123;</span><br><span class="line">          <span class="attr">"path"</span>: <span class="string">"/ray"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="服务端Web配置"><a href="#服务端Web配置" class="headerlink" title="服务端Web配置"></a>服务端Web配置</h3><h4 id="Nginx-配置"><a href="#Nginx-配置" class="headerlink" title="Nginx 配置"></a>Nginx 配置</h4><p>配置中使用的是域名和证书使用 TLS 小节的举例，请替换成自己的。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server</span> <span class="string">&#123;</span></span><br><span class="line">  <span class="string">listen</span>  <span class="number">443</span> <span class="string">ssl;</span></span><br><span class="line">  <span class="string">ssl</span> <span class="string">on;</span></span><br><span class="line">  <span class="string">ssl_certificate</span>       <span class="string">/etc/v2ray/v2ray.crt;</span></span><br><span class="line">  <span class="string">ssl_certificate_key</span>   <span class="string">/etc/v2ray/v2ray.key;</span></span><br><span class="line">  <span class="string">ssl_protocols</span>         <span class="string">TLSv1</span> <span class="string">TLSv1.1</span> <span class="string">TLSv1.2;</span></span><br><span class="line">  <span class="string">ssl_ciphers</span>           <span class="attr">HIGH:!aNULL:!MD5;</span></span><br><span class="line">  <span class="string">server_name</span>           <span class="string">mydomain.me;</span></span><br><span class="line">        <span class="string">location</span> <span class="string">/ray</span> <span class="string">&#123;</span> <span class="comment"># 与 V2Ray 配置中的 path 保持一致</span></span><br><span class="line">        <span class="string">proxy_redirect</span> <span class="string">off;</span></span><br><span class="line">        <span class="string">proxy_pass</span> <span class="attr">http://127.0.0.1:10000;#假设WebSocket监听在环回地址的10000端口上</span></span><br><span class="line">        <span class="string">proxy_http_version</span> <span class="number">1.1</span><span class="string">;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Upgrade</span> <span class="string">$http_upgrade;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Connection</span> <span class="string">"upgrade"</span><span class="string">;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Host</span> <span class="string">$http_host;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Show realip in v2ray access.log</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">X-Real-IP</span> <span class="string">$remote_addr;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">X-Forwarded-For</span> <span class="string">$proxy_add_x_forwarded_for;</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p><h4 id="Caddy-配置"><a href="#Caddy-配置" class="headerlink" title="Caddy 配置"></a>Caddy 配置</h4><p>因为 Caddy 会自动申请证书并自动更新，所以使用 Caddy 不用指定证书、密钥。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mydomain.me</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line">  <span class="string">log</span> <span class="string">./caddy.log</span></span><br><span class="line">  <span class="string">proxy</span> <span class="string">/ray</span> <span class="attr">localhost:10000</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="string">websocket</span></span><br><span class="line">    <span class="string">header_upstream</span> <span class="bullet">-Origin</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p><h4 id="Apache-配置"><a href="#Apache-配置" class="headerlink" title="Apache 配置"></a>Apache 配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">VirtualHost</span> *<span class="attr">:443</span>&gt;</span></span><br><span class="line">  ServerName mydomain.me</span><br><span class="line">  SSLCertificateFile /etc/v2ray/v2ray.crt</span><br><span class="line">  SSLCertificateKeyFile /etc/v2ray/v2ray.key</span><br><span class="line"></span><br><span class="line">  SSLProtocol -All +TLSv1 +TLSv1.1 +TLSv1.2</span><br><span class="line">  SSLCipherSuite HIGH:!aNULL</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">Location</span> "/<span class="attr">ray</span>/"&gt;</span></span><br><span class="line">    ProxyPass ws://127.0.0.1:10000/ray/ upgrade=WebSocket</span><br><span class="line">    ProxyAddHeaders Off</span><br><span class="line">    ProxyPreserveHost On</span><br><span class="line">    RequestHeader append X-Forwarded-For %&#123;REMOTE_ADDR&#125;s</span><br><span class="line">  <span class="tag">&lt;/<span class="name">Location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">VirtualHost</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>V2Ray 暂时不支持 TLS1.3，如果开启并强制 TLS1.3 会导致 V2Ray 无法连接<br>较低版本的nginx的location需要写为 /ray/ 才能正常工作</p><p>如果在设置完成之后不能成功使用，可能是由于 SElinux 机制(如果你是 CentOS 7 的用户请特别留意 SElinux 这一机制)阻止了 Nginx 转发向内网的数据。如果是这样的话，在 V2Ray 的日志里不会有访问信息，在 Nginx 的日志里会出现大量的 “Permission Denied” 字段，要解决这一问题需要在终端下键入以下命令：<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setsebool -P httpd_can_network_connect 1</span><br></pre></td></tr></table></figure></p><p>请保持服务器和客户端的 wsSettings 严格一致，对于 V2Ray，/ray 和 /ray/ 是不一样的</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>1.开启了 TLS 之后 path 参数是被加密的，GFW 看不到；<br>2.主动探测一个 path 产生 Bad request 不能证明是 V2Ray；<br>3.不安全的因素在于人，自己的问题就不要甩锅，哪怕我把示例中的 path 改成一个 UUID，依然有不少人原封不动地 COPY；4.使用 Header 分流并不比 path 安全， 不要迷信。</p>]]></content>
      
      
      <categories>
          
          <category> 工具人 ToolMan </category>
          
          <category> 网路 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> ML </tag>
            
            <tag> Android </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ShadowSocks-从入门到出门[go版本]</title>
      <link href="/2017/12/12/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/%E7%BD%91%E8%B7%AF/20171212-ShadowSocks-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E9%97%A8%5Bgo%E7%89%88%E6%9C%AC%5D/"/>
      <url>/2017/12/12/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/%E7%BD%91%E8%B7%AF/20171212-ShadowSocks-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E9%97%A8%5Bgo%E7%89%88%E6%9C%AC%5D/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&emsp;&emsp;因被喝茶，shadowsocks 作者被迫停更了shadowsocks的python服务器版本，go语言版本开始被很多人使用。但python版本停更并非go版本使用频次增多的主要原因,除了语言切换的限制，更多的是因为go语言中自带高并发的特性，使得其体验较好，于是越来越多的同事都自行搭建go版本自用。<br>本文尽可能详细说明shadowsocks的搭建使用细节。<a id="more"></a></p><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><!-- TOC --><ul><li><a href="#目录">目录</a></li><li><a href="#说明">说明</a></li><li><a href="#服务器选择">服务器选择</a></li><li><a href="#关于云服务">关于云服务</a></li><li><a href="#开始">开始</a></li><li><a href="#linux内核升级--linux4">Linux内核升级-&gt; linux4</a><ul><li><a href="#检查当前系统内核版本">检查当前系统内核版本：</a></li><li><a href="#检查当前tcp算法">检查当前tcp算法</a></li><li><a href="#注意">注意</a></li><li><a href="#使用elrepo仓库">使用ELRepo仓库：</a></li><li><a href="#列出目前可用的linux内核包">列出目前可用的Linux内核包：</a></li><li><a href="#安装最新主线稳定内核">安装最新主线稳定内核</a></li><li><a href="#修改默认启动内核">修改默认启动内核</a><ul><li><a href="#cnetos6">cnetos6</a></li><li><a href="#centos7">centos7</a></li></ul></li><li><a href="#重启">重启</a></li><li><a href="#检测">检测</a></li></ul></li><li><a href="#tcp算法改为bbr">tcp算法改为BBR</a><ul><li><a href="#配置生效">配置生效</a></li><li><a href="#检查">检查</a></li></ul></li><li><a href="#安装go">安装go</a></li><li><a href="#安装git">安装git</a></li><li><a href="#安装shadowsocks">安装shadowsocks</a></li><li><a href="#配置configjson文件">配置config.json文件</a></li><li><a href="#开放端口">开放端口</a></li><li><a href="#开启shadowsocks服务">开启shadowsocks服务</a></li><li><a href="#使用客户端测试链接">使用客户端测试链接</a></li><li><a href="#备注">备注</a><ul><li><a href="#重置密码">重置密码</a></li></ul></li></ul><!-- /TOC --><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>&emsp;&emsp;使用shadowsocks的前置条件。<br>&emsp;&emsp;首先，必须拥有一台境外服务器，如果不是自己的物理所有，则需租赁VPS服务器。<br>&emsp;&emsp;所谓VPS服务器，即Virtual Private Server -私有虚拟服务器。<br>&emsp;&emsp;关于租赁服务器，博主常用服务商为vultr、搬瓦工、cloudcone等，这也是目前广告和稳定性同时做的比较好的几家。<br>&emsp;&emsp;另随互联网产业不断增长，相关服务需求缺口逐渐呈现，越来越多的云服务商参与其中竞争，相对前面几家，有很多的小服务商也推出了性价比更高的vps服务，主要集中在俄国区，各位可以自由选择。大厂还有谷歌的云服务器、亚马逊的AWS,微软的Azure，各位均可一试。<br>&emsp;&emsp;本文搭建环境时VPS系统为centos。  </p><h2 id="服务器选择"><a href="#服务器选择" class="headerlink" title="服务器选择"></a>服务器选择</h2><p>&ensp;&ensp;选择VPS服务商时需注意地理位置远近，测速工具检测结果，及其服务器架构，其中注意服务器最好选择Kvm,Xen等宽容度较高的架构方便网络层级的扩展，避免OpenVZ,另外也会有服务器厂家会挂Xen卖OpenVZ,在购买之后也要记得及时检测。<br>&ensp;&ensp;购买服务器之后还有及时ping 服务器ID，若ping不通则马上发工单换ip,不同服务商换IP的价格不同。<br>&ensp;&ensp;国内云服务器所售的境外机型不推荐选择，性价比太低。  </p><h2 id="关于云服务"><a href="#关于云服务" class="headerlink" title="关于云服务"></a>关于云服务</h2><p>&ensp;&ensp;关于云服务厂商所提供的VPS服务，大多为基于OpenStack的云计算平台开源实现，国内的两大云服务厂商也是基于此，不久前滴滴和腾讯云业务分开后，也自行组建了滴滴云服务平台，也是基于OpenStack,但其刚起步不推荐。<br>OpenStack相关的云计算实现，国内学习资源不多，各位可自行搜索，主栈语言为Python。<br>此处提供OpenStack官方地址：<br>&ensp;&ensp;<a href="https://www.openstack.org/" target="_blank" rel="noopener">OpenStack 官网</a><br>&ensp;&ensp;<a href="https://github.com/openstack" target="_blank" rel="noopener">OpenStack github主页</a>  </p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>现在你已拥有了基于Xen架构的虚拟机(可ping通)，并已使用root账户登陆拥有管理员权限，接下来的步骤为：</p><pre><code>* 升级Linux系统内核  * 更改Linux底层TCP协议算法[BBR 加速]  * 安装go  * 安装git  * 安装shadowsocks  * 配置config.json文件  * 防火墙开放端口  * 使用客户端测试链接  </code></pre><p>配置前两项后可使用谷歌Tcp bbr算法加速，bbr算法可基于ai智能控制数据包上下行数量，减少国际带宽拥堵。<br>前两步为提升网络性能，可直接从第三步开始。</p><h2 id="Linux内核升级-gt-linux4"><a href="#Linux内核升级-gt-linux4" class="headerlink" title="Linux内核升级-&gt; linux4"></a>Linux内核升级-&gt; linux4</h2><p>###检查当前系统内核版本：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@vultr_host /]</span># <span class="selector-tag">uname</span> <span class="selector-tag">-sr</span></span><br><span class="line"><span class="selector-tag">Linux</span> 3<span class="selector-class">.10</span><span class="selector-class">.0-693</span><span class="selector-class">.21</span><span class="selector-class">.1</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br></pre></td></tr></table></figure></p><p>###检查当前tcp算法<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@vultr_host</span> /]<span class="meta"># sysctl net.ipv4.tcp_available_congestion_control</span></span><br><span class="line">net.ipv4.tcp_available_congestion_control = cubic reno</span><br></pre></td></tr></table></figure></p><p>此时系统内核使用的tcp算法内核为cubic/reno</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>在centos中升级内核需要注意：多数linux发行版提供了使用 yum 的包管理系统以及官方支持的内核升级方法，但这所有的仅仅为其仓库下最新可用内核，非<a href="https://www.kernel.org" target="_blank" rel="noopener">linux 最新版本</a>。而且，在centos中也无法使用red hat。</p><p>但是，CentOS可以使用ELRepo!ELRepo是一个第三方仓库，可以将内核升级到最新版本。</p><p>###使用ELRepo仓库：<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr_host /]# rpm --<span class="keyword">import</span> http:<span class="comment">//www.elrepo.org/RPM-GPG-KEY-elrepo.org</span></span><br><span class="line">[root@vultr_host /]# rpm -Uvh http:<span class="comment">//www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</span></span><br><span class="line">Retrieving http:<span class="comment">//www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</span></span><br><span class="line">Retrieving http:<span class="comment">//elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span></span><br><span class="line">Preparing...                          ################################# [<span class="number">100</span>%]</span><br><span class="line">Updating / installing...</span><br><span class="line">   <span class="number">1</span>:elrepo-release<span class="number">-7.0</span><span class="number">-3.</span>el7.elrepo  ################################# [<span class="number">100</span>%]</span><br></pre></td></tr></table></figure></p><h3 id="列出目前可用的Linux内核包："><a href="#列出目前可用的Linux内核包：" class="headerlink" title="列出目前可用的Linux内核包："></a>列出目前可用的Linux内核包：</h3><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr_host /]# yum --disablerepo=<span class="string">"*"</span> --enablerepo=<span class="string">"elrepo-kernel"</span> list available</span><br><span class="line"></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">elrepo-kernel                                                                                  | <span class="number">2.9</span> kB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">elrepo-kernel/primary_db                                                                       | <span class="number">1.7</span> MB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span></span><br><span class="line">Determining fastest mirrors</span><br><span class="line"> * elrepo-kernel: mirrors.thzhost.com</span><br><span class="line">Available Packages</span><br><span class="line">kernel-lt.x86_64                                           <span class="number">4.4</span><span class="meta">.138</span>-<span class="number">1.</span>el7.elrepo                          elrepo-kernel</span><br><span class="line">kernel-lt-devel.x86_64                                     <span class="number">4.4</span><span class="meta">.138</span>-<span class="number">1.</span>el7.elrepo                          elrepo-kernel</span><br><span class="line">kernel-lt-doc.noarch                                       <span class="number">4.4</span><span class="meta">.138</span>-<span class="number">1.</span>el7.elrepo                          elrepo-kernel</span><br><span class="line">kernel-lt-headers.x86_64                                   <span class="number">4.4</span><span class="meta">.138</span>-<span class="number">1.</span>el7.elrepo                          elrepo-kernel</span><br><span class="line">kernel-lt-tools.x86_64                                     <span class="number">4.4</span><span class="meta">.138</span>-<span class="number">1.</span>el7.elrepo                          elrepo-kernel</span><br><span class="line">kernel-lt-tools-libs.x86_64                                <span class="number">4.4</span><span class="meta">.138</span>-<span class="number">1.</span>el7.elrepo                          elrepo-kernel</span><br><span class="line">kernel-lt-tools-libs-devel.x86_64                          <span class="number">4.4</span><span class="meta">.138</span>-<span class="number">1.</span>el7.elrepo                          elrepo-kernel</span><br><span class="line">kernel-ml.x86_64                                           <span class="number">4.17</span><span class="meta">.2</span>-<span class="number">1.</span>el7.elrepo                           elrepo-kernel</span><br><span class="line">kernel-ml-devel.x86_64                                     <span class="number">4.17</span><span class="meta">.2</span>-<span class="number">1.</span>el7.elrepo                           elrepo-kernel</span><br><span class="line">kernel-ml-doc.noarch                                       <span class="number">4.17</span><span class="meta">.2</span>-<span class="number">1.</span>el7.elrepo                           elrepo-kernel</span><br><span class="line">kernel-ml-headers.x86_64                                   <span class="number">4.17</span><span class="meta">.2</span>-<span class="number">1.</span>el7.elrepo                           elrepo-kernel</span><br><span class="line">kernel-ml-tools.x86_64                                     <span class="number">4.17</span><span class="meta">.2</span>-<span class="number">1.</span>el7.elrepo                           elrepo-kernel</span><br><span class="line">kernel-ml-tools-libs.x86_64                                <span class="number">4.17</span><span class="meta">.2</span>-<span class="number">1.</span>el7.elrepo                           elrepo-kernel</span><br><span class="line">kernel-ml-tools-libs-devel.x86_64                          <span class="number">4.17</span><span class="meta">.2</span>-<span class="number">1.</span>el7.elrepo                           elrepo-kernel</span><br><span class="line">perf.x86_64                                                <span class="number">4.17</span><span class="meta">.2</span>-<span class="number">1.</span>el7.elrepo                           elrepo-kernel</span><br><span class="line">python-perf.x86_64                                         <span class="number">4.17</span><span class="meta">.2</span>-<span class="number">1.</span>el7.elrepo                           elrepo-kernel</span><br></pre></td></tr></table></figure><h3 id="安装最新主线稳定内核"><a href="#安装最新主线稳定内核" class="headerlink" title="安装最新主线稳定内核"></a>安装最新主线稳定内核</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr_host /]# yum --enablerepo=elrepo-kernel install kernel-<span class="keyword">ml</span></span><br><span class="line"></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">base                                                                                           | 3.6 kB  00:00:00</span><br><span class="line">elrepo                                                                                         | 2.9 kB  00:00:00</span><br><span class="line">epel/x86_64/metalink                                                                           |  19 kB  00:00:00</span><br><span class="line">epel                                                                                           | 3.2 kB  00:00:00</span><br><span class="line">https:<span class="comment">//epel.mirror.constant.com/7/x86_64/repodata/repomd.xml: [Errno -1] repomd.xml does not match metalink for epel</span></span><br><span class="line">Trying other mirror.</span><br><span class="line">epel                                                                                           | 3.2 kB  00:00:00</span><br><span class="line">extras                                                                                         | 3.4 kB  00:00:00</span><br><span class="line">updates                                                                                        | 3.4 kB  00:00:00</span><br><span class="line">(1/8): base/7/x86_64/group_gz                                                                  | 166 kB  00:00:01</span><br><span class="line">(2/8): epel/x86_64/group_gz                                                                    |  88 kB  00:00:01</span><br><span class="line">(3/8): elrepo/primary_db                                                                       | 592 kB  00:00:01</span><br><span class="line">(4/8): extras/7/x86_64/primary_db                                                              | 149 kB  00:00:00</span><br><span class="line">epel/x86_64/primary            FAILED</span><br><span class="line">https:<span class="comment">//sjc.edge.kernel.org/fedora-buffet/epel/7/x86_64/repodata/e8475f9ad0cd11429e1cf75752a6dd6fe2b5357a523232eff56af83454c9a3cd-primary.xml.gz: [Errno 14] HTTPS Error 404 - Not Found</span></span><br><span class="line">Trying other mirror.</span><br><span class="line">To address this issue please refer to the below wiki article</span><br><span class="line"></span><br><span class="line">https:<span class="comment">//wiki.centos.org/yum-errors</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> above article doesn't <span class="keyword">help</span> to resolve this issue please <span class="keyword">use</span> https:<span class="comment">//bugs.centos.org/.</span></span><br><span class="line"></span><br><span class="line">(5/8): epel/x86_64/updateinfo                                                                  | 933 kB  00:00:02</span><br><span class="line">(6/8): updates/7/x86_64/primary_db                                                             | 2.7 MB  00:00:02</span><br><span class="line">(7/8): epel/x86_64/primary                                                                     | 3.5 MB  00:00:05</span><br><span class="line">(8/8): base/7/x86_64/primary_db                                                                | 5.9 MB  00:02:04</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"><span class="comment"> * base: mirror.fileplanet.com</span></span><br><span class="line"><span class="comment"> * elrepo: mirrors.thzhost.com</span></span><br><span class="line"><span class="comment"> * elrepo-kernel: mirrors.thzhost.com</span></span><br><span class="line"><span class="comment"> * epel: mirror.sjc02.svwh.net</span></span><br><span class="line"><span class="comment"> * extras: mirror.fileplanet.com</span></span><br><span class="line"><span class="comment"> * updates: mirror.fileplanet.com</span></span><br><span class="line">epel                                                                                                      12585/12585</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package kernel-<span class="keyword">ml</span>.x86_64 0:4.17.2-1.el7.elrepo will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">======================================================================================================================</span><br><span class="line"> Package                  <span class="keyword">Arch</span>                  <span class="keyword">Version</span>                            Repository                    Size</span><br><span class="line">======================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> kernel-<span class="keyword">ml</span>                x86_64                4.17.2-1.el7.elrepo                elrepo-kernel                 45 <span class="built_in">M</span></span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">======================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line"><span class="keyword">Total</span> download size: 45 <span class="built_in">M</span></span><br><span class="line">Installed size: 201 <span class="built_in">M</span></span><br><span class="line">Is this ok [y/<span class="keyword">d</span>/<span class="keyword">N</span>]: y                       <span class="comment">// Yes</span></span><br><span class="line"></span><br><span class="line">Downloading packages:</span><br><span class="line">kernel-<span class="keyword">ml</span>-4.17.2-1.el7.elrepo.x86_64.rpm                                                       |  45 MB  00:00:06</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="keyword">test</span></span><br><span class="line">Transaction <span class="keyword">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">Warning: RPMDB altered outside of yum.</span><br><span class="line">  Installing : kernel-<span class="keyword">ml</span>-4.17.2-1.el7.elrepo.x86_64                                                               1/1</span><br><span class="line">  Verifying  : kernel-<span class="keyword">ml</span>-4.17.2-1.el7.elrepo.x86_64                                                               1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  kernel-<span class="keyword">ml</span>.x86_64 0:4.17.2-1.el7.elrepo</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><h3 id="修改默认启动内核"><a href="#修改默认启动内核" class="headerlink" title="修改默认启动内核"></a>修改默认启动内核</h3><h4 id="cnetos6"><a href="#cnetos6" class="headerlink" title="cnetos6"></a>cnetos6</h4><p>如果是centos6,直接通过/etc/grub.conf文件修改启动顺序<br>使用vi 或者vim命令修改<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /boot/grub/grub.conf</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line"><span class="comment">#boot=/dev/sda</span></span><br><span class="line"><span class="attribute">default</span>=1</span><br><span class="line"><span class="attribute">timeout</span>=5</span><br><span class="line"><span class="built_in">..</span>.</span><br></pre></td></tr></table></figure></p><p>其中default默认为0，将其修改为1即可  </p><h4 id="centos7"><a href="#centos7" class="headerlink" title="centos7"></a>centos7</h4><p>centos 7中是通过grub2引导启动顺序。需要执行相关命令。<br>1.查看当前系统所有内核<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@colinvps /]# cat boot/grub2/grub.cfg |grep menuentry</span><br><span class="line">if [ x<span class="string">"$&#123;feature_menuentry_id&#125;"</span> = xy ]; then</span><br><span class="line">  menuentry_id_option=<span class="string">"--id"</span></span><br><span class="line">  menuentry_id_option=<span class="string">""</span></span><br><span class="line">export menuentry_id_option</span><br><span class="line">menuentry 'CentOS Linux <span class="number">7</span> Rescue cf9fbca3fb7842b4915d9cd81c418fb1 (<span class="number">4.17</span><span class="number">.3</span><span class="number">-1.</span>el7.elrepo.x86_64)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux<span class="number">-3.10</span><span class="number">.0</span><span class="number">-123.</span>el7.x86_64-advanced-fe0109f2<span class="number">-6</span>f34<span class="number">-48</span>ae-b51e<span class="number">-1</span>f5fa78305b5' &#123;</span><br><span class="line">menuentry 'CentOS Linux (<span class="number">4.17</span><span class="number">.3</span><span class="number">-1.</span>el7.elrepo.x86_64) <span class="number">7</span> (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux<span class="number">-3.10</span><span class="number">.0</span><span class="number">-123.</span>el7.x86_64-advanced-fe0109f2<span class="number">-6</span>f34<span class="number">-48</span>ae-b51e<span class="number">-1</span>f5fa78305b5' &#123;</span><br><span class="line">menuentry 'CentOS Linux <span class="number">7</span> Rescue <span class="number">5491904015</span>ae6a4d828c6acbbfc755b1 (<span class="number">3.10</span><span class="number">.0</span><span class="number">-862.3</span><span class="number">.3</span>.el7.x86_64)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux<span class="number">-3.10</span><span class="number">.0</span><span class="number">-123.</span>el7.x86_64-advanced-fe0109f2<span class="number">-6</span>f34<span class="number">-48</span>ae-b51e<span class="number">-1</span>f5fa78305b5' &#123;</span><br><span class="line">menuentry 'CentOS Linux (<span class="number">3.10</span><span class="number">.0</span><span class="number">-862.3</span><span class="number">.3</span>.el7.x86_64) <span class="number">7</span> (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux<span class="number">-3.10</span><span class="number">.0</span><span class="number">-123.</span>el7.x86_64-advanced-fe0109f2<span class="number">-6</span>f34<span class="number">-48</span>ae-b51e<span class="number">-1</span>f5fa78305b5' &#123;</span><br><span class="line">menuentry 'CentOS Linux (<span class="number">3.10</span><span class="number">.0</span><span class="number">-123.4</span><span class="number">.2</span>.el7.x86_64) <span class="number">7</span> (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux<span class="number">-3.10</span><span class="number">.0</span><span class="number">-123.</span>el7.x86_64-advanced-fe0109f2<span class="number">-6</span>f34<span class="number">-48</span>ae-b51e<span class="number">-1</span>f5fa78305b5' &#123;</span><br><span class="line">menuentry 'CentOS Linux, with Linux <span class="number">3.10</span><span class="number">.0</span><span class="number">-123.</span>el7.x86_64' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux<span class="number">-3.10</span><span class="number">.0</span><span class="number">-123.</span>el7.x86_64-advanced-fe0109f2<span class="number">-6</span>f34<span class="number">-48</span>ae-b51e<span class="number">-1</span>f5fa78305b5' &#123;</span><br><span class="line">menuentry 'CentOS Linux, with Linux <span class="number">0</span>-rescue<span class="number">-11264912</span>be38456483e63dfd21d402f4' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux<span class="number">-0</span>-rescue<span class="number">-11264912</span>be38456483e63dfd21d402f4-advanced-fe0109f2<span class="number">-6</span>f34<span class="number">-48</span>ae-b51e<span class="number">-1</span>f5fa78305b5' &#123;</span><br><span class="line">[root@colinvps /]#</span><br></pre></td></tr></table></figure></p><p>2.设置默认启动内核<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">grub2-set-default</span> "<span class="selector-tag">CentOS</span> <span class="selector-tag">Linux</span> (4<span class="selector-class">.17</span><span class="selector-class">.3-1</span><span class="selector-class">.el7</span><span class="selector-class">.elrepo</span><span class="selector-class">.x86_64</span>) 7 (<span class="selector-tag">Core</span>)"</span><br></pre></td></tr></table></figure></p><p>3.检查结果<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@colinvps /]</span><span class="comment"># grub2-editenv list</span></span><br><span class="line"><span class="attr">saved_entry</span>=CentOS Linux (<span class="number">4.17</span>.<span class="number">3</span>-<span class="number">1</span>.el7.elrepo.x<span class="number">86_64</span>) <span class="number">7</span> (Core)</span><br></pre></td></tr></table></figure></p><p>设置成功</p><h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">reboot</span></span><br></pre></td></tr></table></figure><p>如果在之上修改默认启动内核没有成功，可在VPS服务提供的网页console 界面下使用reboot命令重启<br>在网页端口重启可通过方向键选择将进入的系统内核，类似PC下的bios选择系统<br>一般选择第二个，主要选择对应安装号码的内核就好，“(4.17.3-1.el7.elrepo.x86_64) 7 (Core)”  </p><h3 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h3><p>登陆后查看系统内核：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@vultr_host /]</span># <span class="selector-tag">uname</span> <span class="selector-tag">-sr</span></span><br><span class="line"><span class="selector-tag">Linux</span> 4<span class="selector-class">.17</span><span class="selector-class">.2-693</span><span class="selector-class">.21</span><span class="selector-class">.1</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br></pre></td></tr></table></figure></p><p>系统内核升级成功</p><h2 id="tcp算法改为BBR"><a href="#tcp算法改为BBR" class="headerlink" title="tcp算法改为BBR"></a>tcp算法改为BBR</h2><p>编辑系统文件<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vi</span> /etc/sysctl.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure></p><p>在该文件中加入以下两句<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net<span class="selector-class">.core</span><span class="selector-class">.default_qdisc</span> = fq</span><br><span class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_congestion_control</span> = bbr</span><br></pre></td></tr></table></figure></p><p>添加结果<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr_host /]# cat /etc/sysctl.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> sysctl settings are defined through files <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Vendors settings live <span class="keyword">in</span> /usr/lib/sysctl.d/.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To override a whole file, create a new file with the same <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/sysctl.d/ and put new settings there. To override</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> only specific settings, add a file with a lexically later</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> name <span class="keyword">in</span> /etc/sysctl.d/ and put new settings there.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For more information, see sysctl.conf(5) and sysctl.d(5).</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Accept IPv6 advertisements when forwarding is enabled</span></span><br><span class="line">net.ipv6.conf.all.accept_ra = 2</span><br><span class="line">net.ipv6.conf.eth0.accept_ra = 2</span><br><span class="line">net.core.default_qdisc = fq</span><br><span class="line">net.ipv4.tcp_congestion_control = bbr</span><br></pre></td></tr></table></figure></p><h3 id="配置生效"><a href="#配置生效" class="headerlink" title="配置生效"></a>配置生效</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr_host /]# sysctl -p</span><br><span class="line"><span class="keyword">net</span>.ipv6.<span class="keyword">conf</span>.all.accept_ra = 2</span><br><span class="line"><span class="keyword">net</span>.ipv6.<span class="keyword">conf</span>.eth0.accept_ra = 2</span><br><span class="line"><span class="keyword">net</span>.core.default_qdisc = fq</span><br><span class="line"><span class="keyword">net</span>.ipv4.tcp_congestion_control = bbr</span><br></pre></td></tr></table></figure><h3 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@vultr_host</span> /]<span class="meta"># sysctl net.ipv4.tcp_available_congestion_control</span></span><br><span class="line">net.ipv4.tcp_available_congestion_control = reno cubic bbr</span><br></pre></td></tr></table></figure><p>结果带有bbr  </p><p>成功使用BBR算法<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@vultr_host</span> /]<span class="meta"># lsmod|grep bbr</span></span><br><span class="line">tcp_bbr                <span class="number">20480</span>  <span class="number">1</span></span><br></pre></td></tr></table></figure></p><h2 id="安装go"><a href="#安装go" class="headerlink" title="安装go"></a>安装go</h2><p>下载<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@colinvps /]</span># <span class="selector-tag">cd</span> /<span class="selector-tag">usr</span>/<span class="selector-tag">local</span></span><br><span class="line"><span class="selector-attr">[root@colinvps local]</span># <span class="selector-tag">ls</span></span><br><span class="line"><span class="selector-tag">bin</span>  <span class="selector-tag">etc</span>  <span class="selector-tag">games</span>  <span class="selector-tag">include</span>  <span class="selector-tag">lib</span>  <span class="selector-tag">lib64</span>  <span class="selector-tag">libexec</span>  <span class="selector-tag">sbin</span>  <span class="selector-tag">share</span>  <span class="selector-tag">src</span></span><br><span class="line"><span class="selector-attr">[root@colinvps local]</span># <span class="selector-tag">wget</span> <span class="selector-tag">https</span>:<span class="comment">//storage.googleapis.com/golang/go1.6.3.linux-amd64.tar.gz</span></span><br><span class="line"><span class="selector-tag">--2018-07-03</span> <span class="selector-tag">00</span><span class="selector-pseudo">:06</span><span class="selector-pseudo">:49--</span>  <span class="selector-tag">https</span>:<span class="comment">//storage.googleapis.com/golang/go1.6.3.linux-amd64.tar.gz</span></span><br><span class="line"><span class="selector-tag">Resolving</span> <span class="selector-tag">storage</span><span class="selector-class">.googleapis</span><span class="selector-class">.com</span> (storage.googleapis.com)... <span class="selector-tag">172</span><span class="selector-class">.217</span><span class="selector-class">.14</span><span class="selector-class">.112</span>, <span class="selector-tag">2607</span><span class="selector-pseudo">:f8b0</span><span class="selector-pseudo">:4007</span><span class="selector-pseudo">:80e</span><span class="selector-pseudo">::2010</span></span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">storage</span><span class="selector-class">.googleapis</span><span class="selector-class">.com</span> (storage.googleapis.com)|<span class="selector-tag">172</span><span class="selector-class">.217</span><span class="selector-class">.14</span><span class="selector-class">.112</span>|<span class="selector-pseudo">:443...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">200</span> <span class="selector-tag">OK</span></span><br><span class="line"><span class="selector-tag">Length</span>: <span class="selector-tag">84856920</span> (<span class="number">81</span>M) <span class="selector-attr">[application/x-gzip]</span></span><br><span class="line"><span class="selector-tag">Saving</span> <span class="selector-tag">to</span>: ‘<span class="selector-tag">go1</span><span class="selector-class">.6</span><span class="selector-class">.3</span><span class="selector-class">.linux-amd64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>’</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">100%</span><span class="selector-attr">[===============================================================================================&gt;]</span> <span class="selector-tag">84</span>,<span class="selector-tag">856</span>,<span class="selector-tag">920</span>  <span class="selector-tag">52</span><span class="selector-class">.5MB</span>/<span class="selector-tag">s</span>   <span class="selector-tag">in</span> <span class="selector-tag">1</span><span class="selector-class">.5s</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">2018-07-03</span> <span class="selector-tag">00</span><span class="selector-pseudo">:06</span><span class="selector-pseudo">:51</span> (<span class="number">52.5</span> MB/s) <span class="selector-tag">-</span> ‘<span class="selector-tag">go1</span><span class="selector-class">.6</span><span class="selector-class">.3</span><span class="selector-class">.linux-amd64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>’ <span class="selector-tag">saved</span> <span class="selector-attr">[84856920/84856920]</span></span><br></pre></td></tr></table></figure></p><p>解压，这里日志比较长，只给命令<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@colinvps /]</span># <span class="selector-tag">tar</span> <span class="selector-tag">-xvf</span> <span class="selector-tag">go1</span><span class="selector-class">.6</span><span class="selector-class">.3linux-amd64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure></p><p>添加环境变量，加入以下两行<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@colinvps /]# vi /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">GOROOT</span>=/usr/local/go</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:$GOROOT/bin</span><br></pre></td></tr></table></figure></p><p>重载<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@colinvps</span> /]<span class="meta"># source /etc/profile</span></span><br></pre></td></tr></table></figure></p><p>在 ~ 目录设置自己的GOPATH<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@colinvps ~]# vi .bash_profile</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">GOPATH</span>=<span class="variable">$HOME</span>/shadowsocks</span><br></pre></td></tr></table></figure></p><p>重载<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@colinvps</span> ~]<span class="meta"># source .bash_profile</span></span><br></pre></td></tr></table></figure></p><h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><span class="line">[root@colinvps ~]#  yum install git</span><br><span class="line">        </span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirror.san.fastserv.com</span><br><span class="line"> * elrepo: repos.lax-noc.com</span><br><span class="line"> * extras: mirrors.xmission.com</span><br><span class="line"> * updates: mirror.scalabledns.com</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package git.x86_64 0:1.8.3.1<span class="string">-14</span>.el7_5 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl-Git = 1.8.3.1<span class="string">-14</span>.el7_5 for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl &gt;= 5.008 for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: rsync for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(warnings) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(vars) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(strict) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(lib) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Term::ReadKey) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Git) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Getopt::Long) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(File::stat) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(File::Temp) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(File::Spec) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(File::Path) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(File::Find) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(File::Copy) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(File::Basename) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Exporter) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Error) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: /usr/bin/perl for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Processing Dependency: libgnome-keyring.so.0()(64bit) for package: git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package libgnome-keyring.x86_64 0:3.12.0<span class="string">-1</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl.x86_64 4:5.16.3<span class="string">-292</span>.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl-libs = 4:5.16.3<span class="string">-292</span>.el7 for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Socket) &gt;= 1.3 for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Scalar::Util) &gt;= 1.10 for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl-macros for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl-libs for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(threads::shared) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(threads) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(constant) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Time::Local) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Time::HiRes) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Storable) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Socket) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Scalar::Util) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Pod::Simple::XHTML) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Pod::Simple::Search) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Filter::Util::Call) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: perl(Carp) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: libperl.so()(64bit) for package: 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64</span><br><span class="line">---&gt; Package perl-Error.noarch 1:0.17020<span class="string">-2</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Exporter.noarch 0:5.68<span class="string">-3</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-File-Path.noarch 0:2.09<span class="string">-2</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-File-Temp.noarch 0:0.23.01<span class="string">-3</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Getopt-Long.noarch 0:2.40<span class="string">-3</span>.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl(Pod::Usage) &gt;= 1.14 for package: perl-Getopt-Long<span class="string">-2</span>.40<span class="string">-3</span>.el7.noarch</span><br><span class="line">--&gt; Processing Dependency: perl(Text::ParseWords) for package: perl-Getopt-Long<span class="string">-2</span>.40<span class="string">-3</span>.el7.noarch</span><br><span class="line">---&gt; Package perl-Git.noarch 0:1.8.3.1<span class="string">-14</span>.el7_5 will be installed</span><br><span class="line">---&gt; Package perl-PathTools.x86_64 0:3.40<span class="string">-5</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-TermReadKey.x86_64 0:2.30<span class="string">-20</span>.el7 will be installed</span><br><span class="line">---&gt; Package rsync.x86_64 0:3.1.2<span class="string">-4</span>.el7 will be installed</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package perl-Carp.noarch 0:1.26<span class="string">-244</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Filter.x86_64 0:1.49<span class="string">-3</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Pod-Simple.noarch 1:3.28<span class="string">-4</span>.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl(Pod::Escapes) &gt;= 1.04 for package: 1:perl-Pod-Simple<span class="string">-3</span>.28<span class="string">-4</span>.el7.noarch</span><br><span class="line">--&gt; Processing Dependency: perl(Encode) for package: 1:perl-Pod-Simple<span class="string">-3</span>.28<span class="string">-4</span>.el7.noarch</span><br><span class="line">---&gt; Package perl-Pod-Usage.noarch 0:1.63<span class="string">-3</span>.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl(Pod::Text) &gt;= 3.15 for package: perl-Pod-Usage<span class="string">-1</span>.63<span class="string">-3</span>.el7.noarch</span><br><span class="line">--&gt; Processing Dependency: perl-Pod-Perldoc for package: perl-Pod-Usage<span class="string">-1</span>.63<span class="string">-3</span>.el7.noarch</span><br><span class="line">---&gt; Package perl-Scalar-List-Utils.x86_64 0:1.27<span class="string">-248</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Socket.x86_64 0:2.010<span class="string">-4</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Storable.x86_64 0:2.45<span class="string">-3</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Text-ParseWords.noarch 0:3.29<span class="string">-4</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Time-HiRes.x86_64 4:1.9725<span class="string">-3</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Time-Local.noarch 0:1.2300<span class="string">-2</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-constant.noarch 0:1.27<span class="string">-2</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-libs.x86_64 4:5.16.3<span class="string">-292</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-macros.x86_64 4:5.16.3<span class="string">-292</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-threads.x86_64 0:1.87<span class="string">-4</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-threads-shared.x86_64 0:1.43<span class="string">-6</span>.el7 will be installed</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package perl-Encode.x86_64 0:2.51<span class="string">-7</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Pod-Escapes.noarch 1:1.04<span class="string">-292</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-Pod-Perldoc.noarch 0:3.20<span class="string">-4</span>.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl(parent) for package: perl-Pod-Perldoc<span class="string">-3</span>.20<span class="string">-4</span>.el7.noarch</span><br><span class="line">--&gt; Processing Dependency: perl(HTTP::Tiny) for package: perl-Pod-Perldoc<span class="string">-3</span>.20<span class="string">-4</span>.el7.noarch</span><br><span class="line">---&gt; Package perl-podlators.noarch 0:2.5.1<span class="string">-3</span>.el7 will be installed</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package perl-HTTP-Tiny.noarch 0:0.033<span class="string">-3</span>.el7 will be installed</span><br><span class="line">---&gt; Package perl-parent.noarch 1:0.225<span class="string">-244</span>.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">============================================================================================</span><br><span class="line"> Package                       Arch          Version                   Repository      Size</span><br><span class="line">============================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> git                           x86_64        1.8.3.1<span class="string">-14</span>.el7_5          updates        4.4 M</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> libgnome-keyring              x86_64        3.12.0<span class="string">-1</span>.el7              base           109 k</span><br><span class="line"> perl                          x86_64        4:5.16.3<span class="string">-292</span>.el7          base           8.0 M</span><br><span class="line"> perl-Carp                     noarch        1.26<span class="string">-244</span>.el7              base            19 k</span><br><span class="line"> perl-Encode                   x86_64        2.51<span class="string">-7</span>.el7                base           1.5 M</span><br><span class="line"> perl-Error                    noarch        1:0.17020<span class="string">-2</span>.el7           base            32 k</span><br><span class="line"> perl-Exporter                 noarch        5.68<span class="string">-3</span>.el7                base            28 k</span><br><span class="line"> perl-File-Path                noarch        2.09<span class="string">-2</span>.el7                base            26 k</span><br><span class="line"> perl-File-Temp                noarch        0.23.01<span class="string">-3</span>.el7             base            56 k</span><br><span class="line"> perl-Filter                   x86_64        1.49<span class="string">-3</span>.el7                base            76 k</span><br><span class="line"> perl-Getopt-Long              noarch        2.40<span class="string">-3</span>.el7                base            56 k</span><br><span class="line"> perl-Git                      noarch        1.8.3.1<span class="string">-14</span>.el7_5          updates         54 k</span><br><span class="line"> perl-HTTP-Tiny                noarch        0.033<span class="string">-3</span>.el7               base            38 k</span><br><span class="line"> perl-PathTools                x86_64        3.40<span class="string">-5</span>.el7                base            82 k</span><br><span class="line"> perl-Pod-Escapes              noarch        1:1.04<span class="string">-292</span>.el7            base            51 k</span><br><span class="line"> perl-Pod-Perldoc              noarch        3.20<span class="string">-4</span>.el7                base            87 k</span><br><span class="line"> perl-Pod-Simple               noarch        1:3.28<span class="string">-4</span>.el7              base           216 k</span><br><span class="line"> perl-Pod-Usage                noarch        1.63<span class="string">-3</span>.el7                base            27 k</span><br><span class="line"> perl-Scalar-List-Utils        x86_64        1.27<span class="string">-248</span>.el7              base            36 k</span><br><span class="line"> perl-Socket                   x86_64        2.010<span class="string">-4</span>.el7               base            49 k</span><br><span class="line"> perl-Storable                 x86_64        2.45<span class="string">-3</span>.el7                base            77 k</span><br><span class="line"> perl-TermReadKey              x86_64        2.30<span class="string">-20</span>.el7               base            31 k</span><br><span class="line"> perl-Text-ParseWords          noarch        3.29<span class="string">-4</span>.el7                base            14 k</span><br><span class="line"> perl-Time-HiRes               x86_64        4:1.9725<span class="string">-3</span>.el7            base            45 k</span><br><span class="line"> perl-Time-Local               noarch        1.2300<span class="string">-2</span>.el7              base            24 k</span><br><span class="line"> perl-constant                 noarch        1.27<span class="string">-2</span>.el7                base            19 k</span><br><span class="line"> perl-libs                     x86_64        4:5.16.3<span class="string">-292</span>.el7          base           688 k</span><br><span class="line"> perl-macros                   x86_64        4:5.16.3<span class="string">-292</span>.el7          base            43 k</span><br><span class="line"> perl-parent                   noarch        1:0.225<span class="string">-244</span>.el7           base            12 k</span><br><span class="line"> perl-podlators                noarch        2.5.1<span class="string">-3</span>.el7               base           112 k</span><br><span class="line"> perl-threads                  x86_64        1.87<span class="string">-4</span>.el7                base            49 k</span><br><span class="line"> perl-threads-shared           x86_64        1.43<span class="string">-6</span>.el7                base            39 k</span><br><span class="line"> rsync                         x86_64        3.1.2<span class="string">-4</span>.el7               base           403 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">============================================================================================</span><br><span class="line">Install  1 Package (<span class="string">+32</span> Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 16 M</span><br><span class="line">Installed size: 60 M</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">(1/33): git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64.rpm                              | 4.4 MB  00:00:00</span><br><span class="line">(2/33): libgnome-keyring<span class="string">-3</span>.12.0<span class="string">-1</span>.el7.x86_64.rpm                     | 109 kB  00:00:00</span><br><span class="line">(3/33): perl-Carp<span class="string">-1</span>.26<span class="string">-244</span>.el7.noarch.rpm                            |  19 kB  00:00:00</span><br><span class="line">(4/33): perl-Encode<span class="string">-2</span>.51<span class="string">-7</span>.el7.x86_64.rpm                            | 1.5 MB  00:00:00</span><br><span class="line">(5/33): perl-Error<span class="string">-0</span>.17020<span class="string">-2</span>.el7.noarch.rpm                          |  32 kB  00:00:00</span><br><span class="line">(6/33): perl-Exporter<span class="string">-5</span>.68<span class="string">-3</span>.el7.noarch.rpm                          |  28 kB  00:00:00</span><br><span class="line">(7/33): perl-File-Path<span class="string">-2</span>.09<span class="string">-2</span>.el7.noarch.rpm                         |  26 kB  00:00:00</span><br><span class="line">(8/33): perl-File-Temp<span class="string">-0</span>.23.01<span class="string">-3</span>.el7.noarch.rpm                      |  56 kB  00:00:00</span><br><span class="line">(9/33): perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64.rpm                               | 8.0 MB  00:00:01</span><br><span class="line">(10/33): perl-Git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.noarch.rpm                        |  54 kB  00:00:00</span><br><span class="line">(11/33): perl-Filter<span class="string">-1</span>.49<span class="string">-3</span>.el7.x86_64.rpm                           |  76 kB  00:00:00</span><br><span class="line">(12/33): perl-Getopt-Long<span class="string">-2</span>.40<span class="string">-3</span>.el7.noarch.rpm                      |  56 kB  00:00:00</span><br><span class="line">(13/33): perl-HTTP-Tiny<span class="string">-0</span>.033<span class="string">-3</span>.el7.noarch.rpm                       |  38 kB  00:00:00</span><br><span class="line">(14/33): perl-Pod-Escapes<span class="string">-1</span>.04<span class="string">-292</span>.el7.noarch.rpm                    |  51 kB  00:00:00</span><br><span class="line">(15/33): perl-PathTools<span class="string">-3</span>.40<span class="string">-5</span>.el7.x86_64.rpm                        |  82 kB  00:00:00</span><br><span class="line">(16/33): perl-Pod-Perldoc<span class="string">-3</span>.20<span class="string">-4</span>.el7.noarch.rpm                      |  87 kB  00:00:00</span><br><span class="line">(17/33): perl-Pod-Usage<span class="string">-1</span>.63<span class="string">-3</span>.el7.noarch.rpm                        |  27 kB  00:00:00</span><br><span class="line">(18/33): perl-Pod-Simple<span class="string">-3</span>.28<span class="string">-4</span>.el7.noarch.rpm                       | 216 kB  00:00:00</span><br><span class="line">(19/33): perl-Scalar-List-Utils<span class="string">-1</span>.27<span class="string">-248</span>.el7.x86_64.rpm              |  36 kB  00:00:00</span><br><span class="line">(20/33): perl-Socket<span class="string">-2</span>.010<span class="string">-4</span>.el7.x86_64.rpm                          |  49 kB  00:00:00</span><br><span class="line">(21/33): perl-TermReadKey<span class="string">-2</span>.30<span class="string">-20</span>.el7.x86_64.rpm                     |  31 kB  00:00:00</span><br><span class="line">(22/33): perl-Storable<span class="string">-2</span>.45<span class="string">-3</span>.el7.x86_64.rpm                         |  77 kB  00:00:00</span><br><span class="line">(23/33): perl-Text-ParseWords<span class="string">-3</span>.29<span class="string">-4</span>.el7.noarch.rpm                  |  14 kB  00:00:00</span><br><span class="line">(24/33): perl-Time-HiRes<span class="string">-1</span>.9725<span class="string">-3</span>.el7.x86_64.rpm                     |  45 kB  00:00:00</span><br><span class="line">(25/33): perl-Time-Local<span class="string">-1</span>.2300<span class="string">-2</span>.el7.noarch.rpm                     |  24 kB  00:00:00</span><br><span class="line">(26/33): perl-constant<span class="string">-1</span>.27<span class="string">-2</span>.el7.noarch.rpm                         |  19 kB  00:00:00</span><br><span class="line">(27/33): perl-macros<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64.rpm                       |  43 kB  00:00:00</span><br><span class="line">(28/33): perl-parent<span class="string">-0</span>.225<span class="string">-244</span>.el7.noarch.rpm                        |  12 kB  00:00:00</span><br><span class="line">(29/33): perl-libs<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64.rpm                         | 688 kB  00:00:00</span><br><span class="line">(30/33): perl-podlators<span class="string">-2</span>.5.1<span class="string">-3</span>.el7.noarch.rpm                       | 112 kB  00:00:00</span><br><span class="line">(31/33): perl-threads<span class="string">-1</span>.87<span class="string">-4</span>.el7.x86_64.rpm                          |  49 kB  00:00:00</span><br><span class="line">(32/33): perl-threads-shared<span class="string">-1</span>.43<span class="string">-6</span>.el7.x86_64.rpm                   |  39 kB  00:00:00</span><br><span class="line">(33/33): rsync<span class="string">-3</span>.1.2<span class="string">-4</span>.el7.x86_64.rpm                                | 403 kB  00:00:00</span><br><span class="line">--------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                       4.9 MB/s |  16 MB  00:00:03</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : 1:perl-parent<span class="string">-0</span>.225<span class="string">-244</span>.el7.noarch                                      1/33</span><br><span class="line">  Installing : perl-HTTP-Tiny<span class="string">-0</span>.033<span class="string">-3</span>.el7.noarch                                       2/33</span><br><span class="line">  Installing : perl-podlators<span class="string">-2</span>.5.1<span class="string">-3</span>.el7.noarch                                       3/33</span><br><span class="line">  Installing : perl-Pod-Perldoc<span class="string">-3</span>.20<span class="string">-4</span>.el7.noarch                                      4/33</span><br><span class="line">  Installing : 1:perl-Pod-Escapes<span class="string">-1</span>.04<span class="string">-292</span>.el7.noarch                                  5/33</span><br><span class="line">  Installing : perl-Text-ParseWords<span class="string">-3</span>.29<span class="string">-4</span>.el7.noarch                                  6/33</span><br><span class="line">  Installing : perl-Encode<span class="string">-2</span>.51<span class="string">-7</span>.el7.x86_64                                           7/33</span><br><span class="line">  Installing : perl-Pod-Usage<span class="string">-1</span>.63<span class="string">-3</span>.el7.noarch                                        8/33</span><br><span class="line">  Installing : 4:perl-macros<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64                                     9/33</span><br><span class="line">  Installing : 4:perl-libs<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64                                      10/33</span><br><span class="line">  Installing : 4:perl-Time-HiRes<span class="string">-1</span>.9725<span class="string">-3</span>.el7.x86_64                                  11/33</span><br><span class="line">  Installing : perl-Exporter<span class="string">-5</span>.68<span class="string">-3</span>.el7.noarch                                        12/33</span><br><span class="line">  Installing : perl-constant<span class="string">-1</span>.27<span class="string">-2</span>.el7.noarch                                        13/33</span><br><span class="line">  Installing : perl-Time-Local<span class="string">-1</span>.2300<span class="string">-2</span>.el7.noarch                                    14/33</span><br><span class="line">  Installing : perl-Socket<span class="string">-2</span>.010<span class="string">-4</span>.el7.x86_64                                         15/33</span><br><span class="line">  Installing : perl-Carp<span class="string">-1</span>.26<span class="string">-244</span>.el7.noarch                                          16/33</span><br><span class="line">  Installing : perl-Storable<span class="string">-2</span>.45<span class="string">-3</span>.el7.x86_64                                        17/33</span><br><span class="line">  Installing : perl-PathTools<span class="string">-3</span>.40<span class="string">-5</span>.el7.x86_64                                       18/33</span><br><span class="line">  Installing : perl-Scalar-List-Utils<span class="string">-1</span>.27<span class="string">-248</span>.el7.x86_64                             19/33</span><br><span class="line">  Installing : perl-File-Temp<span class="string">-0</span>.23.01<span class="string">-3</span>.el7.noarch                                    20/33</span><br><span class="line">  Installing : perl-File-Path<span class="string">-2</span>.09<span class="string">-2</span>.el7.noarch                                       21/33</span><br><span class="line">  Installing : perl-threads-shared<span class="string">-1</span>.43<span class="string">-6</span>.el7.x86_64                                  22/33</span><br><span class="line">  Installing : perl-threads<span class="string">-1</span>.87<span class="string">-4</span>.el7.x86_64                                         23/33</span><br><span class="line">  Installing : perl-Filter<span class="string">-1</span>.49<span class="string">-3</span>.el7.x86_64                                          24/33</span><br><span class="line">  Installing : 1:perl-Pod-Simple<span class="string">-3</span>.28<span class="string">-4</span>.el7.noarch                                    25/33</span><br><span class="line">  Installing : perl-Getopt-Long<span class="string">-2</span>.40<span class="string">-3</span>.el7.noarch                                     26/33</span><br><span class="line">  Installing : 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64                                           27/33</span><br><span class="line">  Installing : 1:perl-Error<span class="string">-0</span>.17020<span class="string">-2</span>.el7.noarch                                      28/33</span><br><span class="line">  Installing : perl-TermReadKey<span class="string">-2</span>.30<span class="string">-20</span>.el7.x86_64                                    29/33</span><br><span class="line">  Installing : rsync<span class="string">-3</span>.1.2<span class="string">-4</span>.el7.x86_64                                               30/33</span><br><span class="line">  Installing : libgnome-keyring<span class="string">-3</span>.12.0<span class="string">-1</span>.el7.x86_64                                   31/33</span><br><span class="line">  Installing : perl-Git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.noarch                                       32/33</span><br><span class="line">  Installing : git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64                                            33/33</span><br><span class="line">  Verifying  : perl-HTTP-Tiny<span class="string">-0</span>.033<span class="string">-3</span>.el7.noarch                                       1/33</span><br><span class="line">  Verifying  : libgnome-keyring<span class="string">-3</span>.12.0<span class="string">-1</span>.el7.x86_64                                    2/33</span><br><span class="line">  Verifying  : perl-threads-shared<span class="string">-1</span>.43<span class="string">-6</span>.el7.x86_64                                   3/33</span><br><span class="line">  Verifying  : 4:perl-Time-HiRes<span class="string">-1</span>.9725<span class="string">-3</span>.el7.x86_64                                   4/33</span><br><span class="line">  Verifying  : perl-Exporter<span class="string">-5</span>.68<span class="string">-3</span>.el7.noarch                                         5/33</span><br><span class="line">  Verifying  : perl-constant<span class="string">-1</span>.27<span class="string">-2</span>.el7.noarch                                         6/33</span><br><span class="line">  Verifying  : perl-PathTools<span class="string">-3</span>.40<span class="string">-5</span>.el7.x86_64                                        7/33</span><br><span class="line">  Verifying  : 4:perl-macros<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64                                     8/33</span><br><span class="line">  Verifying  : 1:perl-parent<span class="string">-0</span>.225<span class="string">-244</span>.el7.noarch                                      9/33</span><br><span class="line">  Verifying  : 4:perl<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64                                           10/33</span><br><span class="line">  Verifying  : perl-TermReadKey<span class="string">-2</span>.30<span class="string">-20</span>.el7.x86_64                                    11/33</span><br><span class="line">  Verifying  : perl-File-Temp<span class="string">-0</span>.23.01<span class="string">-3</span>.el7.noarch                                    12/33</span><br><span class="line">  Verifying  : 1:perl-Pod-Simple<span class="string">-3</span>.28<span class="string">-4</span>.el7.noarch                                    13/33</span><br><span class="line">  Verifying  : perl-Time-Local<span class="string">-1</span>.2300<span class="string">-2</span>.el7.noarch                                    14/33</span><br><span class="line">  Verifying  : 4:perl-libs<span class="string">-5</span>.16.3<span class="string">-292</span>.el7.x86_64                                      15/33</span><br><span class="line">  Verifying  : perl-Socket<span class="string">-2</span>.010<span class="string">-4</span>.el7.x86_64                                         16/33</span><br><span class="line">  Verifying  : git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.x86_64                                            17/33</span><br><span class="line">  Verifying  : perl-Carp<span class="string">-1</span>.26<span class="string">-244</span>.el7.noarch                                          18/33</span><br><span class="line">  Verifying  : 1:perl-Error<span class="string">-0</span>.17020<span class="string">-2</span>.el7.noarch                                      19/33</span><br><span class="line">  Verifying  : perl-Storable<span class="string">-2</span>.45<span class="string">-3</span>.el7.x86_64                                        20/33</span><br><span class="line">  Verifying  : perl-Scalar-List-Utils<span class="string">-1</span>.27<span class="string">-248</span>.el7.x86_64                             21/33</span><br><span class="line">  Verifying  : 1:perl-Pod-Escapes<span class="string">-1</span>.04<span class="string">-292</span>.el7.noarch                                 22/33</span><br><span class="line">  Verifying  : rsync<span class="string">-3</span>.1.2<span class="string">-4</span>.el7.x86_64                                               23/33</span><br><span class="line">  Verifying  : perl-Pod-Usage<span class="string">-1</span>.63<span class="string">-3</span>.el7.noarch                                       24/33</span><br><span class="line">  Verifying  : perl-Git<span class="string">-1</span>.8.3.1<span class="string">-14</span>.el7_5.noarch                                       25/33</span><br><span class="line">  Verifying  : perl-Encode<span class="string">-2</span>.51<span class="string">-7</span>.el7.x86_64                                          26/33</span><br><span class="line">  Verifying  : perl-Pod-Perldoc<span class="string">-3</span>.20<span class="string">-4</span>.el7.noarch                                     27/33</span><br><span class="line">  Verifying  : perl-podlators<span class="string">-2</span>.5.1<span class="string">-3</span>.el7.noarch                                      28/33</span><br><span class="line">  Verifying  : perl-File-Path<span class="string">-2</span>.09<span class="string">-2</span>.el7.noarch                                       29/33</span><br><span class="line">  Verifying  : perl-threads<span class="string">-1</span>.87<span class="string">-4</span>.el7.x86_64                                         30/33</span><br><span class="line">  Verifying  : perl-Filter<span class="string">-1</span>.49<span class="string">-3</span>.el7.x86_64                                          31/33</span><br><span class="line">  Verifying  : perl-Getopt-Long<span class="string">-2</span>.40<span class="string">-3</span>.el7.noarch                                     32/33</span><br><span class="line">  Verifying  : perl-Text-ParseWords<span class="string">-3</span>.29<span class="string">-4</span>.el7.noarch                                 33/33</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  git.x86_64 0:1.8.3.1<span class="string">-14</span>.el7_5</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  libgnome-keyring.x86_64 0:3.12.0<span class="string">-1</span>.el7     perl.x86_64 4:5.16.3<span class="string">-292</span>.el7</span><br><span class="line">  perl-Carp.noarch 0:1.26<span class="string">-244</span>.el7            perl-Encode.x86_64 0:2.51<span class="string">-7</span>.el7</span><br><span class="line">  perl-Error.noarch 1:0.17020<span class="string">-2</span>.el7          perl-Exporter.noarch 0:5.68<span class="string">-3</span>.el7</span><br><span class="line">  perl-File-Path.noarch 0:2.09<span class="string">-2</span>.el7         perl-File-Temp.noarch 0:0.23.01<span class="string">-3</span>.el7</span><br><span class="line">  perl-Filter.x86_64 0:1.49<span class="string">-3</span>.el7            perl-Getopt-Long.noarch 0:2.40<span class="string">-3</span>.el7</span><br><span class="line">  perl-Git.noarch 0:1.8.3.1<span class="string">-14</span>.el7_5         perl-HTTP-Tiny.noarch 0:0.033<span class="string">-3</span>.el7</span><br><span class="line">  perl-PathTools.x86_64 0:3.40<span class="string">-5</span>.el7         perl-Pod-Escapes.noarch 1:1.04<span class="string">-292</span>.el7</span><br><span class="line">  perl-Pod-Perldoc.noarch 0:3.20<span class="string">-4</span>.el7       perl-Pod-Simple.noarch 1:3.28<span class="string">-4</span>.el7</span><br><span class="line">  perl-Pod-Usage.noarch 0:1.63<span class="string">-3</span>.el7         perl-Scalar-List-Utils.x86_64 0:1.27<span class="string">-248</span>.el7</span><br><span class="line">  perl-Socket.x86_64 0:2.010<span class="string">-4</span>.el7           perl-Storable.x86_64 0:2.45<span class="string">-3</span>.el7</span><br><span class="line">  perl-TermReadKey.x86_64 0:2.30<span class="string">-20</span>.el7      perl-Text-ParseWords.noarch 0:3.29<span class="string">-4</span>.el7</span><br><span class="line">  perl-Time-HiRes.x86_64 4:1.9725<span class="string">-3</span>.el7      perl-Time-Local.noarch 0:1.2300<span class="string">-2</span>.el7</span><br><span class="line">  perl-constant.noarch 0:1.27<span class="string">-2</span>.el7          perl-libs.x86_64 4:5.16.3<span class="string">-292</span>.el7</span><br><span class="line">  perl-macros.x86_64 4:5.16.3<span class="string">-292</span>.el7        perl-parent.noarch 1:0.225<span class="string">-244</span>.el7</span><br><span class="line">  perl-podlators.noarch 0:2.5.1<span class="string">-3</span>.el7        perl-threads.x86_64 0:1.87<span class="string">-4</span>.el7</span><br><span class="line">  perl-threads-shared.x86_64 0:1.43<span class="string">-6</span>.el7    rsync.x86_64 0:3.1.2<span class="string">-4</span>.el7</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><h2 id="安装shadowsocks"><a href="#安装shadowsocks" class="headerlink" title="安装shadowsocks"></a>安装shadowsocks</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@colinvps</span> ~]<span class="meta"># go get github.com/shadowsocks/shadowsocks-go/cmd/shadowsocks-server</span></span><br><span class="line"></span><br><span class="line">[root<span class="symbol">@colinvps</span> ~]<span class="meta"># cd shadowsocks</span></span><br><span class="line">[root<span class="symbol">@colinvps</span> shadowsocks]<span class="meta"># ls</span></span><br><span class="line">bin  pkg  src</span><br></pre></td></tr></table></figure><p>切换到bin目录下，使shadowsocks-server有可执行权限<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@colinvps</span> shadowsocks]<span class="meta"># cd bin</span></span><br><span class="line">./shadowsocks-server -h</span><br><span class="line"></span><br><span class="line">[root<span class="symbol">@colinvps</span> bin]<span class="meta"># chmod +x shadowsocks-server</span></span><br></pre></td></tr></table></figure></p><h2 id="配置config-json文件"><a href="#配置config-json文件" class="headerlink" title="配置config.json文件"></a>配置config.json文件</h2><p>在bin目录下<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@colinvps</span> bin]<span class="meta"># vi config.json</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"server"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="string">"port_password"</span>:&#123;</span><br><span class="line">         <span class="string">"7973"</span>:<span class="string">"123456"</span>,</span><br><span class="line">         <span class="string">"7884"</span>:<span class="string">"abcdef"</span>,</span><br><span class="line">         <span class="string">"7987"</span>:<span class="string">"1212112"</span>,</span><br><span class="line">         <span class="string">"7938"</span>:<span class="string">"1445566"</span>,</span><br><span class="line">        <span class="string">"7999"</span>:<span class="string">"345123"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"local_address"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="string">"local_port"</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="string">"timeout"</span>:<span class="number">600</span>,</span><br><span class="line">    <span class="string">"method"</span>:<span class="string">"aes-128-cfb"</span>,</span><br><span class="line">    <span class="string">"fast_open"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="string">"workers"</span>:<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>config文件参数配置：</p><h2 id="开放端口"><a href="#开放端口" class="headerlink" title="开放端口"></a>开放端口</h2><p>将以上config文件的端口添加到防火墙<br>这里使用firewall命令  </p><p>查看所有打开的端口： <figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@colinvps /]# firewall-cmd --zone=public --<span class="type">list</span>-ports</span><br><span class="line"><span class="number">7884</span>/tcp <span class="number">7987</span>/tcp <span class="number">7999</span>/tcp <span class="number">7938</span>/tcp <span class="number">7973</span>/tcp</span><br></pre></td></tr></table></figure></p><p>添加端口<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@colinvps /]# firewall-cmd --zone=public --add-port=80/tcp --permanent </span><br><span class="line">success</span><br><span class="line"></span><br><span class="line">[root@colinvps /]# firewall-cmd --zone=public --list-ports</span><br><span class="line">7884/tcp 7987/tcp 7999/tcp 7938/tcp 7973/tcp  80/tcp</span><br></pre></td></tr></table></figure></p><p>载入生效<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@colinvps</span> /]<span class="meta"># firewall-cmd --reload</span></span><br></pre></td></tr></table></figure></p><h2 id="开启shadowsocks服务"><a href="#开启shadowsocks服务" class="headerlink" title="开启shadowsocks服务"></a>开启shadowsocks服务</h2><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@colinvps /</span>]<span class="meta"># ./shadowsocks-server &gt; log &amp;</span></span><br><span class="line">[<span class="meta">1</span>] <span class="number">1642</span></span><br></pre></td></tr></table></figure><p>已成功开启<br>关闭服务<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@colinvps ~]<span class="comment"># ps aux|grep shadowsocks-server</span></span><br><span class="line">root     <span class="number"> 1642 </span> 0.1  1.0<span class="number"> 187916 </span><span class="number"> 5124 </span>pts/0    Sl   02:11   0:08 ./shadowsocks-server</span><br><span class="line">root     <span class="number"> 4749 </span> 0.0  0.4<span class="number"> 112716 </span><span class="number"> 2380 </span>pts/0    S+   04:31   0:00 grep --color=auto shadowsocks-server</span><br><span class="line"></span><br><span class="line">[root@colinvps ~]<span class="comment"># kill -9 4749</span></span><br></pre></td></tr></table></figure></p><h2 id="使用客户端测试链接"><a href="#使用客户端测试链接" class="headerlink" title="使用客户端测试链接"></a>使用客户端测试链接</h2><p>在<a href="https://github.com/shadowsocks/shadowsocks-windows/releases" target="_blank" rel="noopener">shadowsocks-windows</a>中下载客户端shadowsocks-windows客户端配置同服务器config.json文件一致就好，可根据不同端口配置不同密码<br>配置好相关的内容进行测试，启用系统代理，右键点开帮助-&gt;显示日志查看链接情况<br>点击<a href="https://www.google.com/" target="_blank" rel="noopener">谷歌</a>测试   </p><p>##备注</p><p>###重置密码VPS重启镜像后重置密码<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@colinvps ~]# passwd root</span><br><span class="line"><span class="keyword">New</span> password:</span><br><span class="line">Retype <span class="keyword">new</span> password:</span><br><span class="line">passwd: <span class="keyword">all</span> authentication tokens updated successfully.</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 工具人 ToolMan </category>
          
          <category> 网路 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> ML </tag>
            
            <tag> Linux </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>麻将胡牌算法</title>
      <link href="/2017/10/01/%E7%AE%97%E6%B3%95%20Algorithm/20171001-%E9%BA%BB%E5%B0%86%E8%83%A1%E7%89%8C%E7%AE%97%E6%B3%95/"/>
      <url>/2017/10/01/%E7%AE%97%E6%B3%95%20Algorithm/20171001-%E9%BA%BB%E5%B0%86%E8%83%A1%E7%89%8C%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>长久以来麻将胡牌算法是作为经典算法出现在各种应用中和试题中。<br>长久以来主要涉及两种算胡方法，其一为查表法，所有的胡牌牌型序列，将其存储在数据库或其他序列化文件中，使用时直接从内存中读取相应的内容进行查询。<br>另外一种算法则为拆分法，计算出当前牌型中的所有刻子，面和将，观察其是否满足3n+2的情况，本文着重说明拆分法的算法实现。<br><a id="more"></a></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路-"></a>思路-</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>1、将牌按连续性进行拆分，拆出的组合为3<em>n 或 3</em>n + 2，如果有例外，则不能胡。2、检查数量为3<em>n的连续段是否满足胡牌条件，如果都能满足，再用方法3检查3</em>n+2。<br>3、在连续的牌中，牌张数为3*n + 2的张数拆出可能的将牌。<br>4、扣除将牌后，分别检查各连续的段是否满足胡牌。</p><h3 id="检查段"><a href="#检查段" class="headerlink" title="检查段"></a>检查段</h3><p>   例：连续段为 🀝🀝🀝🀞🀟🀟🀠🀠🀡<br>       数字表示为 31221  </p><p>   a、取3位数为key，从下表查询，如果有结果则扣除这个数字。<br>      312取到结果300，则余下数字为1221<br>   b、如果a步骤没有结果，则取2位数为key<br>   c、如果b步骤没有结果，则取1位数为key<br>   如果c失败，则不能胡  </p><h3 id="31221拆分全步骤："><a href="#31221拆分全步骤：" class="headerlink" title="31221拆分全步骤："></a>31221拆分全步骤：</h3><p>   312 = 300 余 1221<br>   122 = 111 余 111<br>   111 = 111 全部拆分完毕，能胡  </p><h3 id="拆分表："><a href="#拆分表：" class="headerlink" title="拆分表："></a>拆分表：</h3><p>[3] = 3, [4] = 3,<br>[31] = 30, [32] = 30, 33 = 33, 34 = 33, 44 = 33,<br>[111] = 111, [112] = 111, [113] = 111, [114] = 114,<br>[122] = 111, [123] = 111, [124] = 111,<br>[133] = 111, [134] = 111,<br>[141] = 141, [142] = 141, [143] = 141, [144] = 144,<br>[222] = 222, [223] = 222, [224] = 222,<br>[233] = 222, [234] = 222,<br>[244] = 222,<br>[311] = 300, [312] = 300, [313] = 300, [314] = 300,<br>[322] = 300, [323] = 300, [324] = 300,<br>[331] = 330, [332] = 330, [333] = 333, [334] = 333,<br>[341] = 330, [342] = 330, [343] = 330, [344] = 333,<br>[411] = 411, [412] = 411, [413] = 411, [414] = 414,<br>[422] = 411, [423] = 411, [424] = 411,<br>[433] = 411, [434] = 411,<br>[441] = 441, [442] = 441, [443] = 441, [444] = 444  </p><h3 id="表格生成思路："><a href="#表格生成思路：" class="headerlink" title="表格生成思路："></a>表格生成思路：</h3><p>1、从边上取牌的数量<br>2、如果是1，则取111<br>3、如果是2，则取222<br>4、如果是3，则取3<br>5、如果是4，则取411  </p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>本部分实现代码为kotlin牌型的设定，以16进制数代表<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val cardList = intArrayOf(</span><br><span class="line">            <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>,       <span class="comment">//万</span></span><br><span class="line">            <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>, <span class="number">0x18</span>, <span class="number">0x19</span>,       <span class="comment">//索</span></span><br><span class="line">            <span class="number">0x21</span>, <span class="number">0x22</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0x28</span>, <span class="number">0x29</span>,       <span class="comment">//筒</span></span><br><span class="line">            <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span>,                   <span class="comment">//风</span></span><br><span class="line">            <span class="number">0x41</span>, <span class="number">0x42</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x45</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x48</span> <span class="comment">//春夏秋冬梅兰菊竹</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure></p><p>麻将牌<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">🀇🀈🀉🀊🀋🀌🀍🀎🀏</span><br><span class="line">🀐🀑🀒🀓🀔🀕🀖🀗🀘</span><br><span class="line">🀙🀚🀛🀜🀝🀞🀟🀠🀡</span><br><span class="line">🀀🀁🀂🀃🀄🀅🀆</span><br><span class="line">🀢🀣🀤🀥🀦🀧🀨🀩</span><br></pre></td></tr></table></figure></p><p>测胡牌型<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">🀇🀈🀉 🀉🀊🀋 🀆🀆🀆 🀐🀐 🀝🀝🀝🀟🀠🀡</span><br></pre></td></tr></table></figure></p><h3 id="前备函数"><a href="#前备函数" class="headerlink" title="前备函数"></a>前备函数</h3><p>取得特征值长度<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Len</span><span class="params">(wei:<span class="type">Int</span>)</span></span>=wei.toString().length</span><br></pre></td></tr></table></figure></p><p>10为底的幂函数<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">miIC</span><span class="params">(di: <span class="type">Int</span>, mi:<span class="type">Int</span>)</span></span>:<span class="built_in">Int</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (di==<span class="number">0</span>)  <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (mi&lt;<span class="number">0</span>)   <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> (mi==<span class="number">0</span>)  <span class="keyword">return</span> di</span><br><span class="line">        <span class="keyword">var</span> r=di</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span>.mi)</span><br><span class="line">            r*=<span class="number">10</span></span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>步进映射表<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">carry</span><span class="params">(key: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">when</span> (key) &#123;</span><br><span class="line">            <span class="number">3</span> -&gt; <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">            <span class="number">4</span> -&gt; <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">            <span class="number">31</span> -&gt; <span class="keyword">return</span> <span class="number">30</span></span><br><span class="line">            <span class="number">32</span> -&gt; <span class="keyword">return</span> <span class="number">30</span></span><br><span class="line">            <span class="number">33</span> -&gt; <span class="keyword">return</span> <span class="number">33</span></span><br><span class="line">            <span class="number">44</span> -&gt; <span class="keyword">return</span> <span class="number">33</span></span><br><span class="line"></span><br><span class="line">            <span class="number">111</span> -&gt; <span class="keyword">return</span> <span class="number">111</span></span><br><span class="line">            <span class="number">112</span> -&gt; <span class="keyword">return</span> <span class="number">111</span></span><br><span class="line">            <span class="number">113</span> -&gt; <span class="keyword">return</span> <span class="number">111</span></span><br><span class="line">            <span class="number">114</span> -&gt; <span class="keyword">return</span> <span class="number">114</span></span><br><span class="line"></span><br><span class="line">            <span class="number">122</span> -&gt; <span class="keyword">return</span> <span class="number">111</span></span><br><span class="line">            <span class="number">123</span> -&gt; <span class="keyword">return</span> <span class="number">111</span></span><br><span class="line">            <span class="number">124</span> -&gt; <span class="keyword">return</span> <span class="number">111</span></span><br><span class="line"></span><br><span class="line">            <span class="number">133</span> -&gt; <span class="keyword">return</span> <span class="number">111</span></span><br><span class="line">            <span class="number">134</span> -&gt; <span class="keyword">return</span> <span class="number">111</span></span><br><span class="line"></span><br><span class="line">            <span class="number">141</span> -&gt; <span class="keyword">return</span> <span class="number">141</span></span><br><span class="line">            <span class="number">142</span> -&gt; <span class="keyword">return</span> <span class="number">141</span></span><br><span class="line">            <span class="number">143</span> -&gt; <span class="keyword">return</span> <span class="number">141</span></span><br><span class="line">            <span class="number">144</span> -&gt; <span class="keyword">return</span> <span class="number">144</span></span><br><span class="line"></span><br><span class="line">            <span class="number">222</span> -&gt; <span class="keyword">return</span> <span class="number">222</span></span><br><span class="line">            <span class="number">223</span> -&gt; <span class="keyword">return</span> <span class="number">222</span></span><br><span class="line">            <span class="number">224</span> -&gt; <span class="keyword">return</span> <span class="number">222</span></span><br><span class="line"></span><br><span class="line">            <span class="number">233</span> -&gt; <span class="keyword">return</span> <span class="number">222</span></span><br><span class="line">            <span class="number">234</span> -&gt; <span class="keyword">return</span> <span class="number">222</span></span><br><span class="line">            <span class="number">244</span> -&gt; <span class="keyword">return</span> <span class="number">222</span></span><br><span class="line"></span><br><span class="line">            <span class="number">311</span> -&gt; <span class="keyword">return</span> <span class="number">300</span></span><br><span class="line">            <span class="number">312</span> -&gt; <span class="keyword">return</span> <span class="number">300</span></span><br><span class="line">            <span class="number">313</span> -&gt; <span class="keyword">return</span> <span class="number">300</span></span><br><span class="line">            <span class="number">314</span> -&gt; <span class="keyword">return</span> <span class="number">300</span></span><br><span class="line"></span><br><span class="line">            <span class="number">322</span> -&gt; <span class="keyword">return</span> <span class="number">300</span></span><br><span class="line">            <span class="number">323</span> -&gt; <span class="keyword">return</span> <span class="number">300</span></span><br><span class="line">            <span class="number">324</span> -&gt; <span class="keyword">return</span> <span class="number">300</span></span><br><span class="line"></span><br><span class="line">            <span class="number">331</span> -&gt; <span class="keyword">return</span> <span class="number">330</span></span><br><span class="line">            <span class="number">332</span> -&gt; <span class="keyword">return</span> <span class="number">330</span></span><br><span class="line">            <span class="number">333</span> -&gt; <span class="keyword">return</span> <span class="number">333</span></span><br><span class="line">            <span class="number">334</span> -&gt; <span class="keyword">return</span> <span class="number">333</span></span><br><span class="line"></span><br><span class="line">            <span class="number">341</span> -&gt; <span class="keyword">return</span> <span class="number">330</span></span><br><span class="line">            <span class="number">342</span> -&gt; <span class="keyword">return</span> <span class="number">330</span></span><br><span class="line">            <span class="number">343</span> -&gt; <span class="keyword">return</span> <span class="number">330</span></span><br><span class="line">            <span class="number">344</span> -&gt; <span class="keyword">return</span> <span class="number">333</span></span><br><span class="line"></span><br><span class="line">            <span class="number">411</span> -&gt; <span class="keyword">return</span> <span class="number">411</span></span><br><span class="line">            <span class="number">412</span> -&gt; <span class="keyword">return</span> <span class="number">411</span></span><br><span class="line">            <span class="number">413</span> -&gt; <span class="keyword">return</span> <span class="number">411</span></span><br><span class="line">            <span class="number">414</span> -&gt; <span class="keyword">return</span> <span class="number">414</span></span><br><span class="line"></span><br><span class="line">            <span class="number">422</span> -&gt; <span class="keyword">return</span> <span class="number">411</span></span><br><span class="line">            <span class="number">423</span> -&gt; <span class="keyword">return</span> <span class="number">411</span></span><br><span class="line">            <span class="number">424</span> -&gt; <span class="keyword">return</span> <span class="number">411</span></span><br><span class="line"></span><br><span class="line">            <span class="number">433</span> -&gt; <span class="keyword">return</span> <span class="number">411</span></span><br><span class="line">            <span class="number">434</span> -&gt; <span class="keyword">return</span> <span class="number">411</span></span><br><span class="line"></span><br><span class="line">            <span class="number">441</span> -&gt; <span class="keyword">return</span> <span class="number">441</span></span><br><span class="line">            <span class="number">442</span> -&gt; <span class="keyword">return</span> <span class="number">441</span></span><br><span class="line">            <span class="number">443</span> -&gt; <span class="keyword">return</span> <span class="number">441</span></span><br><span class="line">            <span class="number">444</span> -&gt; <span class="keyword">return</span> <span class="number">444</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="段辅助函数"><a href="#段辅助函数" class="headerlink" title="段辅助函数"></a>段辅助函数</h3><p>获取不同花色段的断点指针<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getBreaks</span><span class="params">(cardArr: <span class="type">IntArray</span>, len: <span class="type">Int</span>)</span></span>:List&lt;<span class="built_in">Int</span>&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> breaks= MutableList&lt;<span class="built_in">Int</span>&gt;(<span class="number">1</span>,&#123;<span class="number">0</span>&#125;)</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span> until len)</span><br><span class="line">        <span class="keyword">if</span> (cardArr[i] - cardArr[i - <span class="number">1</span>] &gt; <span class="number">1</span>)</span><br><span class="line">            breaks.add(i)</span><br><span class="line">    breaks.add(len)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> breaks</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>获得一段同花色牌型的key值，这里定义key值为wei<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getWei</span><span class="params">(breakS: <span class="type">Int</span>, breakE: <span class="type">Int</span>, cardArr: <span class="type">IntArray</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="comment">//breakS is index of break start,E is end</span></span><br><span class="line">        <span class="keyword">var</span> wei = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> (breakE<span class="number">-2</span>) downTo breakS) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cardArr[i] != cardArr[i + <span class="number">1</span>])</span><br><span class="line">                wei += miIC(<span class="number">1</span>, Len(wei))</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cardArr[i] == cardArr[i + <span class="number">1</span>])</span><br><span class="line">                wei += miIC(<span class="number">1</span>, Len(wei) - <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> wei</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>由以上俩函数得到一组牌中所有的wei<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getWeis</span><span class="params">(cardArr: <span class="type">IntArray</span>, len: <span class="type">Int</span>)</span></span>:List&lt;<span class="built_in">Int</span>&gt;&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> weis= MutableList&lt;<span class="built_in">Int</span>&gt;(<span class="number">0</span>,&#123;<span class="number">0</span>&#125;)</span><br><span class="line">        <span class="keyword">val</span> breaks = getBreaks(cardArr,len)</span><br><span class="line">        <span class="keyword">for</span> ( i <span class="keyword">in</span> <span class="number">0.</span>.(breaks.size<span class="number">-2</span>))&#123;</span><br><span class="line">            <span class="keyword">val</span> wei = getWei(breaks[i],breaks[i+<span class="number">1</span>],cardArr)</span><br><span class="line">            weis.add(wei)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  weis</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="去将"><a href="#去将" class="headerlink" title="去将"></a>去将</h3><p>拿到所有可能的将牌<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getJia</span><span class="params">(cardArr: <span class="type">IntArray</span>, len: <span class="type">Int</span>)</span></span>: IntArray &#123;</span><br><span class="line">        <span class="comment">//all jiangs in it's first index,same size as cardArr</span></span><br><span class="line">        <span class="keyword">var</span> flag = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">val</span> jiangs = IntArray(len)</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span> until len) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cardArr[i] == cardArr[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (flag) jiangs[i - <span class="number">1</span>] = cardArr[i]</span><br><span class="line">                flag = <span class="literal">false</span></span><br><span class="line">            &#125; <span class="keyword">else</span> flag = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jiangs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>去掉每个将后剩余牌组的集合<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">quJiangArrs</span><span class="params">(cardArr: <span class="type">IntArray</span>, jiangs: <span class="type">IntArray</span>, len: <span class="type">Int</span>)</span></span>: List&lt;IntArray&gt; &#123;</span><br><span class="line">        <span class="comment">//all (cardArr[]-jiang) in List</span></span><br><span class="line">        <span class="keyword">val</span> quJiangs = MutableList(<span class="number">0</span>,&#123; IntArray(len,&#123;<span class="number">0</span>&#125;) &#125;)</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until len)</span><br><span class="line">            <span class="keyword">if</span> (jiangs[i] != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">val</span> qujiang=cardArr.clone()</span><br><span class="line">                qujiang[i]=<span class="number">0</span></span><br><span class="line">                qujiang[i+<span class="number">1</span>]=<span class="number">0</span></span><br><span class="line">                SortL(qujiang,len)</span><br><span class="line">                quJiangs.add(qujiang)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> quJiangs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="拆分检测"><a href="#拆分检测" class="headerlink" title="拆分检测"></a>拆分检测</h3><p>取wei的前3位数为，如果映射集中有则扣除这个数字。<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">carryChange</span><span class="params">(weiA: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> lenW = Len(weiA)                           <span class="comment">//length_wei</span></span><br><span class="line">        <span class="keyword">for</span> (lenk <span class="keyword">in</span> <span class="number">3</span> downTo <span class="number">1</span>)&#123;                      <span class="comment">//length_key</span></span><br><span class="line">            <span class="keyword">if</span> (lenW-lenk&lt;<span class="number">0</span>)    <span class="keyword">continue</span>               <span class="comment">//carry keystart with 3key,if con't carry,change to 2key,1key. else return itself</span></span><br><span class="line">            <span class="keyword">var</span> weiH = (weiA / miIC(<span class="number">1</span>,lenW-lenk))      <span class="comment">//weiHead</span></span><br><span class="line">            <span class="keyword">if</span> (carry(weiH) != <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> weiA- miIC(carry(weiH),(lenW-lenk))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> weiA</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>单个wei的检查<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">weiThrough</span><span class="params">(wei: <span class="type">Int</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="comment">//circle carryChange until result==0,else return fase</span></span><br><span class="line">        <span class="keyword">var</span> cache = wei</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.9</span>) &#123;</span><br><span class="line">            cache = carryChange(cache)</span><br><span class="line">            <span class="keyword">if</span> (cache == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>所有wei的检查<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">weisThrough</span><span class="params">(weis:<span class="type">List</span>&lt;<span class="type">Int</span>&gt;)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (wei <span class="keyword">in</span> weis)</span><br><span class="line">            <span class="keyword">if</span> (!weiThrough(wei))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="胡合法总成"><a href="#胡合法总成" class="headerlink" title="胡合法总成"></a>胡合法总成</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LegalHu</span><span class="params">(card: <span class="type">Int</span>,cardArr: <span class="type">IntArray</span>)</span></span>:<span class="built_in">Boolean</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> arr=cardArr.clone()</span><br><span class="line">        <span class="keyword">val</span> il= IndexLive(arr)</span><br><span class="line">        <span class="keyword">val</span> index=il+<span class="number">1</span></span><br><span class="line">        <span class="keyword">val</span> len=index+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (il==<span class="number">0</span> &amp;&amp; card==arr[<span class="number">0</span>])  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        arr[index]=card</span><br><span class="line">        Sort(arr,index)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> jiangs= getJia(arr,len)</span><br><span class="line">        <span class="keyword">val</span> qujiangArrs= quJiangArrs(arr,jiangs,len)</span><br><span class="line">        <span class="keyword">val</span> ll=il   <span class="comment">//ll=len-2=il</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (qujiang <span class="keyword">in</span> qujiangArrs)&#123;</span><br><span class="line">            <span class="keyword">val</span> weis = getWeis(qujiang,ll)</span><br><span class="line">            <span class="keyword">val</span> hu= weisThrough(weis)</span><br><span class="line">            <span class="keyword">if</span> (hu) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>至此算法完成，除去carry映射方法总方法不到200行经测试，对于16张的台湾麻将而言，速度达到每秒30W次</p>]]></content>
      
      
      <categories>
          
          <category> 算法 Algorithm </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring 动态数据源热切换到不换</title>
      <link href="/2017/06/10/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/20170610-Spring%20%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%BA%90%E7%83%AD%E5%88%87%E6%8D%A2%E5%88%B0%E4%B8%8D%E6%8D%A2/"/>
      <url>/2017/06/10/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/20170610-Spring%20%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%BA%90%E7%83%AD%E5%88%87%E6%8D%A2%E5%88%B0%E4%B8%8D%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在某些业务场景重我们会遇到数据库的切换，<br>如果只是少数的几个数据源，我们可以在配置池里设置好，随意切换就可以。可是如果是动态的多数据源呢，Spring中已经内置了数据源的动态切换路由,在该类中可继承重写数据源的切换控制<br>但是正确的配置，仍然需要受几次挫折的。其中有不少问题</p><a id="more"></a><p>挖个坑，埋点土，数个12345，鸽，有空填一下~挖个坑，埋点土，数个12345，鸽，有空填一下~挖个坑，埋点土，数个12345，鸽，有空填一下~挖个坑，埋点土，数个12345，鸽，有空填一下~挖个坑，埋点土，数个12345，鸽，有空填一下~</p>]]></content>
      
      
      <categories>
          
          <category> 工具人 ToolMan </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Ⅰ 复活</title>
      <link href="/2017/02/15/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/HEXO/20170215-Hexo%20%E2%85%A0%20%E5%A4%8D%E6%B4%BB/"/>
      <url>/2017/02/15/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/HEXO/20170215-Hexo%20%E2%85%A0%20%E5%A4%8D%E6%B4%BB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Hexo 重启<br>拉取来自Git备份 <code>io</code> 工程<br>该备份 即将整个hexo项目命名io private保存<a id="more"></a></p><h3 id="拉取io工程"><a href="#拉取io工程" class="headerlink" title="拉取io工程"></a>拉取io工程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IDE中登录github，拉取对应工程</span><br></pre></td></tr></table></figure><h3 id="本地启动-进行预览"><a href="#本地启动-进行预览" class="headerlink" title="本地启动 进行预览"></a>本地启动 进行预览</h3><p>命令 <code>hexo server</code>,<code>hexo -s</code>,<code>hexo s</code>均可 </p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>前往预览<a href="http://localhost:4000/" target="_blank" rel="noopener">localhost</a>  </p><p>若失败有如下代码：<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR Local hexo not found in D:\IdeaGit\io</span><br><span class="line">ERROR Try running: 'npm install hexo --save'</span><br></pre></td></tr></table></figure></p><p>则按照提示执行 <code>npm install hexo --save</code> 即可<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> npm install hexo --save </span><br><span class="line">...</span><br><span class="line">+ hexo@3.9.0</span><br><span class="line">added 631 packages from 561 contributors and audited 19347 packages in 35.96s</span><br></pre></td></tr></table></figure></p><p>之后重复执行<code>hexo s</code>即可成功启动，前往预览<a href="http://localhost:4000/" target="_blank" rel="noopener">localhost</a></p><h3 id="清理-生成-发布"><a href="#清理-生成-发布" class="headerlink" title="清理-生成-发布"></a>清理-生成-发布</h3><p>clean<br>g (generate)<br>d (deploy)  </p><p>清理<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line">INFO  Deleted database.</span><br><span class="line">INFO  Deleted public folder.</span><br></pre></td></tr></table></figure></p><p>生成<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line"></span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  ... ... ...</span><br><span class="line">INFO  179 files generated in 4.93 s</span><br></pre></td></tr></table></figure></p><p>发布  (发布前<code>hexo s</code>先看下效果)<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br><span class="line"></span><br><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  ... ... ...</span><br><span class="line">INFO  Deploy done: git</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 工具人 ToolMan </category>
          
          <category> HEXO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo O 初始</title>
      <link href="/2017/02/12/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/HEXO/20170212-Hexo%20O%20%E5%88%9D%E5%A7%8B/"/>
      <url>/2017/02/12/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/HEXO/20170212-Hexo%20O%20%E5%88%9D%E5%A7%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Hexo 初始化<br>第一次完整搭建后<br>需要Git备份当前工程，当前工程名 <code>io</code><br>private保存（因含密钥等文件，也可public但需去除隐私文件）<a id="more"></a></p><h3 id="安装包"><a href="#安装包" class="headerlink" title="安装包"></a>安装包</h3><p>以下安装包执行安装<br><a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener">Node.js</a><br><a href="http://git-scm.com/" target="_blank" rel="noopener">Git</a><br><a href="https://www.jetbrains.com/idea/nextversion/#section=windows" target="_blank" rel="noopener">Idea Community</a><br>安装后重启电脑 node.js环境开始生效  </p><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>操作IDE为IDEA<br>Ide中 调出PowerShell（Alt+F12）<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows PowerShell</span><br><span class="line">版权所有 (C) Microsoft Corporation。保留所有权利。</span><br><span class="line">尝试新的跨平台 PowerShell https://aka.ms/pscore6</span><br><span class="line">PS D:\IdeaGit&gt;</span><br></pre></td></tr></table></figure></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install -g hexo-cli</span></span><br><span class="line">......</span><br><span class="line">+ hexo-cli@3.1.0</span><br><span class="line">added 81 packages from 322 contributors in 295.861s</span><br></pre></td></tr></table></figure><h3 id="创建博客项目"><a href="#创建博客项目" class="headerlink" title="创建博客项目"></a>创建博客项目</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hexo init &lt;folder&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> &lt;folder&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install</span></span><br></pre></td></tr></table></figure><p>完成后目录<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml         网站的配置信息，配置大部分的参数</span><br><span class="line">├── package.json        应用程序的信息。EJS, Stylus 和 Markdown renderer 已安装，可自由移除</span><br><span class="line">├── scaffolds           模版 文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件</span><br><span class="line">├── source       用户资源</span><br><span class="line">|   <span class="type">├── _drafts</span>         开头命名为 <span class="keyword">_</span>的文件夹会被隐藏 </span><br><span class="line">|   <span class="type">└── _posts</span>          md文件</span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure></p><p>package.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"hexo-site"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.0"</span>,</span><br><span class="line">  <span class="attr">"private"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"hexo"</span>: &#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">""</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"hexo"</span>: <span class="string">"^3.8.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-generator-archive"</span>: <span class="string">"^0.1.5"</span>,</span><br><span class="line">    <span class="attr">"hexo-generator-category"</span>: <span class="string">"^0.1.3"</span>,</span><br><span class="line">    <span class="attr">"hexo-generator-index"</span>: <span class="string">"^0.2.1"</span>,</span><br><span class="line">    <span class="attr">"hexo-generator-tag"</span>: <span class="string">"^0.2.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-renderer-ejs"</span>: <span class="string">"^0.3.1"</span>,</span><br><span class="line">    <span class="attr">"hexo-renderer-stylus"</span>: <span class="string">"^0.3.3"</span>,</span><br><span class="line">    <span class="attr">"hexo-renderer-marked"</span>: <span class="string">"^0.3.2"</span>,</span><br><span class="line">    <span class="attr">"hexo-server"</span>: <span class="string">"^0.3.3"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="本地启动-进行预览"><a href="#本地启动-进行预览" class="headerlink" title="本地启动 进行预览"></a>本地启动 进行预览</h3><p>命令 <code>hexo server</code>,<code>hexo -s</code>,<code>hexo s</code>均可 </p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>前往预览<a href="http://localhost:4000/" target="_blank" rel="noopener">localhost</a></p><h3 id="将当前项目上传到GitHub"><a href="#将当前项目上传到GitHub" class="headerlink" title="将当前项目上传到GitHub"></a>将当前项目上传到GitHub</h3><p>从<code>&lt;floder&gt;</code>位置 通过IDE打开工程<br>随后将工程分享到Github<br>VCS -&gt; Import into Version Control -&gt;  Share Project on Github<br>建议项目命命名为<code>io</code>  </p><h3 id="参考HEXO官网"><a href="#参考HEXO官网" class="headerlink" title="参考HEXO官网"></a><a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">参考HEXO官网</a></h3>]]></content>
      
      
      <categories>
          
          <category> 工具人 ToolMan </category>
          
          <category> HEXO </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 引用图片</title>
      <link href="/2017/02/10/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/HEXO/20170210-Hexo%20%E5%BC%95%E7%94%A8%E5%9B%BE%E7%89%87/"/>
      <url>/2017/02/10/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/HEXO/20170210-Hexo%20%E5%BC%95%E7%94%A8%E5%9B%BE%E7%89%87/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>修改_config.yml配置文件post_asset_folder项为true。  </p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> <span class="string">"file"</span></span><br></pre></td></tr></table></figure><p>此时创建文章后，会出现一个与文章文件同名的文件夹。将图片文件复制到文件夹中。(img.png)  </p><a id="more"></a><h3 id="直接引用"><a href="#直接引用" class="headerlink" title="直接引用"></a>直接引用</h3><p>前提为，你的hexo版本是hexo3以上<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;%  <span class="name">asset_img</span> img.png  img的图片信息  %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure></p><h3 id="hexo插件方法"><a href="#hexo插件方法" class="headerlink" title="hexo插件方法"></a>hexo插件方法</h3><p>安装<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install https:<span class="regexp">//gi</span>thub.com<span class="regexp">/CodeFalling/</span>hexo-asset-image --save</span><br></pre></td></tr></table></figure></p><p>等待一段时间后安装完成后，使用传统方法引用就好<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">logo</span>](<span class="link">file/img.png</span>)</span><br></pre></td></tr></table></figure></p><p>其中[]中内容为为图片标题信息</p>]]></content>
      
      
      <categories>
          
          <category> 工具人 ToolMan </category>
          
          <category> HEXO </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hexo-Next 设置|备忘</title>
      <link href="/2017/01/10/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/HEXO/20170110-Hexo%20%E7%BB%BC%E5%90%88%E5%A4%87%E5%BF%98/"/>
      <url>/2017/01/10/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/HEXO/20170110-Hexo%20%E7%BB%BC%E5%90%88%E5%A4%87%E5%BF%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>  嗨，Hello,本文为第一篇Hexo博客文章 🐳🐋🐟🐳🐋🐟🐳🐋🐳🐋🐟  代码基地<a href="https://github.com/colinst" target="_blank" rel="noopener">github/hongxii</a>!  个人网站域名(架设中)<a href="https://gitmmp.com" target="_blank" rel="noopener">gitmmp.com</a>!  欢迎来到我的博客 <a href="https://colinst.github.io" target="_blank" rel="noopener">Blog.gitmmp.com</a>!<br>Hexo + Next的组合可以无限优化，甚至某些组织站点都用hexo作为发布,个人博客不必花费太多的时间，如果做组织网站则建议使用灵活度更高的主题（<a href="https://blog.zhangruipeng.me/hexo-theme-icarus/" target="_blank" rel="noopener">icarus</a>）。仅用一文说明设计部署等关键点，个性化范围等关键点，花太多时间在上面也不好，本文轻改Next主题。以下为目录：<a id="more"></a></p><h2 id="文章目录："><a href="#文章目录：" class="headerlink" title="文章目录："></a>文章目录：</h2><!-- TOC --><ul><li><a href="#基建-base">基建 Base</a><ul><li><a href="#依赖环境-environment">依赖环境 environment</a></li><li><a href="#常用命令-command">常用命令 command</a></li></ul></li><li><a href="#主题轻改-theme-next">主题轻改 Theme-Next</a><ul><li><a href="#基本信息-baseinfo">基本信息 baseInfo</a><ul><li><a href="#站点设置-siteinfo">站点设置 siteInfo</a></li><li><a href="#侧边栏信息-authorinfo">侧边栏信息 authorInfo</a></li></ul></li><li><a href="#首页样式-viewindex">首页样式 viewIndex</a><ul><li><a href="#博文块样式-blockview">博文块样式 blockView</a></li><li><a href="#底层动画---cssflash">底层动画   cssFlash</a></li><li><a href="#右上github">右上Github</a></li><li><a href="#页尾信息-footer">页尾信息 footer</a></li></ul></li><li><a href="#其他样式-views">其他样式 views</a><ul><li><a href="#关于-about">关于 about</a></li><li><a href="#标签-tags">标签 tags</a></li><li><a href="#分类-categorise">分类 categorise</a></li><li><a href="#搜索-search">搜索 search</a></li><li><a href="#自定义-">自定义 …</a></li></ul></li><li><a href="#文章样式-mainview">文章样式 mainView</a><ul><li><a href="#标签优化">标签优化</a></li><li><a href="#评论引入">评论引入</a></li><li><a href="#谷歌-百度收录">谷歌-百度收录</a></li><li><a href="#访问量查看">访问量查看</a></li><li><a href="#底部版权信息">底部版权信息</a></li></ul></li></ul></li></ul><!-- /TOC --><h2 id="基建-Base"><a href="#基建-Base" class="headerlink" title="基建 Base"></a>基建 Base</h2><h3 id="依赖环境-environment"><a href="#依赖环境-environment" class="headerlink" title="依赖环境 environment"></a>依赖环境 environment</h3><pre><code>//在node.js官网去下载安装node.js       //Shell //hexo-client  hexo客户端安装         npm install hexo-cli -g//hexo-deployer-git   //git工具npm install hexo-deployer-git --save    //hexo-md-img-plagin  //图片编辑格式统一插件npm install https://github.com/CodeFalling/hexo-asset-image --save   //hexo-generator-search   //搜索插件npm install hexo-generator-search --save    //标签云插件npm install hexo-tag-cloud@^2.0.* --save//站点地图生成插件  百度和谷歌npm install hexo-generator-baidu-sitemap --save    npm install hexo-generator-sitemap --save           //谷歌//多媒体插件npm install hexo-tag-aplayer    //音频npm install hexo-tag-dplayer    //视频//貌似全局用的安装工具npm install -g npm-install-peers</code></pre><p>github-create the Rep[repName=uid.github.io]  </p><h3 id="常用命令-command"><a href="#常用命令-command" class="headerlink" title="常用命令 command"></a>常用命令 command</h3><p>####<a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">写作细节</a></p><pre><code>$ hexo init &lt;folder&gt;    //hexo io 建立hexo项目文件夹$ cd &lt;folder&gt;           //cd io$ npm install           //        部署项目文件</code></pre><p>####转移项目时<br>1.先git项目到本地，文件夹改名（如io-&gt;ioo）<br>2.新建io 文件夹，cd进去，npm install<br>3.此时将ioo中文件全部覆盖到io文件夹<br>之后可以在自己的ide中编辑了</p><h4 id="在-posts-文件夹中新建md文档编辑就好"><a href="#在-posts-文件夹中新建md文档编辑就好" class="headerlink" title="在_posts 文件夹中新建md文档编辑就好"></a>在_posts 文件夹中新建md文档编辑就好</h4><p>md文件头：  </p><pre><code>---title: 标题tags:     - 标签1      - 标签2  categories:     - 分类1       - 分类2  date: 2018-08-008 13:00:00---index页显示简介内容&lt;!-- more --&gt;   //简介-正文分割符</code></pre><p>文件头根据需要可加入别的属性  </p><h4 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h4><pre><code>$ hexo generate     //将md文件生成需要部署的html静态页面$ hexo server       //本地启动查看 [http://localhost:4000/](http://localhost:4000/)$ hexo deploy       //发布到git地址</code></pre><p>生成发布可直接简写：  </p><pre><code>$ hexo g -d$ hexo d -g</code></pre><p><a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">发布细节</a><br>可以多定义几个deloy，deloy命令后会依次来repo,同时一起更新到github,gitlee,码云等。前提要创建好repo，对应站点定义好SSH key。</p><h2 id="主题轻改-Theme-Next"><a href="#主题轻改-Theme-Next" class="headerlink" title="主题轻改 Theme-Next"></a>主题轻改 Theme-Next</h2><h3 id="基本信息-baseInfo"><a href="#基本信息-baseInfo" class="headerlink" title="基本信息 baseInfo"></a>基本信息 baseInfo</h3><h4 id="站点设置-siteInfo"><a href="#站点设置-siteInfo" class="headerlink" title="站点设置 siteInfo"></a>站点设置 siteInfo</h4><h4 id="侧边栏信息-authorInfo"><a href="#侧边栏信息-authorInfo" class="headerlink" title="侧边栏信息 authorInfo"></a>侧边栏信息 authorInfo</h4><h3 id="首页样式-viewIndex"><a href="#首页样式-viewIndex" class="headerlink" title="首页样式 viewIndex"></a>首页样式 viewIndex</h3><h4 id="博文块样式-blockView"><a href="#博文块样式-blockView" class="headerlink" title="博文块样式 blockView"></a>博文块样式 blockView</h4><p>使用Gemini主题下修改</p><h4 id="首页文章标题与文章简介的距离"><a href="#首页文章标题与文章简介的距离" class="headerlink" title="首页文章标题与文章简介的距离"></a>首页文章标题与文章简介的距离</h4><pre><code>默认值60更改css样式 margin{上右下左}/{上右下}/{上下-右左}src/setNext.md位置：themes/next/source/css/_common/components/post/post-meta.styl行号：02</code></pre><h4 id="首页文章标题-对齐"><a href="#首页文章标题-对齐" class="headerlink" title="首页文章标题-对齐"></a>首页文章标题-对齐</h4><pre><code>位置：themes/next/source/css/_common/components/post/post-title.styl行号：02默认：center改为：left</code></pre><h4 id="阅读全文按钮调整"><a href="#阅读全文按钮调整" class="headerlink" title="阅读全文按钮调整"></a>阅读全文按钮调整</h4><pre><code>位置：themes/next/source/css/_variables/base.styl行号：164-165默认： $btn-default-border-width       = 2px      $btn-default-border-color       = $black-deep对齐-边距：位置：themes/next/source/css/_common/components/post/post-button.styl添加：text-align: left;    //对齐      margin-top: 4px;      //与简介边距$Ans*2按钮边距：位置：themes/next/source/css/_common/components/buttons.styl修改：padding: 0 0px;默认：padding: 0 2px;</code></pre><h4 id="底层动画-cssFlash"><a href="#底层动画-cssFlash" class="headerlink" title="底层动画   cssFlash"></a>底层动画   cssFlash</h4><h4 id="右上Github"><a href="#右上Github" class="headerlink" title="右上Github"></a>右上Github</h4><h4 id="index页面加载条"><a href="#index页面加载条" class="headerlink" title="index页面加载条"></a>index页面加载条</h4><p>这个如果用的是比较新的NexT主题，只需要在配置文件里面进行修改就可以了。旧的话，就需要对/next/layout/_partials/head.swig文件做些修改，添加对应的代码。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdn.bootcss.com/pace/1.0.2/pace.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.pace</span> <span class="selector-class">.pace-progress</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#1E92FB</span>; <span class="comment">/*进度条颜色*/</span></span></span><br><span class="line"><span class="undefined">    height: 3px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.pace</span> <span class="selector-class">.pace-progress-inner</span> &#123;</span></span><br><span class="line"><span class="css">     <span class="selector-tag">box-shadow</span>: 0 0 10<span class="selector-tag">px</span> <span class="selector-id">#1E92FB</span>, 0 0 5<span class="selector-tag">px</span>     <span class="selector-id">#1E92FB</span>; <span class="comment">/*阴影颜色*/</span></span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.pace</span> <span class="selector-class">.pace-activity</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">border-top-color</span>: <span class="selector-id">#1E92FB</span>;    <span class="comment">/*上边框颜色*/</span></span></span><br><span class="line"><span class="css">    <span class="selector-tag">border-left-color</span>: <span class="selector-id">#1E92FB</span>;    <span class="comment">/*左边框颜色*/</span></span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h4 id="标签云"><a href="#标签云" class="headerlink" title="标签云"></a>标签云</h4><pre><code>找到文件 next/layout/_macro/sidebar.swig, 然后添加如下内容。{% if site.tags.length > 1 %}    <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>    <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>    <div class="widget-wrap">        <h3 class="widget-title">Tag Cloud</h3>        <div id="myCanvasContainer" class="widget tagcloud">            <canvas width="250" height="250" id="resCanvas" style="width=100%">                {{ list_tags() }}            </canvas>        </div>    </div>    {% endif %}</code></pre><h4 id="页尾信息-footer"><a href="#页尾信息-footer" class="headerlink" title="页尾信息 footer"></a>页尾信息 footer</h4><p>   位置：\themes\next\layout_partials\footer.swig   搜索标签：   <div class="author">   <div class="powered-by">   <div class="theme-info">   更改以上3标签内部链接内容</div></div></div></p><p>   同时可对以上标签弱修改，可修改语言配置文件   位置：\themes\next\languages\ </p><h3 id="其他样式-views"><a href="#其他样式-views" class="headerlink" title="其他样式 views"></a>其他样式 views</h3><h4 id="关于-about"><a href="#关于-about" class="headerlink" title="关于 about"></a>关于 about</h4><h4 id="标签-tags"><a href="#标签-tags" class="headerlink" title="标签 tags"></a>标签 tags</h4><h4 id="分类-categorise"><a href="#分类-categorise" class="headerlink" title="分类 categorise"></a>分类 categorise</h4><h4 id="搜索-search"><a href="#搜索-search" class="headerlink" title="搜索 search"></a>搜索 search</h4><p>添加本地搜索<br>安装 hexo-generator-search，在nanshanyi.github.io目录下执行以下命令：</p><pre><code>$ npm install hexo-generator-search --save</code></pre><p>在   next/_config.yml添加  </p><pre><code>search:   path: search.xml  field: post  format: html  limit: 10000</code></pre><p>同时在该文件中开启search功能 local_search改为true</p><pre><code>local_search:  enable: true</code></pre><h4 id="自定义-…"><a href="#自定义-…" class="headerlink" title="自定义 …"></a>自定义 …</h4><h3 id="文章样式-mainView"><a href="#文章样式-mainView" class="headerlink" title="文章样式 mainView"></a>文章样式 mainView</h3><h4 id="标签优化"><a href="#标签优化" class="headerlink" title="标签优化"></a>标签优化</h4><h4 id="谷歌-百度收录"><a href="#谷歌-百度收录" class="headerlink" title="谷歌-百度收录"></a>谷歌-百度收录</h4><h4 id="访问量查看"><a href="#访问量查看" class="headerlink" title="访问量查看"></a>访问量查看</h4><p>   打开\themes\next\layout_partials\footer.swig文件,   在《div class=”copyright”》 前加入以下这句：</p>   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>   之后再合适的位置添加显示统计代码：   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"powered-by"</span>&gt;</span><br><span class="line">&lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"fa fa-user-md"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_container_site_uv"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  本站访客数:<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_value_site_uv"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure></p><p>   该脚本有两种不同的计算统计代码   pv统计：单用户连续点击n篇文章，记录n次访问量   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_container_site_pv"</span>&gt;</span></span><br><span class="line">    本站总访问量<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_value_site_pv"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>次</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>   uv统计：单用户连续点击n篇文章，记录1次访问量   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_container_site_uv"</span>&gt;</span></span><br><span class="line">  本站总访问量<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_value_site_uv"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>次</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h4 id="底部版权信息"><a href="#底部版权信息" class="headerlink" title="底部版权信息"></a>底部版权信息</h4><p>在目录 next/layout/_macro/下添加 my-copyright.swig：<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> page.copyright %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my_post_copyright"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  <span class="comment">&lt;!-- JS库 sweetalert 可修改路径 --&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/sweetalert/dist/sweetalert.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>本文标题:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123; url_for(page.path) &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span><span class="template-variable">&#123;&#123; page.title &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>文章作者:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span> <span class="attr">title</span>=<span class="string">"访问 </span></span></span><span class="template-variable">&#123;&#123; theme.author &#125;&#125;</span><span class="xml"><span class="tag"><span class="string"> 的个人博客"</span>&gt;</span></span><span class="template-variable">&#123;&#123; theme.author &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>发布时间:<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><span class="template-variable">&#123;&#123; page.date.format("YYYY年MM月DD日 - HH:MM") &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>最后更新:<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><span class="template-variable">&#123;&#123; page.updated.format("YYYY年MM月DD日 - HH:MM") &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>原始链接:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123; url_for(page.path) &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">title</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123; page.title &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span><span class="template-variable">&#123;&#123; page.permalink &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"copy-path"</span>  <span class="attr">title</span>=<span class="string">"点击复制文章链接"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-clipboard"</span> <span class="attr">data-clipboard-text</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123; page.permalink &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>  <span class="attr">aria-label</span>=<span class="string">"复制成功！"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>许可协议:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-creative-commons"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">rel</span>=<span class="string">"license"</span> <span class="attr">href</span>=<span class="string">"https://creativecommons.org/licenses/by-nc-nd/4.0/"</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">title</span>=<span class="string">"Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)"</span>&gt;</span>署名-非商业性使用-禁止演绎 4.0 国际<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 转载请保留原文链接及作者。<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"> </span></span></span><br><span class="line"><span class="xml">    var clipboard = new Clipboard('.fa-clipboard');</span></span><br><span class="line"><span class="xml">      $(".fa-clipboard").click(function()&#123;</span></span><br><span class="line"><span class="xml">      clipboard.on('success', function()&#123;</span></span><br><span class="line"><span class="xml">        swal(&#123;   </span></span><br><span class="line"><span class="xml">          title: "",   </span></span><br><span class="line"><span class="xml">          text: '复制成功',</span></span><br><span class="line"><span class="xml">          icon: "success", </span></span><br><span class="line"><span class="xml">          showConfirmButton: true</span></span><br><span class="line"><span class="xml">          &#125;);</span></span><br><span class="line"><span class="xml">        &#125;);</span></span><br><span class="line"><span class="xml">    &#125;);  </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure></p><p>在目录next/source/css/_common/components/post/下添加my-post-copyright.styl：<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.my_post_copyright</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">85%</span>;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">45em</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">2.8em</span> auto <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0.5em</span> <span class="number">1.0em</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#d3d3d3</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.93rem</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.6em</span>;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;</span><br><span class="line">  <span class="attribute">background</span>: rgba(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.4</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.my_post_copyright</span> p&#123;<span class="attribute">margin</span>:<span class="number">0</span>;&#125;</span><br><span class="line"><span class="selector-class">.my_post_copyright</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">5.2em</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#b5b5b5</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.my_post_copyright</span> <span class="selector-class">.raw</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">5em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.my_post_copyright</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#808080</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.my_post_copyright</span> <span class="selector-tag">a</span>:hover &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a3d2a3</span>;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.my_post_copyright</span>:hover <span class="selector-class">.fa-clipboard</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.my_post_copyright</span> <span class="selector-class">.post-url</span>:hover &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.my_post_copyright</span> <span class="selector-class">.copy-path</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1em</span>;</span><br><span class="line">  +mobile()&#123;<span class="attribute">display</span>:none;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.my_post_copyright</span> <span class="selector-class">.copy-path</span>:hover &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#808080</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>修改next/layout/_macro/post.swig，在代码<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> not is_index %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">include</span></span> 'wechat-subscriber.swig' %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p><p>之前添加增加如下代码：<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> not is_index %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">include</span></span> 'my-copyright.swig' %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p><p>修改next/source/css/_common/components/post/post.styl文件，在最后一行增加代码：<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">"my-post-copyright"</span></span><br></pre></td></tr></table></figure></p><p>保存重新生成即可。 如果要在该博文下面增加版权信息的显示，需要在 Markdown 中增加copyright: true的设置，类似：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">前端小项目：使用canvas绘画哆啦A梦</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2017</span><span class="bullet">-05</span><span class="bullet">-22</span> <span class="number">22</span><span class="string">:53:53</span></span><br><span class="line"><span class="attr">tags:</span> <span class="string">canvas</span></span><br><span class="line"><span class="attr">categories:</span> <span class="string">前端</span></span><br><span class="line"><span class="attr">copyright:</span> <span class="literal">true</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure></p><h3 id="三方"><a href="#三方" class="headerlink" title="三方"></a>三方</h3><h4 id="评论-来必力"><a href="#评论-来必力" class="headerlink" title="评论-来必力"></a>评论-来必力</h4><p>1.登陆<a href="https://livere.com/" target="_blank" rel="noopener">官网</a> 进行<a href="https://was.livere.me/register?lang=zh-cn" target="_blank" rel="noopener">注册</a>等事宜<br>2.Next中进行设置  </p><p>Next中设置1.首先在 _config.yml 文件中添加如下配置：  </p><pre><code># Support for LiveRe comments system.# You can get your uid from https://livere.com/insight/myCode (General web site)livere_uid: your uid</code></pre><h4 id="评论-valine"><a href="#评论-valine" class="headerlink" title="评论-valine"></a>评论-valine</h4><p>我们的评论系统其实是放在Leancloud上的，因此首先需要去注册一个账号<br><a href="https://leancloud.cn/dashboard/data.html?appid=dU4DFkRRQqU30bvT0uXQmhSw-gzGzoHsz#/" target="_blank" rel="noopener">Leancloud官网</a>注册完以后需要创建一个应用，名字可以随便起，然后 进入应用-&gt;设置-&gt;应用key<br>获取你的appid 和 appkey  </p><p>Next中已经内置，在_config中设置开启</p><pre><code>valine:  enable: true  appid:  your app id  appkey: your app key  notify: false # mail notifier , https://github.com/xCss/Valine/wiki  verify: false # Verification code  placeholder: ヾﾉ≧∀≦)o来啊，快活啊!   guest_info: nick,mail,link  pageSize: 10</code></pre><h4 id="SEO优化"><a href="#SEO优化" class="headerlink" title="SEO优化"></a>SEO优化</h4><p>#####站点地图站点地图即sitemap， 是一个页面，上面放置了网站上需要搜索引擎抓取的所有页面的链接。站点地图可以告诉搜索引擎网站上有哪些可供抓取的网页，以便搜索引擎可以更加智能地抓取网站。<br>生成站点地图安装百度和Google的站点地图生成插件：</p><pre><code>npm install hexo-generator-sitemap --save       //googlenpm install hexo-generator-baidu-sitemap --save       </code></pre><p>#####修改配置文件修改站点配置文件_config.yml，添加以下内容：</p><pre><code># 自动生成sitemapsitemap:  path: sitemap.xmlbaidusitemap:  path: baidusitemap.xml    </code></pre><p>在hexo g后，public目录下会有sitemap.xml和baidusitemap.xml两个文件，这就是生成的站点地图。<br>前往百度提交入口和谷歌提交入口，进行文件验证:<br>下载他他们的验证文件html,在_config文件中找到skip_render属性，存入  </p><pre><code>//避免被hexo渲染skip_render: [googleb2b4a4dcdb4a9ac4.html, baidu_verify_R6YFRwbiQw.html]</code></pre><p>重新渲染文件： hexo clean hexo d -g再进行站长验证.<br>验证成功后前往各自站点提交sitemap</p><h4 id="多媒体"><a href="#多媒体" class="headerlink" title="多媒体"></a>多媒体</h4><p>插件npm install hexo-tag-aplayer    //音频npm install hexo-tag-dplayer    //视频</p><h5 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h5><p>md中插入  </p><pre><code>{   % dplayer     &quot;url=http://home.ustc.edu.cn/~mmmwhy/GEM.mp4&quot;       &quot;pic=http://home.ustc.edu.cn/~mmmwhy/GEM.jpg&quot;      &quot;loop=yes&quot;      &quot;theme=#FADFA3&quot;      &quot;autoplay=false&quot;      &quot;token=tokendemo&quot; %}</code></pre><p>key的属性有：</p><pre><code>dplayer options:    &apos;autoplay&apos;, &apos;loop&apos;, &apos;screenshot&apos;,&apos;hotkey&apos;, &apos;mutex&apos;, &apos;dmunlimited&apos; : bool options, use &quot;yes&quot; &quot;y&quot; &quot;true&quot; &quot;1&quot; &quot;on&quot; or just without value to enable    &apos;preload&apos;, &apos;theme&apos;, &apos;lang&apos;, &apos;logo&apos;, &apos;url&apos;, &apos;pic&apos;, &apos;thumbnails&apos;, &apos;vidtype&apos;, &apos;suburl&apos;, &apos;subtype&apos;, &apos;subbottom&apos;, &apos;subcolor&apos;, &apos;subcolor&apos;, &apos;id&apos;, &apos;api&apos;, &apos;token&apos;, &apos;addition&apos;, &apos;dmuser&apos; : string arguments    &apos;volume&apos;, &apos;maximum&apos; : number argumentscontainer options:    &apos;width&apos;, &apos;height&apos; : string, used in container element styleother:    &apos;code&apos; : value of this key will be append to script tag</code></pre><h5 id="音频"><a href="#音频" class="headerlink" title="音频"></a>音频</h5>]]></content>
      
      
      <categories>
          
          <category> 工具人 ToolMan </category>
          
          <category> HEXO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jvm&amp;Tomcat 安装</title>
      <link href="/2016/07/12/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/Jvm%E5%88%9D%E5%A7%8B%E5%8C%96%20Init/20160712-Jvm&amp;Tomcat%20%E5%AE%89%E8%A3%85/"/>
      <url>/2016/07/12/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/Jvm%E5%88%9D%E5%A7%8B%E5%8C%96%20Init/20160712-Jvm&amp;Tomcat%20%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文主要说明Linux中配置jdk和tomcat过程,将自己在配置过程中遇到的一些问题及相关的解决方案列举出来<a id="more"></a></p><h2 id="Jvm"><a href="#Jvm" class="headerlink" title="Jvm"></a>Jvm</h2><h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><h4 id="Go-to-Download-JDK"><a href="#Go-to-Download-JDK" class="headerlink" title="Go to Download JDK"></a>Go to Download JDK</h4><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">Java SE Download Page On Oracle</a><br><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">Java se 8</a>  </p><p><a href="http://download.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz" target="_blank" rel="noopener">Jdk 8u172 For Linux.trr.gz</a></p><p><strong>WARNING</strong><br>Cannot Use Next Code Get tar.gz Package<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@colinECS download]</span># <span class="selector-tag">wget</span> <span class="selector-tag">http</span>:<span class="comment">//download.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">--2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:08--</span>  <span class="selector-tag">http</span>:<span class="comment">//download.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz</span></span><br><span class="line"><span class="selector-tag">Resolving</span> <span class="selector-tag">download</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (download.oracle.com)... <span class="selector-tag">23</span><span class="selector-class">.211</span><span class="selector-class">.96</span><span class="selector-class">.75</span></span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">download</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (download.oracle.com)|<span class="selector-tag">23</span><span class="selector-class">.211</span><span class="selector-class">.96</span><span class="selector-class">.75</span>|<span class="selector-pseudo">:80...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">302</span> <span class="selector-tag">Moved</span> <span class="selector-tag">Temporarily</span></span><br><span class="line"><span class="selector-tag">Location</span>: <span class="selector-tag">https</span>:<span class="comment">//edelivery.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz [following]</span></span><br><span class="line"><span class="selector-tag">--2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:08--</span>  <span class="selector-tag">https</span>:<span class="comment">//edelivery.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz</span></span><br><span class="line"><span class="selector-tag">Resolving</span> <span class="selector-tag">edelivery</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (edelivery.oracle.com)... <span class="selector-tag">184</span><span class="selector-class">.26</span><span class="selector-class">.250</span><span class="selector-class">.202</span>, <span class="selector-tag">2600</span><span class="selector-pseudo">:1417</span><span class="selector-pseudo">:76</span><span class="selector-pseudo">:19a</span><span class="selector-pseudo">::2d3e</span>, <span class="selector-tag">2600</span><span class="selector-pseudo">:1417</span><span class="selector-pseudo">:76</span><span class="selector-pseudo">:181</span><span class="selector-pseudo">::2d3e</span></span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">edelivery</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (edelivery.oracle.com)|<span class="selector-tag">184</span><span class="selector-class">.26</span><span class="selector-class">.250</span><span class="selector-class">.202</span>|<span class="selector-pseudo">:443...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">302</span> <span class="selector-tag">Moved</span> <span class="selector-tag">Temporarily</span></span><br><span class="line"><span class="selector-tag">Location</span>: <span class="selector-tag">http</span>:<span class="comment">//download.oracle.com/errors/download-fail-1505220.html [following]</span></span><br><span class="line"><span class="selector-tag">--2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:09--</span>  <span class="selector-tag">http</span>:<span class="comment">//download.oracle.com/errors/download-fail-1505220.html</span></span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">download</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (download.oracle.com)|<span class="selector-tag">23</span><span class="selector-class">.211</span><span class="selector-class">.96</span><span class="selector-class">.75</span>|<span class="selector-pseudo">:80...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">200</span> <span class="selector-tag">OK</span></span><br><span class="line"><span class="selector-tag">Length</span>: <span class="selector-tag">5307</span> (<span class="number">5.2</span>K) <span class="selector-attr">[text/html]</span></span><br><span class="line"><span class="selector-tag">Saving</span> <span class="selector-tag">to</span>: ‘<span class="selector-tag">jdk-8u172-linux-x64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>’</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">100%</span><span class="selector-attr">[======================================&gt;]</span> <span class="selector-tag">5</span>,<span class="selector-tag">307</span>       <span class="selector-tag">--</span><span class="selector-class">.-K</span>/<span class="selector-tag">s</span>   <span class="selector-tag">in</span> <span class="selector-tag">0s</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:09</span> (<span class="number">492</span> MB/s) <span class="selector-tag">-</span> ‘<span class="selector-tag">jdk-8u172-linux-x64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>’ <span class="selector-tag">saved</span> <span class="selector-attr">[5307/5307]</span></span><br></pre></td></tr></table></figure></p><p><strong>WHY</strong><br>If we user command ‘tar -xzvf’ we will get<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@colinECS download]<span class="comment"># tar -xzvf jdk-8u172-linux-x64.tar.gz</span></span><br><span class="line"></span><br><span class="line">gzip: stdin: <span class="keyword">not</span> <span class="keyword">in</span> gzip format</span><br><span class="line">tar: Child returned status <span class="number">1</span></span><br><span class="line">tar: Error <span class="keyword">is</span> <span class="keyword">not</span> recoverable: exiting now</span><br></pre></td></tr></table></figure></p><p>Here we can see some error out<br>Also we can feel there has something wrong in somewhere<br>Where?<br>Yes here:<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">100%</span><span class="selector-attr">[======================================&gt;]</span> <span class="selector-tag">5</span>,<span class="selector-tag">307</span>       <span class="selector-tag">--</span><span class="selector-class">.-K</span>/<span class="selector-tag">s</span>   <span class="selector-tag">in</span> <span class="selector-tag">0s</span></span><br><span class="line"><span class="selector-tag">2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:09</span> (<span class="number">492</span> MB/s) <span class="selector-tag">-</span> ‘<span class="selector-tag">jdk-8u172-linux-x64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>’ <span class="selector-tag">saved</span> <span class="selector-attr">[5307/5307]</span></span><br></pre></td></tr></table></figure></p><p>The package just 5307Kb<br>The correct package cannot be so small<br>If we go the <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">Java Home Page</a><br>We can see if you want download you must Accept a option:<br><img src="https://cdn.jsdelivr.net/gh/hongxii/ObjectServer0@1.0.0/src/20160712-Jvm&amp;Tomcat 安装/1.jdk-license.png" alt="avatar"><br>If we just use command ‘wget’,we will download the package without accept the license,So we cannot unpack the package</p><h5 id="Correct-way"><a href="#Correct-way" class="headerlink" title="Correct way"></a>Correct way</h5><p>We need use browser to accept the license and download the package<br>then use Ftp/Sftp tools move the package to your linux server<br>Or you can use command rpm to get package  </p><h4 id="Expand-the-package"><a href="#Expand-the-package" class="headerlink" title="Expand the package"></a>Expand the package</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> software]<span class="meta"># mkdir -p /usr/lib/jvm</span></span><br><span class="line">[root<span class="symbol">@localhost</span> software]<span class="meta"># tar -zxvf jdk-8u131-linux-x64.tar.gz -C /usr/lib/jvm</span></span><br></pre></td></tr></table></figure><h4 id="Set-Envionment-variables"><a href="#Set-Envionment-variables" class="headerlink" title="Set Envionment variables"></a>Set Envionment variables</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> software]<span class="meta"># vim /etc/profile</span></span><br></pre></td></tr></table></figure><p>Insert in head this:<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/lib/jvm/jdk1.8.0_131  </span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JRE_HOME</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre  </span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:$&#123;JAVA_HOME&#125;/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib  </span><br><span class="line"><span class="builtin-name">export</span>  <span class="attribute">PATH</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:$PATH</span><br></pre></td></tr></table></figure></p><h4 id="Make-function-useful"><a href="#Make-function-useful" class="headerlink" title="Make function useful"></a>Make function useful</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> software]<span class="meta"># source /etc/profile</span></span><br></pre></td></tr></table></figure><h4 id="Check-Version"><a href="#Check-Version" class="headerlink" title="Check Version"></a>Check Version</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# java -version</span><br><span class="line"></span><br><span class="line">java version <span class="string">"1.8.0_172"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_172-b11)</span><br><span class="line">Java HotSpot(TM) 64-Bit<span class="built_in"> Server </span>VM (build 25.172-b11, mixed mode)</span><br></pre></td></tr></table></figure><p><strong>Suucess</strong><br><br><br><br><br>   </p><h3 id="Remove"><a href="#Remove" class="headerlink" title="Remove"></a>Remove</h3><h4 id="check-version"><a href="#check-version" class="headerlink" title="check version"></a>check version</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# java -version</span><br><span class="line"></span><br><span class="line">openjdk version <span class="string">"1.8.0_102"</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_102-b14)</span><br><span class="line">OpenJDK 64-Bit<span class="built_in"> Server </span>VM (build 25.102-b14, mixed mode)</span><br></pre></td></tr></table></figure><h4 id="2-检测jdk安装包"><a href="#2-检测jdk安装包" class="headerlink" title="2. 检测jdk安装包"></a>2. 检测jdk安装包</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# rpm -qa | grep java</span><br><span class="line"></span><br><span class="line">java<span class="number">-1.7</span><span class="number">.0</span>-openjdk<span class="number">-1.7</span><span class="number">.0</span><span class="number">.111</span><span class="number">-2.6</span><span class="number">.7</span><span class="number">.8</span>.el7.x86_64</span><br><span class="line">python-javapackages<span class="number">-3.4</span><span class="number">.1</span><span class="number">-11.</span>el7.noarch</span><br><span class="line">tzdata-java<span class="number">-2016</span>g<span class="number">-2.</span>el7.noarch</span><br><span class="line">javapackages-tools<span class="number">-3.4</span><span class="number">.1</span><span class="number">-11.</span>el7.noarch</span><br><span class="line">java<span class="number">-1.8</span><span class="number">.0</span>-openjdk<span class="number">-1.8</span><span class="number">.0</span><span class="number">.102</span><span class="number">-4.</span>b14.el7.x86_64</span><br><span class="line">java<span class="number">-1.8</span><span class="number">.0</span>-openjdk-headless<span class="number">-1.8</span><span class="number">.0</span><span class="number">.102</span><span class="number">-4.</span>b14.el7.x86_64</span><br><span class="line">java<span class="number">-1.7</span><span class="number">.0</span>-openjdk-headless<span class="number">-1.7</span><span class="number">.0</span><span class="number">.111</span><span class="number">-2.6</span><span class="number">.7</span><span class="number">.8</span>.el7.x86_64\</span><br></pre></td></tr></table></figure><h4 id="3-卸载openjdk"><a href="#3-卸载openjdk" class="headerlink" title="3. 卸载openjdk"></a>3. 卸载openjdk</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@localhost software]</span># <span class="selector-tag">rpm</span> <span class="selector-tag">-e</span> <span class="selector-tag">--nodeps</span> <span class="selector-tag">tzdata-java-2016g-2</span><span class="selector-class">.el7</span><span class="selector-class">.noarch</span></span><br><span class="line"><span class="selector-attr">[root@localhost software]</span># <span class="selector-tag">rpm</span> <span class="selector-tag">-e</span> <span class="selector-tag">--nodeps</span> <span class="selector-tag">java-1</span><span class="selector-class">.7</span><span class="selector-class">.0-openjdk-1</span><span class="selector-class">.7</span><span class="selector-class">.0</span><span class="selector-class">.111-2</span><span class="selector-class">.6</span><span class="selector-class">.7</span><span class="selector-class">.8</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br><span class="line"><span class="selector-attr">[root@localhost software]</span># <span class="selector-tag">rpm</span> <span class="selector-tag">-e</span> <span class="selector-tag">--nodeps</span> <span class="selector-tag">java-1</span><span class="selector-class">.7</span><span class="selector-class">.0-openjdk-headless-1</span><span class="selector-class">.7</span><span class="selector-class">.0</span><span class="selector-class">.111-2</span><span class="selector-class">.6</span><span class="selector-class">.7</span><span class="selector-class">.8</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br><span class="line"><span class="selector-attr">[root@localhost software]</span># <span class="selector-tag">rpm</span> <span class="selector-tag">-e</span> <span class="selector-tag">--nodeps</span> <span class="selector-tag">java-1</span><span class="selector-class">.8</span><span class="selector-class">.0-openjdk-1</span><span class="selector-class">.8</span><span class="selector-class">.0</span><span class="selector-class">.102-4</span><span class="selector-class">.b14</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br><span class="line"><span class="selector-attr">[root@localhost software]</span># <span class="selector-tag">rpm</span> <span class="selector-tag">-e</span> <span class="selector-tag">--nodeps</span> <span class="selector-tag">java-1</span><span class="selector-class">.8</span><span class="selector-class">.0-openjdk-headless-1</span><span class="selector-class">.8</span><span class="selector-class">.0</span><span class="selector-class">.102-4</span><span class="selector-class">.b14</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br></pre></td></tr></table></figure><p>或者使用<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> jvm]<span class="meta"># yum remove *openjdk*</span></span><br></pre></td></tr></table></figure></p><p>之后再次输入rpm -qa | grep java 查看卸载情况：<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# rpm -qa | grep java</span><br><span class="line"></span><br><span class="line">python-javapackages<span class="number">-3.4</span><span class="number">.1</span><span class="number">-11.</span>el7.noarch</span><br><span class="line">javapackages-tools<span class="number">-3.4</span><span class="number">.1</span><span class="number">-11.</span>el7.noarch</span><br></pre></td></tr></table></figure></p><p><br><br><br></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="Go-to-下载-JDK"><a href="#Go-to-下载-JDK" class="headerlink" title="Go to 下载 JDK"></a>Go to 下载 JDK</h4><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">Oracle Java官网</a><br><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">Java se 8</a>  </p><p><a href="http://download.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz" target="_blank" rel="noopener">Jdk 8u172 For Linux.trr.gz</a></p><p><strong>注意</strong><br>不可以用’wget’命令下载JDK<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@colinECS download]</span># <span class="selector-tag">wget</span> <span class="selector-tag">http</span>:<span class="comment">//download.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">--2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:08--</span>  <span class="selector-tag">http</span>:<span class="comment">//download.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz</span></span><br><span class="line"><span class="selector-tag">Resolving</span> <span class="selector-tag">download</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (download.oracle.com)... <span class="selector-tag">23</span><span class="selector-class">.211</span><span class="selector-class">.96</span><span class="selector-class">.75</span></span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">download</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (download.oracle.com)|<span class="selector-tag">23</span><span class="selector-class">.211</span><span class="selector-class">.96</span><span class="selector-class">.75</span>|<span class="selector-pseudo">:80...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">302</span> <span class="selector-tag">Moved</span> <span class="selector-tag">Temporarily</span></span><br><span class="line"><span class="selector-tag">Location</span>: <span class="selector-tag">https</span>:<span class="comment">//edelivery.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz [following]</span></span><br><span class="line"><span class="selector-tag">--2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:08--</span>  <span class="selector-tag">https</span>:<span class="comment">//edelivery.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz</span></span><br><span class="line"><span class="selector-tag">Resolving</span> <span class="selector-tag">edelivery</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (edelivery.oracle.com)... <span class="selector-tag">184</span><span class="selector-class">.26</span><span class="selector-class">.250</span><span class="selector-class">.202</span>, <span class="selector-tag">2600</span><span class="selector-pseudo">:1417</span><span class="selector-pseudo">:76</span><span class="selector-pseudo">:19a</span><span class="selector-pseudo">::2d3e</span>, <span class="selector-tag">2600</span><span class="selector-pseudo">:1417</span><span class="selector-pseudo">:76</span><span class="selector-pseudo">:181</span><span class="selector-pseudo">::2d3e</span></span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">edelivery</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (edelivery.oracle.com)|<span class="selector-tag">184</span><span class="selector-class">.26</span><span class="selector-class">.250</span><span class="selector-class">.202</span>|<span class="selector-pseudo">:443...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">302</span> <span class="selector-tag">Moved</span> <span class="selector-tag">Temporarily</span></span><br><span class="line"><span class="selector-tag">Location</span>: <span class="selector-tag">http</span>:<span class="comment">//download.oracle.com/errors/download-fail-1505220.html [following]</span></span><br><span class="line"><span class="selector-tag">--2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:09--</span>  <span class="selector-tag">http</span>:<span class="comment">//download.oracle.com/errors/download-fail-1505220.html</span></span><br><span class="line"><span class="selector-tag">Connecting</span> <span class="selector-tag">to</span> <span class="selector-tag">download</span><span class="selector-class">.oracle</span><span class="selector-class">.com</span> (download.oracle.com)|<span class="selector-tag">23</span><span class="selector-class">.211</span><span class="selector-class">.96</span><span class="selector-class">.75</span>|<span class="selector-pseudo">:80...</span> <span class="selector-tag">connected</span>.</span><br><span class="line"><span class="selector-tag">HTTP</span> <span class="selector-tag">request</span> <span class="selector-tag">sent</span>, <span class="selector-tag">awaiting</span> <span class="selector-tag">response</span>... <span class="selector-tag">200</span> <span class="selector-tag">OK</span></span><br><span class="line"><span class="selector-tag">Length</span>: <span class="selector-tag">5307</span> (<span class="number">5.2</span>K) <span class="selector-attr">[text/html]</span></span><br><span class="line"><span class="selector-tag">Saving</span> <span class="selector-tag">to</span>: ‘<span class="selector-tag">jdk-8u172-linux-x64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>’</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">100%</span><span class="selector-attr">[======================================&gt;]</span> <span class="selector-tag">5</span>,<span class="selector-tag">307</span>       <span class="selector-tag">--</span><span class="selector-class">.-K</span>/<span class="selector-tag">s</span>   <span class="selector-tag">in</span> <span class="selector-tag">0s</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:09</span> (<span class="number">492</span> MB/s) <span class="selector-tag">-</span> ‘<span class="selector-tag">jdk-8u172-linux-x64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>’ <span class="selector-tag">saved</span> <span class="selector-attr">[5307/5307]</span></span><br></pre></td></tr></table></figure></p><p><strong>啊♂？？？</strong><br>我们解压用’wget’命令获得的jdk包会发现：<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@colinECS download]<span class="comment"># tar -xzvf jdk-8u172-linux-x64.tar.gz</span></span><br><span class="line"></span><br><span class="line">gzip: stdin: <span class="keyword">not</span> <span class="keyword">in</span> gzip format</span><br><span class="line">tar: Child returned status <span class="number">1</span></span><br><span class="line">tar: Error <span class="keyword">is</span> <span class="keyword">not</span> recoverable: exiting now</span><br></pre></td></tr></table></figure></p><p>解压报错了！！！<br><strong>为啥子咧？</strong><br>总感觉那里不对怪怪的<br>那里嘞？<br>对对对，就是这里:<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">100%</span><span class="selector-attr">[======================================&gt;]</span> <span class="selector-tag">5</span>,<span class="selector-tag">307</span>       <span class="selector-tag">--</span><span class="selector-class">.-K</span>/<span class="selector-tag">s</span>   <span class="selector-tag">in</span> <span class="selector-tag">0s</span></span><br><span class="line"><span class="selector-tag">2018-06-04</span> <span class="selector-tag">09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:09</span> (<span class="number">492</span> MB/s) <span class="selector-tag">-</span> ‘<span class="selector-tag">jdk-8u172-linux-x64</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>’ <span class="selector-tag">saved</span> <span class="selector-attr">[5307/5307]</span></span><br></pre></td></tr></table></figure></p><p>这咋就5307Kb这么点大啊<br>不应该这么小啊<br>咋们去官网看下 <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">Java Home Page</a><br>求豆麻袋，求豆麻袋，这怎么还有选项啊<br><img src="https://cdn.jsdelivr.net/gh/hongxii/ObjectServer0@1.0.0/src/20160712-Jvm&amp;Tomcat 安装/1.jdk-license.png" alt="avatar"><br><img class="[]">我们用’wget’的时候是没有同意这个选项的,<br>所以下载下来有问题的包是不能解压的<br>怪不得  </p><h5 id="那可咋整"><a href="#那可咋整" class="headerlink" title="那可咋整"></a>那可咋整</h5><p>还能咋整，只能用浏览器下载了呗<br>然后用 Ftp/Sftp 工具把下载好的传到linux服务器去<br>不过好像用 rpm 命令安装可以避免这种情况  </p><h4 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> software]<span class="meta"># mkdir -p /usr/lib/jvm</span></span><br><span class="line">[root<span class="symbol">@localhost</span> software]<span class="meta"># tar -zxvf jdk-8u131-linux-x64.tar.gz -C /usr/lib/jvm</span></span><br></pre></td></tr></table></figure><h4 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> software]<span class="meta"># vim /etc/profile</span></span><br></pre></td></tr></table></figure><p>在文件前面加入这些内容:  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/lib/jvm/jdk1.8.0_131  </span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JRE_HOME</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre  </span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:$&#123;JAVA_HOME&#125;/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib  </span><br><span class="line"><span class="builtin-name">export</span>  <span class="attribute">PATH</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:$PATH</span><br></pre></td></tr></table></figure><h4 id="使得profile文件有效，这样就不用重启了"><a href="#使得profile文件有效，这样就不用重启了" class="headerlink" title="使得profile文件有效，这样就不用重启了"></a>使得profile文件有效，这样就不用重启了</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> software]<span class="meta"># source /etc/profile</span></span><br></pre></td></tr></table></figure><h4 id="检查下version-看看成功没"><a href="#检查下version-看看成功没" class="headerlink" title="检查下version 看看成功没"></a>检查下version 看看成功没</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    [root@localhost software]# java -version</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    java version <span class="string">"1.8.0_172"</span></span><br><span class="line">    Java(TM) SE Runtime Environment (build 1.8.0_172-b11)</span><br><span class="line">    Java HotSpot(TM) 64-Bit<span class="built_in"> Server </span>VM (build 25.172-b11, mixed mode)</span><br><span class="line">**Success**</span><br></pre></td></tr></table></figure><p><br><br><br><br><br>   </p><h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><h4 id="DownLoad"><a href="#DownLoad" class="headerlink" title="DownLoad"></a>DownLoad</h4><p><a href="https://tomcat.apache.org/" target="_blank" rel="noopener">Tomcat Page</a><br><a href="http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-7/v7.0.88/bin/apache-tomcat-7.0.88.tar.gz" target="_blank" rel="noopener">Tomcat 7.0.88</a><br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@colinECS download]# wget   http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-<span class="number">7</span>/v7<span class="meta">.0</span><span class="meta">.88</span>/bin/apache-tomcat-<span class="number">7.0</span><span class="meta">.88</span>.tar.gz</span><br></pre></td></tr></table></figure></p><h4 id="Expand"><a href="#Expand" class="headerlink" title="Expand"></a>Expand</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@colinECS download]</span># <span class="selector-tag">tar</span> <span class="selector-tag">zxvf</span> <span class="selector-tag">apach-tomcat-6</span><span class="selector-class">.0</span><span class="selector-class">.16</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure><h4 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h4><p>cd to bin<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@colinECS</span> bin]<span class="meta"># ./startup.sh</span></span><br></pre></td></tr></table></figure></p><p><br><br><br></p><h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p><a href="https://tomcat.apache.org/" target="_blank" rel="noopener">Tomcat Page</a><br><a href="http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-7/v7.0.88/bin/apache-tomcat-7.0.88.tar.gz" target="_blank" rel="noopener">Tomcat 7.0.88</a><br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@colinECS download]# wget   http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-<span class="number">7</span>/v7<span class="meta">.0</span><span class="meta">.88</span>/bin/apache-tomcat-<span class="number">7.0</span><span class="meta">.88</span>.tar.gz</span><br></pre></td></tr></table></figure></p><h4 id="解压-1"><a href="#解压-1" class="headerlink" title="解压"></a>解压</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@colinECS download]</span># <span class="selector-tag">tar</span> <span class="selector-tag">zxvf</span> <span class="selector-tag">apach-tomcat-6</span><span class="selector-class">.0</span><span class="selector-class">.16</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><p>切换到bin文件夹<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@colinECS</span> bin]<span class="meta"># ./startup.sh</span></span><br></pre></td></tr></table></figure></p><p><br><br><br></p><h2 id="Jar-包使用"><a href="#Jar-包使用" class="headerlink" title="Jar 包使用"></a>Jar 包使用</h2><h4 id="1-running-list"><a href="#1-running-list" class="headerlink" title="1 running list"></a>1 running list</h4><pre><code>[root@Warbuild-Svr /]# ps aux|grep chessService.jarroot      58662  0.0  0.0 112720   988 pts/3    S+   10:53   0:00 grep --color=auto chessService.jarroot     125484  0.6  0.9 13526904 297464 ?     Sl   10:07   0:18 java -jar chessService.jarroot     148294  0.0  0.3 14451472 117300 pts/0 Sl   10:15   0:01 java -jar chessService.jar</code></pre><h4 id="2-Kill-running"><a href="#2-Kill-running" class="headerlink" title="2 Kill running"></a>2 Kill running</h4><pre><code>[root@Warbuild-Svr /]# kill -9 148294</code></pre><h4 id="3-Start"><a href="#3-Start" class="headerlink" title="3 Start"></a>3 Start</h4><pre><code>[root@Warbuild-Svr /]# java -jar chessService.jar &amp;</code></pre><p>声明：’&amp;’ 为持久化符号，若未加入’&amp;’ 则关闭窗口后停止程序  </p>]]></content>
      
      
      <categories>
          
          <category> 工具人 ToolMan </category>
          
          <category> Jvm初始化 Init </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> Java </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql安装[Linux]</title>
      <link href="/2016/07/12/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/Jvm%E5%88%9D%E5%A7%8B%E5%8C%96%20Init/20160712-Mysql%E5%AE%89%E8%A3%85%5BLinux%5D/"/>
      <url>/2016/07/12/%E5%B7%A5%E5%85%B7%E4%BA%BA%20ToolMan/Jvm%E5%88%9D%E5%A7%8B%E5%8C%96%20Init/20160712-Mysql%E5%AE%89%E8%A3%85%5BLinux%5D/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Linux下安装MySql遇到的坑和问题<a id="more"></a></p><h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><h4 id="1-get-Src-Yum"><a href="#1-get-Src-Yum" class="headerlink" title="1. get Src Yum"></a>1. get Src Yum</h4><p>MySQL5.7  </p><pre><code>rpm -Uvh http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</code></pre><p>MySQL8.0.11</p><pre><code>rpm -Uvh http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm  </code></pre><p>Do</p><pre><code>[root@colinECS /]# rpm -Uvh http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpmRetrieving http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpmwarning: /var/tmp/rpm-tmp.vJmA0S: Header V3 DSA/SHA1 Signature, key ID 5072e1f5:Preparing...                          ################################# [100%]Updating / installing...   1:mysql57-community-release-el7-9  ################################# [100%]</code></pre><h4 id="2-get-list-by-yum"><a href="#2-get-list-by-yum" class="headerlink" title="2. get list by yum"></a>2. get list by yum</h4><pre><code>[root@colinECS /]# yum repolist enabled|grep &quot;mysql.*-community.*&quot;mysql-connectors-community/x86_64 MySQL Connectors Community                  51mysql-tools-community/x86_64      MySQL Tools Community                       63mysql57-community/x86_64          MySQL 5.7 Community Server                 267</code></pre><h4 id="3-install"><a href="#3-install" class="headerlink" title="3. install"></a>3. install</h4><pre><code>[root@colinECS /]# yum -y install mysql-community-serverLoaded plugins: fastestmirrorLoading mirror speeds from cached hostfileResolving Dependencies--&gt; Running transaction check---&gt; Package mysql-community-server.x86_64 0:5.7.22-1.el7 will be installed--&gt; Processing Dependency: mysql-community-common(x86-64) = 5.7.22-1.el7 for package: mysql-community-server-el7.x86_64--&gt; Processing Dependency: mysql-community-client(x86-64) &gt;= 5.7.9 for package: mysql-community-server-5.7.226_64--&gt; Processing Dependency: libaio.so.1(LIBAIO_0.4)(64bit) for package: mysql-community-server-5.7.22-1.el7.x8--&gt; Processing Dependency: libaio.so.1(LIBAIO_0.1)(64bit) for package: mysql-community-server-5.7.22-1.el7.x8--&gt; Processing Dependency: libaio.so.1()(64bit) for package: mysql-community-server-5.7.22-1.el7.x86_64--&gt; Running transaction check---&gt; Package libaio.x86_64 0:0.3.109-13.el7 will be installed---&gt; Package mysql-community-client.x86_64 0:5.7.22-1.el7 will be installed--&gt; Processing Dependency: mysql-community-libs(x86-64) &gt;= 5.7.9 for package: mysql-community-client-5.7.22-164---&gt; Package mysql-community-common.x86_64 0:5.7.22-1.el7 will be installed--&gt; Running transaction check---&gt; Package mariadb-libs.x86_64 1:5.5.56-2.el7 will be obsoleted--&gt; Processing Dependency: libmysqlclient.so.18()(64bit) for package: 2:postfix-2.10.1-6.el7.x86_64--&gt; Processing Dependency: libmysqlclient.so.18(libmysqlclient_18)(64bit) for package: 2:postfix-2.10.1-6.el7---&gt; Package mysql-community-libs.x86_64 0:5.7.22-1.el7 will be obsoleting--&gt; Running transaction check---&gt; Package mysql-community-libs-compat.x86_64 0:5.7.22-1.el7 will be obsoleting--&gt; Finished Dependency ResolutionDependencies Resolved============================================================================================================= Package                               Arch             Version                     Repository=============================================================================================================Installing: mysql-community-libs                  x86_64           5.7.22-1.el7                mysql57-community     replacing  mariadb-libs.x86_64 1:5.5.56-2.el7 mysql-community-libs-compat           x86_64           5.7.22-1.el7                mysql57-community     replacing  mariadb-libs.x86_64 1:5.5.56-2.el7 mysql-community-server                x86_64           5.7.22-1.el7                mysql57-communityInstalling for dependencies: libaio                                x86_64           0.3.109-13.el7              base mysql-community-client                x86_64           5.7.22-1.el7                mysql57-community mysql-community-common                x86_64           5.7.22-1.el7                mysql57-communityTransaction Summary=============================================================================================================Install  3 Packages (+3 Dependent packages)Total download size: 193 MDownloading packages:(1/6): libaio-0.3.109-13.el7.x86_64.rpm                                                        |  24 kB  00:0warning: /var/cache/yum/x86_64/7/mysql57-community/packages/mysql-community-common-5.7.22-1.el7.x86_64.rpm: HDSA/SHA1 Signature, key ID 5072e1f5: NOKEYPublic key for mysql-community-common-5.7.22-1.el7.x86_64.rpm is not installed(2/6): mysql-community-common-5.7.22-1.el7.x86_64.rpm                                          | 274 kB  00:0(3/6): mysql-community-libs-5.7.22-1.el7.x86_64.rpm                                            | 2.1 MB  00:0(4/6): mysql-community-libs-compat-5.7.22-1.el7.x86_64.rpm                                     | 2.0 MB  00:0(5/6): mysql-community-client-5.7.22-1.el7.x86_64.rpm                                          |  24 MB  00:0(6/6): mysql-community-server-5.7.22-1.el7.x86_64.rpm                                          | 165 MB  00:0-------------------------------------------------------------------------------------------------------------Total                                                                                 1.1 MB/s | 193 MB  00:0Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysqlImporting GPG key 0x5072E1F5: Userid     : &quot;MySQL Release Engineering &lt;mysql-build@oss.oracle.com&gt;&quot; Fingerprint: a4a9 4068 76fc bd3c 4567 70c8 8c71 8d3b 5072 e1f5 Package    : mysql57-community-release-el7-9.noarch (installed) From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-mysqlRunning transaction checkRunning transaction testTransaction test succeededRunning transactionWarning: RPMDB altered outside of yum.  Installing : mysql-community-common-5.7.22-1.el7.x86_64  Installing : mysql-community-libs-5.7.22-1.el7.x86_64  Installing : mysql-community-client-5.7.22-1.el7.x86_64  Installing : libaio-0.3.109-13.el7.x86_64  Installing : mysql-community-server-5.7.22-1.el7.x86_64  Installing : mysql-community-libs-compat-5.7.22-1.el7.x86_64  Erasing    : 1:mariadb-libs-5.5.56-2.el7.x86_64  Verifying  : mysql-community-libs-compat-5.7.22-1.el7.x86_64  Verifying  : mysql-community-common-5.7.22-1.el7.x86_64  Verifying  : mysql-community-server-5.7.22-1.el7.x86_64  Verifying  : mysql-community-client-5.7.22-1.el7.x86_64  Verifying  : mysql-community-libs-5.7.22-1.el7.x86_64  Verifying  : libaio-0.3.109-13.el7.x86_64  Verifying  : 1:mariadb-libs-5.5.56-2.el7.x86_64Installed:  mysql-community-libs.x86_64 0:5.7.22-1.el7              mysql-community-libs-compat.x86_64 0:5.7.22-1.el7  mysql-community-server.x86_64 0:5.7.22-1.el7Dependency Installed:  libaio.x86_64 0:0.3.109-13.el7                            mysql-community-client.x86_64 0:5.7.22-1.el7  mysql-community-common.x86_64 0:5.7.22-1.el7Replaced:  mariadb-libs.x86_64 1:5.5.56-2.el7Complete!</code></pre><h4 id="4-Join-machine-start"><a href="#4-Join-machine-start" class="headerlink" title="4. Join machine start"></a>4. Join machine start</h4><pre><code>[root@colinECS /]# systemctl enable mysqld</code></pre><p>check is that do success[Optional/可选]<br>0:关闭 1:关闭 2:启用 3:启用 4:启用 5:启用 6:关闭停止：</p><pre><code>[root@colinECS /]# chkconfig --list | grep mysql* mysqld</code></pre><h4 id="5-Start-SQL-Service"><a href="#5-Start-SQL-Service" class="headerlink" title="5. Start SQL Service"></a>5. Start SQL Service</h4><pre><code>[root@colinECS /]# systemctl start mysqld</code></pre><h4 id="6-Get-Status"><a href="#6-Get-Status" class="headerlink" title="6. Get Status"></a>6. Get Status</h4><pre><code>[root@colinECS /]# systemctl status mysqld● mysqld.service - MySQL Server   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)   Active: active (running) since Sat 2018-06-02 12:05:09 CST; 15s ago     Docs: man:mysqld(8)           http://dev.mysql.com/doc/refman/en/using-systemd.html  Process: 1324 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (co, status=0/SUCCESS)  Process: 1251 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS) Main PID: 1328 (mysqld)   CGroup: /system.slice/mysqld.service           └─1328 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pidJun 02 12:05:01 colinECS systemd[1]: Starting MySQL Server...Jun 02 12:05:09 colinECS systemd[1]: Started MySQL Server.</code></pre><h4 id="7-Get-Temporary-password"><a href="#7-Get-Temporary-password" class="headerlink" title="7. Get Temporary password"></a>7. Get Temporary password</h4><pre><code>[root@colinECS /]# grep &apos;temporary password&apos; /var/log/mysqld.log2018-06-02T04:05:04.721743Z 1 [Note] A temporary password is generated for root@localhost: l7fnpYY#owEA[root@colinECS /]# mysql -uroot -pl7fnpYY#owEAmysql: [Warning] Using a password on the command line interface can be insecure.Welcome to the MySQL monitor.  Commands end with ; or \g.Your MySQL connection id is 4Server version: 5.7.22Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.mysql&gt;</code></pre><h4 id="8-Password-Change"><a href="#8-Password-Change" class="headerlink" title="8. Password Change"></a>8. Password Change</h4><h5 id="1-did"><a href="#1-did" class="headerlink" title="1. did"></a>1. did</h5><p>Must Contain number,small and big letter and char like’123Zz.’</p><pre><code>mysql&gt; SET PASSWORD=PASSWORD(&apos;123Zz.&apos;);Query OK, 0 rows affected, 1 warning (0.00 sec)</code></pre><p>Then change pwd rules that can use simple pwd</p><pre><code>mysql&gt; set global validate_password_policy=0;Query OK, 0 rows affected (0.00 sec)mysql&gt; set global validate_password_length=1;Query OK, 0 rows affected (0.00 sec)</code></pre><p>And Change back to simple pwd</p><h5 id="2-others-did"><a href="#2-others-did" class="headerlink" title="2. others did"></a>2. others did</h5><pre><code>mysql&gt; ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;MyNewPass4!&apos;;</code></pre><h5 id="3-tips-may-need-latter"><a href="#3-tips-may-need-latter" class="headerlink" title="3. tips may need latter"></a>3. tips may need latter</h5><p>如果忘记了MySQL root密码，可以用以下方法重新设置：1.KILL掉系统里的MySQL进程</p><pre><code>killall -TERM MySQLd </code></pre><p>2.用以下命令启动MySQL，以不检查权限的方式启动；</p><pre><code>safe_MySQLd --skip-grant-tables &amp; </code></pre><p>3.然后用空密码方式使用root用户登录 MySQL；</p><pre><code>MySQL -u root </code></pre><p>4.修改root用户的密码；</p><pre><code>MySQL&gt; update MySQL.user set password=PASSWORD(&apos;新密码&apos;) where User=&apos;root&apos;;  MySQL&gt; flush privileges;  MySQL&gt; quit </code></pre><p>重新启动MySQL，就可以使用新密码登录了。</p><h4 id="9-Make-navicat-can-login-For-error-1130"><a href="#9-Make-navicat-can-login-For-error-1130" class="headerlink" title="9. Make navicat can login [For error 1130]"></a>9. Make navicat can login [For error 1130]</h4><p>1130 -  Host ‘gitmmp.com’ is not allowed to connect to this MySQL server</p><pre><code>mysql&gt;use mysql;mysql&gt;select &apos;host&apos; from user where user=&apos;root&apos;;mysql&gt;update user set host = &apos;%&apos; where user =&apos;root&apos;;mysql&gt;flush privileges;</code></pre><h3 id="Remove"><a href="#Remove" class="headerlink" title="Remove"></a>Remove</h3><p>1.查看已安装的mysql命令：rpm -qa | grep -i mysql<img src="https://cdn.jsdelivr.net/gh/hongxii/ObjectServer0@1.0.0/src/20160712-Mysql安装[Linux]/1.check.png" alt="avatar"><img src="/2016/07/12/工具人 ToolMan/Jvm初始化 Init/20160712-Mysql安装[Linux]/09/08/工具人%20ToolMan/Jvm初始化%20Init/20160712-Mysql安装[Linux]/1.check.png" title="check"></p><p>2.卸载mysql命令：yum remove mysql-community-server-5.6.36-2.el7.x86_64<img src="https://cdn.jsdelivr.net/gh/hongxii/ObjectServer0@1.0.0/src/20160712-Mysql安装[Linux]/2.remove1.png" alt="avatar"><img src="/2016/07/12/工具人 ToolMan/Jvm初始化 Init/20160712-Mysql安装[Linux]/09/08/工具人%20ToolMan/Jvm初始化%20Init/20160712-Mysql安装[Linux]/2.remove1.png" title="remove1"></p><p>查看mysql的其它依赖：rpm -qa | grep -i mysql使用yum remove mysql-xxx依次卸载，知道mysql的其它依赖全部卸载掉为止<img src="https://cdn.jsdelivr.net/gh/hongxii/ObjectServer0@1.0.0/src/20160712-Mysql安装[Linux]/3.getdep.png" alt="avatar"><img src="/2016/07/12/工具人 ToolMan/Jvm初始化 Init/20160712-Mysql安装[Linux]/09/08/工具人%20ToolMan/Jvm初始化%20Init/20160712-Mysql安装[Linux]/3.getdep.png" title="3.getdep"></p><p>3.删除mysql文件目录使用命令查看mysql相关的文件目录：find / -name mysql<img src="https://cdn.jsdelivr.net/gh/hongxii/ObjectServer0@1.0.0/src/20160712-Mysql安装[Linux]/4.findfiles.png" alt="avatar"><img src="/2016/07/12/工具人 ToolMan/Jvm初始化 Init/20160712-Mysql安装[Linux]/09/08/工具人%20ToolMan/Jvm初始化%20Init/20160712-Mysql安装[Linux]/4.findfiles.png" title="4.findfiles"></p><p>使用rm -rf 命令删除mysql的文件目录<img src="https://cdn.jsdelivr.net/gh/hongxii/ObjectServer0@1.0.0/src/20160712-Mysql安装[Linux]/5.del.png" alt="avatar"><img src="/2016/07/12/工具人 ToolMan/Jvm初始化 Init/20160712-Mysql安装[Linux]/09/08/工具人%20ToolMan/Jvm初始化%20Init/20160712-Mysql安装[Linux]/5.del.png" title="5.del"></p><p>至此mysql已成功卸载</p>]]></content>
      
      
      <categories>
          
          <category> 工具人 ToolMan </category>
          
          <category> Jvm初始化 Init </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
